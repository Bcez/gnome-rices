"use strict";var PictaCast=function(){function f(a,b){if(!e[a])return d.log("no handlers registered to event:",a),!1;for(var c=0;c<e[a].length;c++)e[a][c].apply(this,b)}function g(){if(!chrome.cast||!chrome.cast.isAvailable){d.warn("chromecast not ready"),setTimeout(g.bind(this),1e3);return}var b=new chrome.cast.SessionRequest(a),c=new chrome.cast.ApiConfig(b,j.bind(this),k.bind(this));chrome.cast.initialize(c,function(){f("init",[{error:0}])},function(){f("init",[{error:1}])})}function h(a){a=a||function(){};if(b)return a(b,{error:0}),!0;chrome.cast.requestSession(function(c){i(c),a(b,{error:0})},function(c){d.warn("request session error",arguments);var e=c;b&&c.code=="cancel"&&(e=0),a(b,{error:e,info:c})})}function i(a){b=a;var e=0,g=null,h=new chrome.cast.media.MediaInfo("https://pictacast.com/assets/splash.png");h.metadata=new chrome.cast.media.PhotoMediaMetadata,h.contentType="image/png",h.metadata.title="PictaCast",h.metadata.artist="",h.metadata.images=[{url:"https://pictacast.com/assets/splash.png"}];var i=new chrome.cast.media.LoadRequest(h);a.loadMedia(i),a.addUpdateListener(function(a){if(!a)return f("sessionEnd"),!0;f("sessionUpdate")}),a.addMessageListener(c,function(a,b){var c=JSON.parse(b);switch(c.type){case"getImage":f("requestImage",[c.data]);break;case"getState":f("sendPlayerStateToDevice");break;case"getMusic":f("sendMusicStateToDevice");break;case"ping":f("ping"),c.appState!==e&&(g&&clearTimeout(g),g=setTimeout(function(){f("appStateChange",["0x"+parseInt(c.appState,10).toString(16).toUpperCase()])},3e3),e=c.appState);break;case"state":d.info("device state",c.data),f("deviceState",[c.data]);break;case"register":f("registerReceiver",[c.data]);break;case"rtcAnswer":f("rtcAnswer",[c.data]);break;case"requestMetadata":f("requestMetadata",[c.data]);break;case"musicState":f("musicState",[c.data]);break;case"albumStarted":f("albumStarted",[c.data])}})}function j(a){i(a),f("sessionInit",[{resync:!0}])}function k(a){if(a=="available")return f("readyToPlay"),h(function(a,b){if(b.error)return f("sessionInitError",[b.info]),!0;f("sessionInit")}),!0}function l(a,e,f){a=a||{error:"message undefined (sendCastMessage)"},e=e||function(){},f=f||function(){d.warn("error sending message",arguments)};if(!b)return d.warn("no session to message"),!1;b.sendMessage(c,a,e,f)}var a="B3613293",b=null,c="urn:x-cast:com.lostsource.pictacast",d=function(){var a=!1;return{log:function(){if(!a)return!0;console.log.apply(console,arguments)},info:function(){if(!a)return!0;console.info.apply(console,arguments)},warn:function(){if(!a)return!0;console.warn.apply(console,arguments)}}}(),e={};return{init:function(){d.log("initializing"),g()},pong:function(){l({type:"pong"})},send:function(a){l(a,null,function(b){d.warn("error sending message",a,b)})},on:function(a,b){e[a]=e[a]||[],e[a].push(b)},getDeviceName:function(){return b?b.receiver.friendlyName||"(unknown device)":!1}}}()