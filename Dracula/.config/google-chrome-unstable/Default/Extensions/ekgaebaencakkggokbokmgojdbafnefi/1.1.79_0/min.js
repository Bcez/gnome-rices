"use strict",function(){function g(){if(chrome&&chrome.runtime&&typeof chrome.runtime.getManifest=="function"){var a=chrome.runtime.getManifest().version;a||(a="");function b(a){return a%2==0}var c=a.substr(a.lastIndexOf(".")+1);return c=parseInt(c,10),b(c)?!0:!1}return!0}function h(){if(c&&d)return!0;c=analytics.getService("PictaCast"),d=c.getTracker("UA-63826362-1");var a="Launch";e&&(a="First Launch"),d.sendAppView(a),e=!1,f&&j("app_state","Launch Source",f)}function i(){if(!c||!d)return!0;d=null,c=null}function j(a,b,e,f){typeof e=="boolean"&&(e=e.toString()),typeof f=="boolean"&&(f=f?1:0),c&&d&&d.sendEvent(a,b,e,f)}function k(a,b){a=a||{},b=b||{};var c=JSON.parse(JSON.stringify(a)),d=JSON.parse(JSON.stringify(b)),e={};for(var f in c){var g=c[f],h=d[f];switch(typeof g){case"object":if(JSON.stringify(g)!==JSON.stringify(h))if(g instanceof Array){var i=[],j;for(j=0;j<g.length;j++)h.indexOf(g[j])===-1&&i.push("-"+g[j]);for(j=0;j<h.length;j++)g.indexOf(h[j])===-1&&i.push("+"+h[j]);i.length>0&&(e[f]=i.join(" "))}else{var l=k(g,h),m={};for(var n in l){var o=l[n];m[n]=o}e[f]=m}break;default:g!==h&&(e[f]=h)}}return Object.keys(e).length===0?null:e}function l(a,b){var c=k(a,b);if(!c)return!1;for(var d in c){var e=c[d];if(typeof e=="object")for(var f in e){var g=e[f];j("option",d,f+":"+g)}else j("option",d,e)}}function m(){chrome.storage.sync.get(["trial"],function(a){a=a||{};var b=a.trial||{},c=b.days||0;c++,b.days=c,chrome.storage.sync.set({trial:b},function(){j("trial","days",b.days)})})}function n(b){function D(){var a=new Date;return a.toDateString()}function E(a){r=a}function F(){var a=q.slice();return r&&a.push(r),a}function G(){if(!n._remoteupload)return!1;U();var a=App.Folders.getExtra("_remoteupload")||{};mb("addAlbumCard",{title:chrome.i18n.getMessage("mobile_upload"),total:n._remoteupload.images.length,id:"_remoteupload",firstIndex:n._remoteupload.startIndex,paused:a.paused||!1})}function H(){if(!y)return!1;var a=D();t[a]=t[a]||0,t[a]++;var b=Math.ceil((A.charCodeAt(0)*(A.charCodeAt(0)/2)-(t[a]||0)*5)/A.charCodeAt(0));mb("T",b);if(t[a]%15===0){B&&clearTimeout(B);var c=!1;for(var d in t)d!=a&&(delete t[d],c=!0);c&&m(),B=setTimeout(function(){chrome.storage.sync.set({stats:t},function(){})},1e4)}I()&&J()}function I(){if(g())return!1;var a=D();return t[a]=t[a]||0,parseInt(t[a],10)>Math.ceil(Math.floor(A.charCodeAt(0)*A.charCodeAt(0)/5)/2)?!0:!1}function J(){}function K(){WebServer.send({type:"closeWindow"}),setTimeout(function(){L(WebServer.getPort())},100)}function L(a){window.open("http://127.0.0.1:"+a+"/","PictaCastConnectorPage")}function M(){var a=0,b=[];for(var c in n){var d=a;a+=n[c].images.length,n[c].paused&&b.push([d,a-1])}return b}function N(){var a=0;for(var b in n){if(n[b].paused)continue;a+=n[b].images.length}return a}function O(){var a=[];for(var b in n){var c=n[b].images;a=a.concat(c)}return a}function P(){var a=[];for(var b in o)a.push(o[b]);return a}function Q(){return window.navigator.appVersion.indexOf("Mac OS")!=-1}function R(){return window.navigator.appVersion.indexOf("CrOS")!=-1}function S(a){a=a||function(){},chrome.runtime.getPlatformInfo(function(b){return b.os==="win"?a(!0):a(!1)})}function T(a){a=a||function(){};if(z)return z.focus(),!1;var b={width:100,height:100,minWidth:100,minHeight:100,resizable:!1,frame:"none"};Q()||(b.state="minimized",b.hidden=!0),chrome.app.window.create("app.html",b,function(b){z=b,a(b.contentWindow),Q()||b.hide(),b.onClosed.addListener(function(){z=!1})})}function U(){var a=0;for(var b in n){var c=App.Folders.getExtra(b)||{};n[b].startIndex=a,n[b].paused=c.paused||!1,a+=n[b].images.length}}function V(a,b){typeof n[a]=="undefined"&&(n[a]={}),n[a].images=b,Y(),U()}function W(){ob("music",{total:P().length})}function Y(){if(X)return!1;X=setTimeout(function(){var a=O().length,b=N();ob("state",{total:a,totalPlayable:b,lastTotal:p,skip:M(),playable:b}),p=b,X=!1},500)}function Z(a){ob("message",{message:a})}function $(a,b,c){V(c,a);var d=App.Folders.getExtra(c)||{};mb("addAlbumCard",{title:b,total:a.length,id:c,firstIndex:n[c].startIndex,paused:d.paused||!1})}function _(a,b){b=b||function(){};var c=[],d=["jpg","png"];lb(a,function(a){a.forEach(function(a){var b=a.name||"",e=b.substr(b.lastIndexOf(".")+1).toLowerCase();a.isFile&&d.indexOf(e)!=-1&&c.push(a)}),b(c)})}function ab(a,b,c,d){d=d||function(){};var e=!1;c>a.size-1&&(e=!0);var f=new FileReader;f.onerror=function(){d({error:!0})},f.onload=function(a){d({buffer:a.target.result,start:b,end:c,lastChunk:e})},f.readAsArrayBuffer(a.slice(b,c))}function bb(a,b,c,d){d=d||[];var e=!0;d.length===0&&(e=!1),c=c||[],b=b||function(){},lb(a,function(a){var f=0,g=a.length,h=[],i=0;for(i=0;i<g;i++){var j=a[i];if(j.isFile===!0){if(e){var k=j.name||"",l=k.substr(k.lastIndexOf(".")+1).toLowerCase();d.indexOf(l)!==-1&&c.push(j)}else c.push(j);continue}h.push(j)}var m=h.length;m===0&&b(c);for(i=0;i<m;i++)(function(a){setTimeout(function(){bb(a,function(){f++,f===m&&b(c)},c,d)},Math.floor(Math.random()*10))})(h[i])})}function cb(a,b){b=b||function(){};var c=[];lb(a,function(a){a.forEach(function(a){a.isFile||c.push(a)}),b(c)})}function db(a,b){b=b||function(){},cb(a,function(a){a.length>0?b(!0):b(!1)})}function eb(a,b){return a[0]===b[0]?0:a[0]<b[0]?-1:1}function fb(a,b,c){var d=[];bb(a,function(c){var f=[];c.forEach(function(a,b){var c=a.fullPath||"";f.push([c,b])}),f.sort(eb);var g=[];for(var h=0;h<f.length;h++)g.push(c[f[h][1]]);d=g,$(d,a.name,b),clearInterval(e)},d,c);var e=setInterval(function(){var c=App.Folders.getExtra(b)||{};$(d,a.name,b),mb("addAlbumCard",{title:a.name,total:d.length,id:b,firstIndex:n[b].startIndex,paused:c.paused||!1})},2e3)}function gb(a,b,c,d){if(!b)return!1;d=d||{};var e=["jpg","png"];if(d.recursive)return fb(b,c,e),!0;var f=d.withSubs||!1,g=[],h=0,i=[],j=[];a.forEach(function(a,b){var c=a.name||"",d=c.substr(c.lastIndexOf(".")+1).toLowerCase();a.isFile?e.indexOf(d)!=-1&&j.push([c,b]):f&&g.push(a)}),j.sort(eb);var k;for(k=0;k<j.length;k++)i.push(a[j[k][1]]);if(g.length>0)for(k=0;k<g.length;k++){var l=g[k];_(l,function(a){i=i.concat(a),h++,h==g.length&&$(i,b.name,c)})}else $(i,b.name,c)}function hb(){var a=[],b=0;for(var c in o)a.push({title:o[c].name,id:c,index:b}),b++;mb("updateMusicList",a)}function ib(a,b){o[b]=a}function jb(a){var b=a.chrome.fileSystem;b.chooseEntry({type:"openFile",accepts:[{extensions:["mp3"]}],acceptsMultiple:!0},function(c){a.close();if(chrome.runtime.lastError)return j("error","Add Music","Runtime Error"),!1;if(!c)return j("error","Add Music","No Entries"),!1;c.forEach(function(a){var c=b.retainEntry(a);App.Music.add(c),ib(a,c)}),hb(),W(),j("music","Add",c.length)}),j("dialog","Add Music")}function kb(a){var b=a.chrome.fileSystem;b.chooseEntry({type:"openDirectory"},function(c){a.close();if(chrome.runtime.lastError)return console.warn("runtime error",chrome.runtime.lastError),j("error","Add Folder","Runtime Error"),!1;if(!c)return console.warn("cannot load entry"),j("error","Add Folder","Cannot Load Entry"),!1;var d=b.retainEntry(c);App.Folders.add(d),lb(c,function(a){gb(a,c,d),db(c,function(a){a&&mb("promptAddSubs",{folderId:d})})}),j("album","Add")}),j("dialog","Add Folder")}function lb(a,b){function c(a){return Array.prototype.slice.call(a||[],0)}b=b||function(){};if(!a)return b([]),!1;var d=a.createReader(),e=[],f=function(){d.readEntries(function(a){a.length?(e=e.concat(c(a)),f()):b(e.sort())},function(){console.warn("read dir error",arguments),b([])})};f()}function mb(a,b){WebServer.send({type:"pageAction",message:{type:a,data:b}})}function nb(a,b){WebServer.send({type:"forwardToDevice",message:{type:a,data:b}})}function ob(a,b){nb("command",{type:a,data:b})}function pb(a){a=a||"";var b=8192,c=[],d=(Math.random()+"").substr(2),e=Math.ceil(a.length/b);while(a.length>0){var f=a.substr(0,b);a=a.substr(b),c.push({id:d,data:f,total:e,part:c.length+1,cbChunk:b})}return c}function qb(a){C&&clearTimeout(C),C=setTimeout(function(){chrome.storage.sync.set({options:a},function(){l(u,a),u=a})},3e3),a.tracking===!0?h():i()}function sb(){}function tb(){rb=!1}function ub(){rb=!0}function vb(a){var b="",c;for(var d=0;d<a.length;d++)c=a.charCodeAt(d),b+="&#"+c+";";return b}function wb(){var a="en",b=["en","fr","de","nl","es"];if(chrome.i18n&&typeof chrome.i18n.getUILanguage=="function"){var c=chrome.i18n.getUILanguage();if(c.trim().length<2)return a;var d=chrome.i18n.getUILanguage().split("-");return b.indexOf(d[0].toLowerCase())==-1?a:d[0].toLowerCase()}return a}function xb(){function a(a){var b=new ArrayBuffer(a.length),c=new Uint8Array(b);for(var d=0;d<c.length;d++)c[d]=a.charCodeAt(d);return b}function b(b){var c=b.indexOf(":")+1,d=b.indexOf(";"),e=b.substr(c,d-c).trim(),f=b.substr(b.indexOf(",")+1),g=atob(f);return{mimeType:e,buffer:a(g)}}function e(a,c){function g(a){c(a)}function h(c){function e(){d.removeEventListener("load",f,!1),d.removeEventListener("error",e,!1),g({error:!0})}function f(h){d.removeEventListener("load",f,!1),d.removeEventListener("error",e,!1);var i=h.target.result;loadImage.parseMetaData(c,function(c,d){if(d&&d.error===!0)return g({error:!0}),!1;var e=1;c.exif&&(e=c.exif.get("Orientation"));var f=!0;typeof a.nocrop!="undefined"&&a.nocrop==="true"&&(f=!1);var h=parseInt(a.orientation,10);switch(h){case 90:switch(e){case 1:case 2:e=8;break;case 3:case 4:e=6;break;case 5:case 6:e=0;break;case 7:case 8:e=3}break;case 180:switch(e){case 1:case 2:e=3;break;case 3:case 4:e=0;break;case 5:case 6:e=8;break;case 7:case 8:e=6}break;case 270:switch(e){case 1:case 2:e=6;break;case 3:case 4:e=8;break;case 5:case 6:e=3;break;case 7:case 8:e=0}}loadImageHQ(i,function(c){var d=.95;a.failrate&&(d-=.005*a.failrate),d=d.toFixed(2);if(c instanceof HTMLCanvasElement!=1)return g({error:!0}),!1;if(a.dataURI===!0)g({dataURI:c.toDataURL("image/jpeg",d)});else{var e=b(c.toDataURL("image/jpeg",d));g({type:e.mimeType,buffer:e.buffer})}c&&c.remove(),c=undefined},{maxWidth:a.width,maxHeight:a.height,canvas:!0,orientation:e,crop:f})},{disableExifThumbnail:!0})}if(typeof c=="undefined")return g({error:!0}),!1;var d=new FileReader;d.addEventListener("error",e,!1),d.addEventListener("load",f,!1),d.readAsDataURL(c)}function i(){this.status==200&&h(j.response),j.removeEventListener("load",i,!1),j=null}var d=a.index,e=O(),f=e[d];if(!f)return g({error:!0}),!1;if(typeof f=="string"){var j=new XMLHttpRequest;j.responseType="blob",j.addEventListener("load",i,!1),j.open("GET",f,!0),j.send()}else f.file(function(a){h(a),a=undefined},function(){g({error:!0})})}function g(a,b){var c=a.index,d=P(),e=d[c];if(!e)return b({error:!0}),!1;var g=c+":"+e.fullPath;if(f&&f.key===g)return b({file:f.file}),!0;e.file(function(a){if(typeof a=="undefined")return b({error:!0}),!1;a._internalIndex=c,f={key:g,file:a},b({file:a})})}WebServer.getAllowedIPs=function(){return F()},WebServer.translation_passthrough=function(b){var c=String.fromCharCode.apply(null,new Uint8Array(b)),d=c.match(/@:[a-z_]+:@/gi)||[];for(var e=0;e<d.length;e++){var f=d[e];if(f.substr(0,2)!="@:")continue;if(f.substr(f.length-2)!=":@")continue;var g=f.substr(2,f.length-4),h=chrome.i18n.getMessage(g),i=vb(h);c=c.split(f).join(i)}return a(c)},WebServer.canDoMobileUploads=function(){return u.mobile&&u.mobile.enabled&&rb?!0:!1},WebServer.on("uploadFile",function(b){switch(b.url){case"/share":var c=["image/jpg","image/jpeg"];if(c.indexOf(b.type)==-1)return!1;var d=a(b.data),e=new Blob([d],{type:b.type}),f=URL.createObjectURL(e);n._remoteupload||(n._remoteupload={},n._remoteupload.images=[]);var g=n._remoteupload.images.concat([f]);V("_remoteupload",g),G(),j("mobile","Upload")}}),WebServer.on("message",function(a){switch(a.type){case"state":switch(a.data.state){case"connected":nb("init",{ipList:d,port:k,options:u,source:chrome.runtime.id,strings:{gm:chrome.i18n.getMessage("good_morning"),ga:chrome.i18n.getMessage("good_afternoon"),ge:chrome.i18n.getMessage("good_evening"),np:chrome.i18n.getMessage("no_photos_to_cast"),op:chrome.i18n.getMessage("one_photo_loaded"),mp:chrome.i18n.getMessage("multi_photos_loaded"),am:chrome.i18n.getMessage("time_am"),pm:chrome.i18n.getMessage("time_pm")},lang:wb(),supportsRTC:!0}),sb();break;case"disconnected":tb()}var b=chrome.runtime.getManifest().short_name,f=chrome.i18n.getMessage("app_short_name");b.toLowerCase().indexOf("free")!=-1&&(f+=" - "+chrome.i18n.getMessage("free_postfix")),mb("setTitle",f);break;case"track":j.apply(null,a.data);break;case"request":switch(a.data.type){case"getOptions":setTimeout(function(){mb("setOptions",u)},500),S(function(a){a&&mb("isWindowsOS")});break;case"saveOptions":qb(a.data.data),ob("setOptions",a.data.data);break;case"state":Y();break;case"music":W();break;case"registerReceiver":y=!a.data.data.websock,mb("W",a.data.data.websock),mb("hasFirewall"),a.data.data.rtcOffer&&(c=new SimpleRTCData,c.getAnswer(a.data.data.rtcOffer,function(a){ob("setRTCAnswer",a)}),c.on("request",function(a){var b=JSON.parse(a.id);switch(b.type){case"getAudioChunk":var c=262144,d=b.index,f=b.chunk;g({index:d},function(b){ab(b.file,f*c,f*c+c,function(b){a.sendReply(b.buffer)})});break;case"getImage":var h=b.data;(function(b){e({dataURI:!0,index:b.index,width:b.width,height:b.height,nocrop:b.nocrop,failrate:b.failrate},function(b){a.sendReply(b.dataURI)})})(h)}}),j("cast","using_webrtc"));break;case"rtcAnswer":c.setAnswer(a.data.data);break;case"registerPing":v=!0,w&&clearTimeout(w),w=setTimeout(function(){v=!1},15e3),H();break;case"metadata":if(u.display.indexOf("filename")!=-1){var h=a.data.data.index,i=O(),l=i[h];if(l){var m=l.name;m.indexOf(".")!=-1&&(m=m.substr(0,m.lastIndexOf(".")));var p=l.fullPath.split("/"),q=p[1],r=p[p.length-2],s={album:q,parent:r,fileName:m,index:h};nb("slideMetadata",s)}}break;case"image":var t=a.data.image;(function(a){e({dataURI:!0,index:a.index,width:a.width,height:a.height,nocrop:a.nocrop},function(b){var c=pb(b.dataURI);for(var d=0;d<c.length;d++)nb("imageResponse",{callbackId:a.callbackId,response:JSON.parse(JSON.stringify(c[d]))})})})(t);break;case"addFolder":T(function(a){kb(a)});break;case"addMusic":T(function(a){jb(a)});break;case"addFolderSubs":App.Folders.setExtra(a.data.id,"recursive",a.data.state);var x=a.data.id;T(function(a){var b=a.chrome.fileSystem;b.restoreEntry(x,function(b){a.close(),chrome.runtime.lastError&&console.warn("failed to load",chrome.runtime.lastError),lb(b,function(a){gb(a,b,x,App.Folders.getExtra(x))})})}),j("album","Add Recursive");break;case"showFirewallHelp":Db();break;case"removeTrack":App.Music.remove(a.data.id),delete o[a.data.id],hb(),W(),j("music","Remove");break;case"pauseFolder":App.Folders.setExtra(a.data.id,"paused",!0),U(),Y(),j("album","Pause");break;case"unpauseFolder":App.Folders.setExtra(a.data.id,"paused",!1),U(),Y(),j("album","Unpause");break;case"removeFolder":App.Folders.remove(a.data.id),delete n[a.data.id],U(),Y(),j("album","Remove");break;case"getAlbumList":T(function(b){function d(a){c[a]=!0;for(var d in c)if(!c[d])return!1;b.close()}var c={music:a.data.skipMusic||!1,albums:!1},e=b.chrome.fileSystem;App.Folders.getAll(function(a){var b=0,c=a.length,f=0;if(c===0&&!n._remoteupload)return mb("noFolders"),d("albums"),!1;for(var g=0;g<a.length;g++){var h=a[g];(function(a){e.restoreEntry(a,function(e){chrome.runtime.lastError&&b++,lb(e,function(g){var h=App.Folders.getExtra(a);gb(g,e,a,h),f++,f>=c&&(f-b<=0&&(n._remoteupload||mb("noFolders")),d("albums"))})})})(h)}}),a.data.skipMusic||App.Music.getAll(function(a){var b=0,c=a.length,f=0;R()&&mb("isChromeOS");if(c===0)return mb("updateMusicList",[]),d("music"),!1;for(var g=0;g<a.length;g++){var h=a[g];(function(a){e.restoreEntry(a,function(e){chrome.runtime.lastError?(App.Music.remove(a),b++):ib(e,a),f++,f>=c&&(f-b<=0?(mb("updateMusicList",[]),W()):hb(),d("music"))})})(h)}})}),G()}break;case"info":switch(a.data.type){case"shownBuyNotice":u&&!u.shownBuyNotice&&(u.shownBuyNotice=!0,qb(u))}}}),WebServer.on("registerCast",function(a){s=a.csid,E(a.host),Y(),y=!a.websock,mb("W",a.websock),mb("localAddress",a.local),ub(),j("cast","using_webserver")});var f=null;WebServer.on("requestFile",function(a){var b=a.index,c=F(),d=a.options.csid||!1;c.indexOf(a.socket.peerAddress)==-1&&d!==!1&&d!==s&&(console.warn("request denied",a.socket.peerAddress,"options",a.options),b=-1),e({index:b,width:a.options.width,height:a.options.height,nocrop:a.options.nocrop,orientation:a.options.orientation||0},function(){a.callback.apply(this,arguments)})}),WebServer.on("getMusic",function(a){var b=a.index,c=F();c.indexOf(a.socket.peerAddress)==-1&&(console.warn("request denied",a.socket.peerAddress),b=-1),g({index:b},function(){a.callback.apply(this,arguments)})})}function Ab(a){zb&&clearTimeout(zb),a&&!yb&&(yb=JSON.stringify(a)),chrome.system.network.getNetworkInterfaces(function(a){var b=JSON.stringify(a);b!=yb&&(yb=null,Bb(a)),zb=setTimeout(function(){Ab(a)},1e4)})}function Bb(a){Cb(a),nb("updateIPList",{ipList:d,port:k})}function Cb(a){d.length=0;for(var b=0;b<a.length;b++)d.push(a[b].address)}function Db(){chrome.app.window.create("firewall.html",{id:"PictacastFirewalHelper3",width:640,height:640,resizable:!1,frame:"chrome"},function(a){var b=a.contentWindow;b.addEventListener("load",function(){var a=b.document;a.getElementById("msgProblemWithFirewall").innerHTML=vb(chrome.i18n.getMessage("problem_with_firewall")),a.getElementById("msgSuggestMSGuide").innerHTML=vb(chrome.i18n.getMessage("suggest_microsoft_guide")),a.getElementById("lnkFirewallGuide").innerHTML=vb(chrome.i18n.getMessage("firewall_guide_title")),a.getElementById("lnkFirewallGuide").href=chrome.i18n.getMessage("filewall_help_link");var c=chrome.i18n.getMessage("suggest_browser_restart").split("chrome://restart"),d=vb(c[0]),e=vb(c[1]);a.getElementById("msgSuggestRestart").innerHTML=d+"<b>chrome://restart</b>"+e,c=chrome.i18n.getMessage("contact_support").split("support@pictacast.com");var f=vb(c[0]),g=vb(c[1]);a.getElementById("contactSupport").innerHTML=f+"<a target='_blank' href='mailto:support@pictacast.com'>support@pictacast.com</a>"+g,a.getElementById("contactSupport").innerHTML+="&nbsp;"+vb(chrome.i18n.getMessage("offer_refund"))}),j("window","open","Firewall Help")})}function Eb(){chrome.app.window.create("thankyou.html",{id:"PictaCastThankYou4",width:640,height:530,resizable:!1,frame:"native"},function(b){var c=b.contentWindow;c.addEventListener("load",function(){var b=c.document.getElementById("msgThankYou");b.innerHTML=vb(chrome.i18n.getMessage("purchase_thankyou"));var d=c.document.getElementById("msgRefund");d.innerHTML=vb(chrome.i18n.getMessage("request_refund"));var e=c.document.getElementById("msgRemoveTrial");e.innerHTML=vb(chrome.i18n.getMessage("remove_trial"));var f=c.document.getElementById("btnLaunchFull");f.innerHTML=vb(chrome.i18n.getMessage("launch_full"));var g=c.document.getElementById("chkRemTrial");f.addEventListener("click",function(){chrome.runtime.sendMessage(a,{cmd:"launchApp",removeTrial:g.checked},function(a){a=a||{},a.removeYourself===!0&&chrome.management.uninstallSelf()})},!1);var h=chrome.i18n.getMessage("need_help"),i=h.split("[supportmail]"),j=vb(i[0]),k=vb(i[1]),l="<a target='_blank' href='mailto:support@pictacast.com'>support@pictacast.com</a>",m=j+l+k,n=c.document.getElementById("msgNeedHelp");n.innerHTML=m},!1),j("window","open","Purchase Thank You")})}function Fb(){chrome.app.window.create("lock.html",{id:"PictaCastLockWin5",width:640,height:440,resizable:!1,frame:"chrome"},function(a){var b=a.contentWindow;b.addEventListener("load",function(){var a=b.document.getElementById("bttBuy");a.innerHTML=vb(chrome.i18n.getMessage("buy_from_store"));var c=b.document.getElementById("txtLimitReached");c.innerHTML=vb(chrome.i18n.getMessage("limit_reached"));var d=b.document.getElementById("txtComeBack"),e=chrome.i18n.getMessage("check_back_tomorrow"),f="[Chrome Web Store]",g=e.substr(0,e.indexOf(f)),h=vb(g),i=vb(e.substr(g.length+f.length)),j="<a target='_blank' href='https://chrome.google.com/webstore/detail/gcemmlojgdikdgfkmaphkenamfhonlid?utm_content=locklink' style='color:black; text-decoration:underline;'>"+chrome.i18n.getMessage("chrome_web_store")+"</a>";d.innerHTML=h+j+i;var k=b.document.getElementById("fancy_buy_url"),l=chrome.i18n.getMessage("fancy_buy_url");k.addEventListener("click",function(){return window.open("https://"+l),!1}),k.innerHTML=l},!1),j("window","open","Timed Out")})}b=b||{},f=b.launchSource;var c=null,d=[],k=null,n={},o=[],p=-1,q=["127.0.0.1"],r=null,s=null,t={},u={},v=!1,w=!1,x=!1,y=!1,z=!1;setInterval(function(){!v&&x?(chrome.power.releaseKeepAwake(),x=!1):v&&!x&&(chrome.power.requestKeepAwake("system"),x=!0)},1e3);var A="<",B=null,C=null,X=!1,rb=!1,yb=null,zb=null;chrome.storage.sync.get(["stats","options"],function(a){a=a||{},t=a.stats||{},u=a.options||{},Object.keys(u).length===0&&(u={shuffle:!0,croptofit:!1,mode:"slide",speed:"normal",display:["filename"],mobile:{enabled:!1,showLink:!0,shortLink:!0,message:""},tracking:"UNSET",timeformat:"24HR"},e=!0),typeof u.autoUpdateMin=="undefined"&&(u.autoUpdateMin=5),typeof u.croptofit=="undefined"&&(u.croptofit=!0),typeof u.orientation=="undefined"&&(u.orientation=0),typeof u.tracking=="undefined"?u.tracking="UNSET":u.tracking===!0?h():i(),typeof u.timeformat=="undefined"&&(u.timeformat="24HR"),J=function(){WebServer.stop(),Fb()},I()?Fb():chrome.system.network.getNetworkInterfaces(function(a){Cb(a),WebServer.on("start",function(a){k=a.port,K(),xb()}),WebServer.isStarted()?(K(),Y()):WebServer.start(),Ab(a)}),g()&&(u.shownBuyNotice=!1)}),chrome.storage.onChanged.addListener(function(a,b){if(b!="sync")return!0;a=a||{};if(typeof a.stats!="object")return!0;if(a.stats.oldValue&&!a.stats.newValue){var c=Object.keys(a.stats.oldValue),d={};for(var e=0;e<c.length;e++)d[c[e]]=a.stats.oldValue[c[e]];chrome.storage.sync.set({stats:d},function(){})}}),chrome.runtime.onMessageExternal.addListener(function(b,c,d){if(c.id!=a)return!1;switch(b){case"event_fullAppInstalled":WebServer.stop(),Eb();break;case"ping":setTimeout(function(){chrome.runtime.sendMessage(a,{cmd:"pong"}),d()},1e3)}return!0})}var a="gcemmlojgdikdgfkmaphkenamfhonlid",b="ekgaebaencakkggokbokmgojdbafnefi",c,d,e=!1,f=!1;chrome.runtime.onInstalled.addListener(function(c){c=c||{},c.reason==="install"&&chrome.management.getSelf(function(c){c.id===a&&(chrome.runtime.onMessageExternal.addListener(function(a,c,d){if(c.id!=b)return!1;switch(a.cmd){case"launchApp":n({launchSource:"trial_thank"}),d({removeYourself:a.removeTrial});break;case"pong":setTimeout(function(){chrome.runtime.sendMessage(b,"ping")},1e3)}return!0}),chrome.runtime.sendMessage(b,"event_fullAppInstalled"),chrome.runtime.sendMessage(b,"ping"))})}),chrome.app.runtime.onLaunched.addListener(function(a){a=a||{},n({launchSource:a.source})})}()