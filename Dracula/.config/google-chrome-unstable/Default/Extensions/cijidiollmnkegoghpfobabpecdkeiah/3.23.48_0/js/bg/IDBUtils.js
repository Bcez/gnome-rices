function handleDbError(e,t,n){n?console.error("IDB_ERROR: ",{method:t,action:e,name:n.name,reason:n.message}):console.error("IDB_ERROR: ",{method:t,action:e})}var IDBUtils={DB_NAME:"local-storage",VERSION:1,VIDEO_STORE:"recorded-videos"};IDBUtils.init=function(e){idb.open(IDBUtils.DB_NAME,IDBUtils.VERSION,function(e){handleDbError("open","init",e)},function(t){if(t.objectStoreNames.contains(IDBUtils.VIDEO_STORE))console.log("datastore already exists");else{t.createObjectStore(IDBUtils.VIDEO_STORE,{keyPath:"id",autoIncrement:!0}).createIndex("videoKey","videoKey",{unique:!1}),console.log("creating datastore.")}e&&e()})},IDBUtils.putRecordedVideoBlob=function(e,t,n){idb.open(IDBUtils.DB_NAME,IDBUtils.VERSION,function(e){handleDbError("open","putRecordedVideoBlob",e)}).then(function(n){var o=n.transaction(IDBUtils.VIDEO_STORE,"readwrite"),r=o.objectStore(IDBUtils.VIDEO_STORE),i={videoKey:e,blob:t};return r.add(i),o.complete}).then(function(){console.log(e+" blob added to db"),n&&n()}).catch(function(e){handleDbError("store","putRecordedVideoBlob",e)})},IDBUtils.clearLocalVideo=function(e,t){idb.open(IDBUtils.DB_NAME,IDBUtils.VERSION,function(e){handleDbError("open","clearLocalVideo",e)}).then(function(t){return t.transaction(IDBUtils.VIDEO_STORE,"readwrite").objectStore(IDBUtils.VIDEO_STORE).index("videoKey").openCursor(e)}).then(function e(t){if(t)return t.delete(),t.continue().then(e)}).then(function(){console.log("localvideo "+e+" deleted"),t&&t()}).catch(function(e){handleDbError("store","clearLocalVideo",e)})},IDBUtils.clearAllLocalVideos=function(){var e=performance.now();idb.open(IDBUtils.DB_NAME,IDBUtils.VERSION,function(e){handleDbError("open","clearAllLocalVideos",e)}).then(function(e){return e.transaction(IDBUtils.VIDEO_STORE,"readwrite").objectStore(IDBUtils.VIDEO_STORE).clear()}).then(function(){console.log("time for clearing store : ",performance.now()-e)}).catch(function(e){handleDbError("store","clearAllLocalVideos",e)})},IDBUtils.getKeys=function(e,t){var n=[];idb.open(IDBUtils.DB_NAME,IDBUtils.VERSION,function(e){handleDbError("open","getKeys",e)}).then(function(t){return t.transaction(IDBUtils.VIDEO_STORE,"readonly").objectStore(IDBUtils.VIDEO_STORE).index("videoKey").openCursor(e)}).then(function e(t){if(t)return n.push(t.value.id),t.continue().then(e)}).then(function(){t(n)}).catch(function(e){handleDbError("store","getKeys",e)})},IDBUtils.getBlob=function(e,t){idb.open(IDBUtils.DB_NAME,IDBUtils.VERSION,function(e){handleDbError("open","getBlob",e)}).then(function(t){return t.transaction(IDBUtils.VIDEO_STORE,"readonly").objectStore(IDBUtils.VIDEO_STORE).get(e)}).then(function(e){t(e.blob)}).catch(function(e){handleDbError("store","getBlob",e)})},IDBUtils.getTotalCount=function(e){idb.open(IDBUtils.DB_NAME,IDBUtils.VERSION,function(e){handleDbError("open","getTotalCount",e)}).then(function(e){return e.transaction(IDBUtils.VIDEO_STORE,"readonly").objectStore(IDBUtils.VIDEO_STORE).count()}).then(function(t){e(t)}).catch(function(e){handleDbError("store","getTotalCount",e)})},IDBUtils.isKeysPresent=function(e,t){function n(){var i=e.shift();if(void 0==i)return void(0===r?t(!0,!0):t(!1,r<o));idb.open(IDBUtils.DB_NAME,IDBUtils.VERSION,function(e){handleDbError("open","isKeysPresent",e)}).then(function(e){return e.transaction(IDBUtils.VIDEO_STORE,"readonly").objectStore(IDBUtils.VIDEO_STORE).index("videoKey").count(i)}).then(function(e){e>0&&r--,n()}).catch(function(e){handleDbError("store","isKeysPresent",e)})}var o=e.length,r=e.length;n(e)};