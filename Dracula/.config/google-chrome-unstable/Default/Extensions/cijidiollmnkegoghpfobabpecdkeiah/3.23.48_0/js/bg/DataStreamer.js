function DataStreamer(t,e,i,o){this.initiator=t,this.tabId=e,this.sourceCount=i,this.chunkSize=o||5242880,this.completedCount=0,this.startedStreaming={},this.blobs={}}DataStreamer.prototype.onDataAvailable=function(t,e,i,o){if("generic_embed"==this.initiator||"lessonly"==this.initiator){1!=this.startedStreaming[t]&&(messageTab(this.tabId,t+"-start"),this.startedStreaming[t]=!0,this.blobs[t]=[]),e&&this.blobs[t].push(e);var s=new Blob(this.blobs[t],{type:"video/webm"});if(s.size>this.chunkSize||i&&s.size>0){this.blobs[t]=[];var a=this;CommonUtils.blobToDataUrl(s,function(e){messageTab(a.tabId,t+"-part",e),o&&o()})}else i&&o&&o()}},DataStreamer.prototype.downloadBlobs=function(t,e){function o(t,e,i){try{var s=t.shift();if(void 0==s)return void i(e);IDBUtils.getBlob(s,function(s){e.push(s),o(t,e,i)})}catch(t){console.error("Download video error",{error:t})}}function s(t){t&&n.push(t),l.length>0?a(l):e(n)}function a(t){uploader=t.pop();var e=uploader.videoId,i=uploader.type;IDBUtils.getKeys(e,function(t){console.info("keys for sending from local for videokey : "+e,{k:t}),o(t,[],function(t){if(t.length>0){var e=URL.createObjectURL(new Blob(t,{type:"video/webm"}));s({type:i,url:e})}else s(!1)})})}var n=[],r=t.getUploaders(),l=[];for(i=0;i<r.length;i++)l.push(r[i]);a(l)},DataStreamer.prototype.finish=function(t,e){if("generic_embed"==this.initiator||"lessonly"==this.initiator){var i=this;this.onDataAvailable(t,void 0,!0,function(){messageTab(i.tabId,t+"-end"),++i.completedCount>=i.sourceCount&&e()})}};