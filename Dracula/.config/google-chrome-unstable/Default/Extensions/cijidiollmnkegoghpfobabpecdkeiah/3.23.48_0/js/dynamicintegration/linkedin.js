var injectedAlready=document.getElementById("hippowiz-linkedin-injected"),HIPPO_ICON={linkedinChatBox:"<div class='hv-embed-main-container'><button id='hippo_video_button' data-ref='hv-embed-main-container' class='hv-embed-main-icon' data-hint='Hippo Video' type='button'><img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'></button><span class='tooltiptext'>Hippo Video</span></div>",linkedinInbox:"<div class='hv-embed-main-container-static'><button id='hippo_video_button_static' data-ref='hv-embed-main-container' class='hv-embed-main-icon' data-hint='Hippo Video' type='button'><img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image_static'></button><span class='tooltiptext'>Hippo Video</span></div>",recruiterMailBox:"<div class='hv-embed-main-container' style='height: 26px;'><button id='hippo_video_button' data-ref='hv-embed-main-container' class='hv-embed-main-icon' data-hint='Hippo Video' type='button' style='width: 24px;height: 24px;'><img style='width: 16px;height: 16px;' src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'></button><span class='tooltiptext'>Hippo Video</span></div>",linkeinInmailBox:"<div class='hv-embed-main-container' style='width: 4rem;height:4rem;display:flex;justify-content:center;align-items:center'><button id='hippo_video_button' data-ref='hv-embed-main-container' class='hv-embed-main-icon' data-hint='Hippo Video' type='button'><img style='width: 2.4rem;height:2.4rem' src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'></button><span class='tooltiptext'>Hippo Video</span></div>"};if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-linkedin-injected" value=true />';$(hippoCsInjected).appendTo("body"),console.log("injected linkedin script"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:x.serviceName,windowId:x.windowId,tabId:x.tabId}}function i(e,t){if(e.fireEvent)e.fireEvent("on"+t);else{var i=document.createEvent("Events");i.initEvent(t,!0,!1),e.dispatchEvent(i)}}function n(e,i,n){var a=t();a.messageFromContentScript1234=!0,a.msgType="workflow",a.payload={productName:e,playUrl:i,uniqueId:n},a.urlToBeShortened=i,a.fetchShortenUrl=!0,x.port.postMessage(a)}function a(e,t){var i="",n=$(".hv-embed-main-icon[data-random-id="+e+"]");if("recruiter"==t)i=$(n).parents(".base-composer__footer").siblings(".base-composer__content").find(".compose-textarea");else{var a=$(n).parents();i=$(a)[3]}return i}function o(e,t,i){var n=e.videoShareUrl;if(t)n+=n.includes("?")?"&track_id="+i:"?track_id="+i;else{var a=e.mfInVideo,o=e.mfFormValues;if(a.length>0){for(var r="",s=0;s<a.length;s++)r+=encodeURIComponent(a[s])+"="+encodeURIComponent(o[a[s]]),r+=s<a.length-1?"&":"";""!=r&&(n+=n.includes("?")?"&"+r:"?"+r)}}return n+=n.includes("?")?"&_="+Date.now():"?_="+Date.now()}function r(e,t){if(window.location.href.includes("/job-posting/"))$(".ql-editor").append("<p>"+e+"</p>");else{window.location.href.includes("/recruiter/mailbox/conversation/")?recruiterEmailBox=$(".compose-area"):recruiterEmailBox=$(t).find("[name='compose-textarea']");var n=$(recruiterEmailBox).val();n.length>0&&(e=n+"\n"+e),$(recruiterEmailBox).val(e),i($(recruiterEmailBox)[0],"input")}}function s(e,t){for(var n=$(t).find($("textarea[name=message]")),a=$($(n).parent().siblings()[1]).find(".artdeco-button__text"),o=0;o<a.length;o++)if("Send"==$($(a)[o]).text().trim()){$($(a)[o]).parent().removeClass("artdeco-button--disabled"),$($(a)[o]).parent().removeAttr("disabled");break}var r=$(n).val();r&&r.includes(e)||(r.length>0&&(e=r+"\n"+e),$(n).val(e),i($(n)[0],"input"))}function d(e,t){var n=$(t).find(".msg-form__contenteditable"),a=$(t).find(".msg-form__placeholder");if($(a).removeClass("visible"),$(a).addClass("hidden"),$(n).text().length>0)$(n).append("<p>"+e+"</p>");else{var o=$(n).find("br");$(o).remove(),$(n).append("<p>"+e+"</p>")}i($(n)[0],"input")}function l(e){var t=e?$(".mb-1.artdeco-button")[0]:$(".thread-container .mb-1.artdeco-button")[0];$(t).length>0&&0==$(t).parent().find(".hv-embed-main-container").length&&($(HIPPO_ICON.linkedinChatBox).insertBefore($(t)),$(".hv-embed-main-icon").off("click").on("click",h))}function m(e,t){if("inbox"==e){var i=$(".msg-thread--pillar .msg-form__footer").children()[0];if(1==$(".msg-thread--pillar .msg-form__footer").length&&0==$(i).find(".hv-embed-main-container-static").length){var n=$(".msg-thread--pillar .msg-form__footer").find(".msg-form__left-actions.display-flex");$(n).prepend($(HIPPO_ICON.linkedinInbox))}}else if("chatbox"==e){if($(".msg-form__footer.flex-shrink-zero").length>0&&0==$(t).find(".hv-embed-main-container").length){var a=$(t).find(".msg-form__footer.flex-shrink-zero").find(".msg-form__left-actions.display-flex");$(a).prepend($(HIPPO_ICON.linkedinChatBox))}}else"recruiter"==e?$(t).length>0&&0==$(t).find(".hv-embed-main-container").length&&$(t).prepend($(HIPPO_ICON.recruiterMailBox)):"recruiter_mailbox"==e?0==$(".compose-action-bar").find(".hv-embed-main-container").length&&($(".compose-action-bar").prepend($(HIPPO_ICON.recruiterMailBox)),$(".hv-embed-main-container").css("margin-right","6px")):"recruiter_job_posting"==e?$("[data-live-test-rich-text-editor='job-description']").length>0&&0==$("[data-live-test-rich-text-editor='job-description']").find(".hv-embed-main-container").length&&$("[data-live-test-rich-text-editor='job-description']").find("ul.rich-text-editor__toolbar").prepend($("<li>"+HIPPO_ICON.recruiterMailBox+"</li>")):"inMail_salesnav"==e?0==$(".hv-embed-main-container").length&&c():"inMail_message"==e&&0==$(".hv-embed-main-container").length&&$(".msg-inmail-compose-form-v2").children().hasClass("msg-form__subject-line-input-presenter")&&$(t).prepend($(HIPPO_ICON.linkeinInmailBox));$(".hv-embed-main-icon").off("click").on("click",h)}function c(){var e=!1,t=0,i=setInterval(function(){if($('[type="paperclip-icon"]').length>0&&0==$(".hv-embed-main-container").length){e=!0;var n=$('[type="paperclip-icon"]').parent();$(n).before($(HIPPO_ICON.linkedinChatBox)),clearInterval(i),$(".hv-embed-main-icon").off("click").on("click",h)}(++t>200||e)&&clearInterval(i)},500)}function p(e){var i={},n=window.location.href,a="recruiter"!=_()||!(window.location.href.includes("/job-posting/")||$("li.compose-recipients__msg-to-list-item").length>1);if("recruiter"==_())a&&(i=b());else{var o=$(".msg-thread--pillar .msg-form__footer").find(".msg-form__left-actions.display-flex"),r=$(o).find(".hv-embed-main-container-static"),s=$(r).find("#hippo_video_button_static").attr("data-random-id"),d=$(".msg-overlay-bubble-header__title").length>0&&$(".msg-inmail-compose-form-v2").children().hasClass("msg-form__subject-line-input-presenter");n.includes("/messaging/thread")&&s==e?i=v("inbox",e):$(".msg-overlay-bubble-header__title").length>0&&!$(".msg-inmail-compose-form-v2").children().hasClass("msg-form__subject-line-input-presenter")?i=v("messagebox",e):d&&(i=v("inMail_messagebox",e)),n.includes("linkedin.com/sales")&&(i=g(e))}var l=(n.includes("linkedin.com/sales/"),t());l.messageFromContentScript1234=!0,l.initWorkflowPop=!0,l.msgType="workflow",l.payload={logPrefix:x.logPrefix,popType:"sales",popId:"hvLinkedinPop",assetContent:{uniqueId:e,mfFormValues:{"First Name":void 0==i.profileNameData?"":i.profileNameData.split(" ")[0],"Company Name":void 0==i.profileCompanyData?"":i.profileCompanyData.includes(" at ")?i.profileCompanyData.split(" at ")[1]:i.profileCompanyData,Referer:i.messageThreadData,"Profile Link":void 0==i.profileLinkData||""==i.profileLinkData?"":i.profileLinkData.includes(".linkedin.com")?i.profileLinkData:"https://www.linkedin.com"+i.profileLinkData}},popConfig:{showEditOption:!0,showTemplatesOption:!1,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:a,fetchMfInVideo:!0,mandatoryEmailMf:!1,showCustomizeComponent:!0,showLandingPageComponent:!0,showTelePrompter:!0,defaultMergeFields:["First Name"],askDefaultMergeFields:!0,productName:_()}},x.port.postMessage(l)}function f(e){var i=t();i.messageFromContentScript1234=!0,i.messageType="linkedin_dynamic",i.getUTMToken=!0,i.popId=e.popId,i.content=e,i.serviceName=x.serviceName,x.port.postMessage(i)}function h(e){$("#hvLinkedinPop").remove();var t=u();$(e.currentTarget).attr("data-random-id",t),p(t)}function u(){return Math.random().toString(36).substr(2,5)+Date.now()}function v(e,t){var i="",n="",a="",o="";if("messagebox"==e){var r=$(".hv-embed-main-icon[data-random-id="+t+"]").parents(),s=$($(r)[5]).attr("id").split("msg-overlay-conversation-bubble-");o=void 0==s?"":"https://www.linkedin.com/messaging/thread/"+s[1];var d=$($(r)[5]).find($(".msg-overlay-bubble-header__title"));if(""!=(i=$(d).text().trim())){var l=i.split(" ")[0];window.location.href.includes(l.toLowerCase())&&(n=$($(".pv-profile-section__card-item-v2")[0]).find(".pv-entity__secondary-title").text().trim())}""==n&&(n=$($(r)[5]).find(".artdeco-entity-lockup__subtitle.ember-view").text().trim()),a=$(d).find("a").attr("href")}if("inbox"==e&&(n=$(".artdeco-entity-lockup__subtitle.ember-view").text().trim(),i=$("[data-jump-link-target=thread-detail-jump-target]").text().trim(),a=$(".msg-thread__link-to-profile").attr("href"),o=window.location.href),"inMail_messagebox"==e&&(i=$(".msg-compose__profile-link")[0].text.trim(),o="https://www.linkedin.com",a=o+$(".msg-compose__profile-link")[0].pathname),"New message"==i){var r=$(".hv-embed-main-icon[data-random-id="+t+"]").parents();nameSpanCount=$($(r)[4]).find(".msg-connections-typeahead__added-recipients span").children().length,i=2==nameSpanCount?$($(r)[4]).find(".msg-connections-typeahead__added-recipients").text().trim():"",a="",o="https://www.linkedin.com"}return{profileNameData:i,profileCompanyData:n,profileLinkData:a,messageThreadData:o}}function g(e){var t=window.location.href,i="",n="",a="",o="";if($(".message-overlay__conversation").find("#hippo_video_button").attr("data-random-id")==e){var r=$(".hv-embed-main-icon[data-random-id="+e+"]").parents();a=$($(r)[6]).find($("[data-control-name=view_profile]")).attr("href"),i=$($(r)[7]).find($(".mr1.t-14")).text().trim(),i.includes(" with ")&&(i=i.split(" with ")[1]);var s=$($(r)[6]).find($(".artdeco-entity-lockup__subtitle")).text().trim();n=s,o="https://www.linkedin.com"}else if(t.includes("linkedin.com/sales/inbox")){var d=$(".flex.flex-column.full-height.overflow-y-hidden")[0],l=$(d).find("#hippo_video_button").attr("data-random-id");if(l==e){var r=$(".hv-embed-main-icon[data-random-id="+e+"]").parents();a=$($(r)[7]).find($("[data-control-name=view_profile]")).attr("href");var m=$($(r)[7]).find(".ml1.artdeco-entity-lockup__content").find(".artdeco-entity-lockup__title.ember-view span")[0];i=$(m).text().trim();var s=$($(r)[7]).find($($(".artdeco-entity-lockup__subtitle span")[0])).text().trim();n=s,o=window.location.href}}return{profileNameData:i,profileCompanyData:n,profileLinkData:a,messageThreadData:o}}function b(){var e={};if(k.includes("/recruiter/mailbox/conversation/")){e={profileNameData:$(".participant-name").text().trim().split(" ")[0],profileCompanyData:"",profileLinkData:"https://www.linkedin.com"+$(".participant-name")[0].getAttribute("href"),messageThreadData:window.location.href}}else if($("span.compose-recipients__msg-to-list-item").length>0&&$("span.compose-recipients__msg-to-list-item")[0].getAttribute("title")){var t=$("span.compose-recipients__msg-to-list-item")[0].getAttribute("title").split(" "),i=window.location.href.includes("/profile/")?window.location.href:"";e={profileNameData:t[0],profileCompanyData:"",profileLinkData:i,messageThreadData:""}}return e}function _(){var e="linkedin";return window.location.href.includes("linkedin.com/sales/")?e="sales_nav":(window.location.href.includes("linkedin.com/recruiter/")||$(".product-name").length>0&&"recruiter-product"==$(".product-name")[0].getAttribute("data-walkme-id"))&&(e="recruiter"),e}var w={"First Name":"{firstName}","Last Name":"{lastName}"},x=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix=" LINKEDIN_DYNAMIC :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,x.port.postMessage(e)}(),x.port.onMessage.addListener(function(t,i,l){if(msgFromPort=t.backgroundRecordingMessage,"insertFromWorkflowPop"==msgFromPort&&t.data.serviceName==x.serviceName&&t.data.tabId==x.tabId){var m=t.data.workflowConfig;if(!m.popConfig.showMfForm&&window.location.href.includes("/job-posting/"))n(m.popConfig.productName,m.assetContent.videoShareUrl,m.assetContent.uniqueId);else if(m.popConfig.showMfForm||"recruiter"!=m.popConfig.productName)f(t.data.workflowConfig);else{var c=m.assetContent.videoShareUrl,p=m.assetContent.mfInVideo;p.includes("First Name")||p.push("First Name"),p.includes("Last Name")||p.push("Last Name");for(var h="",u=0;u<p.length;u++){var v=w[p[u]]?w[p[u]]:"";h+=encodeURIComponent(p[u])+"="+v,h+=u<p.length-1?"&":""}""!=h&&(c+=c.includes("?")?"&"+h:"?"+h);var g=a(m.assetContent.uniqueId,m.popConfig.productName);r(c,g),$("#hvLinkedinPop").remove()}}if("insertVideoInLinkedinChatBox"==msgFromPort&&t.data.tabId==x.tabId){var b=t.data.content.popConfig.productName,_=t.data.content.assetContent.uniqueId,k=Number(e("hvTabId")),C=t.data.track_id,I=t.data.tabId,y=t.data.status,N=t.data.content.assetContent;if(k==I){var c=o(N,y,C);n(b,c,_)}}if("fetchShortenUrlResponse"==msgFromPort&&t.data.tabId==x.tabId){var P=t.data,g=a(P.payload.uniqueId,P.payload.productName);"sales_nav"==P.payload.productName?s(P.shortenUrl,g):"recruiter"==P.payload.productName?r(P.shortenUrl,g):d(P.shortenUrl,g),$("#hvLinkedinPop").remove()}}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var k;new MutationObserver(function(e,t){k=window.location.href,k.includes("/sales/inbox")?l(!1):k.includes("/sales/people")?l(!0):k.includes("/messaging/thread/")?m("inbox",""):k.includes("/recruiter/mailbox/conversation/")?m("recruiter_mailbox",""):k.includes("/job-posting/")&&m("recruiter_job_posting","");for(var i in e){var n=e[i];$(n.target).hasClass("msg-overlay-conversation-bubble")?m("chatbox",n.target):$(n.target).hasClass("compose-toolbar__left-options")?m("recruiter",n.target):$(n.target).hasClass("compose-form__container")?m("inMail_salesnav",n.target):$(n.target).hasClass("msg-form__left-actions")&&m("inMail_message",n.target)}}).observe(document,{subtree:!0,childList:!0,attributes:!0})})}