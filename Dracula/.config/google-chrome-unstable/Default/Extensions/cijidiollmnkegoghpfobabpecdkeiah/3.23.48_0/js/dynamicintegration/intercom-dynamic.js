var injectedAlready=document.getElementById("hippowiz-intercom-dynamic-injected"),HTML_CONTENT={hippo_button:"<div class='hv-embed-main-container'><button id='hippo_video_button' data-ref='hv-embed-main-container' data-type='record_and_library' class='toolbar-action-component toggle text-editor-extension hint--top hv-embed-main-icon' data-hint='Hippo Video' type='button'><img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'  height='18px' width='18px'> </button><span class='tooltiptext'>Hippo Video</span></div>"},copyToClipboard=void 0;if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-intercom-dynamic-injected" value=true />',copyToClipboardBtn='<button class="copy-to-clipboard" data-clipboard-target="#copy-to-clipboard-btn"></button>';$(hippoCsInjected).appendTo("body"),$(copyToClipboardBtn).appendTo("body"),console.log("injected intercom-dynamic script"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:p.serviceName,windowId:p.windowId,tabId:p.tabId}}function o(e){var t=e.track_id,o=e.content.assetContent.videoShareUrl,a=e.content.assetContent.thumbnailShareUrl,r="",s="";if(1==e.status)if(o.includes("custom_asset_token=")||o.includes("org_tok=")){var d=i(o);if(d){r=o.split("?")[0],s=a.split("?")[0];var c="?track_id="+t;$.each(d,function(e,t){c+="::"+e+"="+t}),o=r+c,a=s+c}}else o+=o.includes("?")?"&track_id="+t:"?track_id="+t,a+=a.includes("?")?"&track_id="+t:"?track_id="+t;else{var p=e.content.assetContent.mfFormValues;if(Object.keys(p).length>0){var l="";for(var m in p)l=l+encodeURIComponent(m)+"="+encodeURIComponent(p[m])+"&";""!=l&&(o+=o.includes("?")?"&"+l:"?"+l,a+=a.includes("?")?"&"+l:"?"+l)}}copyToClipboard&&copyToClipboard.destroy(),jQuery(function(){jQuery(".copy-to-clipboard").click()}),copyToClipboard=new ClipboardJS(".copy-to-clipboard",{target:function(){return n(!0,o,a)}}),copyToClipboard.on("success",function(e){$("#copyLinkWithThumbnailTarget").hide()}),$("#hvIntercomPop").remove()}function i(e){e||(e=location.href);var t=e.indexOf("?"),o=e.indexOf("#");if(-1==o&&-1==t)return{};-1==o&&(o=e.length);var i=-1==t||o==t+1?e.substring(o):e.substring(t+1,o),n={};return i.split("&").forEach(function(e){if(e){e=e.split("+").join(" ");var t=e.indexOf("="),o=t>-1?e.substr(0,t):e,i=t>-1?decodeURIComponent(e.substr(t+1)):"",a=o.indexOf("[");if(-1==a)n[decodeURIComponent(o)]=i;else{var r=o.indexOf("]",a),s=decodeURIComponent(o.substring(a+1,r));o=decodeURIComponent(o.substring(0,a)),n[o]||(n[o]=[]),s?n[o][s]=i:n[o].push(i)}}}),n}function n(e,t,o){if(e)return $("#copyLinkWithThumbnailTarget").remove(),$("body").append('<div id="copyLinkWithThumbnailTarget" aria-hidden="true" tabindex="-1" >'+a(t,o)+"</div>"),document.querySelector("#copyLinkWithThumbnailTarget")}function a(e,t){return'<a href="'+e+'" target="_blank" tabindex="-1"><img src="'+t+'" alt="'+e+'" style="max-height: 200px; max-width: 360px; cursor: pointer;" class="thumbnail-image"></a><div style="padding-top: 7px;"><a href="'+e+'" target="_blank" tabindex="-1" style="cursor: pointer;">Watch Video</a></div><div><br></div>'}function r(e){if(0==$(".hv-embed-main-container").length){var t=window.location.href;"normal_flow"==e?$(".inbox2__composer__container")[0].lastElementChild.lastElementChild.prepend($(HTML_CONTENT.hippo_button)[0]):"resolution_bot"==e&&t.includes("resolution-bot")?$(".operator-flows__editor__step-list__chat-message-editor__inserters").append($(HTML_CONTENT.hippo_button)[0]):"saved_replies"==e&&$(".settings__saved-replies__inserters").append($(HTML_CONTENT.hippo_button)[0]),$(".hv-embed-main-icon").off("click"),$(".hv-embed-main-icon").on("click",c)}}function s(){var e=void 0==$(".inbox__user-profile__name-editor").text()?"":$(".inbox__user-profile__name-editor").text().trim(),o=void 0==$('[data-attribute-id="email"]').attr("data-value")?"":$('[data-attribute-id="email"]').attr("data-value"),i=t();i.messageFromContentScript1234=!0,i.initWorkflowPop=!0,i.msgType="workflow",i.payload={logPrefix:p.logPrefix,popType:"sales",popId:"hvIntercomPop",assetContent:{mfFormValues:{Email:o,"First Name":e}},popConfig:{showEditOption:!0,showTemplatesOption:!1,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:!0,fetchMfInVideo:!0,mandatoryEmailMf:!1,insertVideoText:"COPY TO CLIPBOARD",showCustomizeComponent:!0,showTelePrompter:!0,showLandingPageComponent:!0}},p.port.postMessage(i)}function d(e){var o=e.workflowConfig,i=t();i.messageFromContentScript1234=!0,i.messageType="intercom_dynamic",i.getUTMToken=!0,i.popId=o.popId,i.content=o,i.serviceName=p.serviceName,p.port.postMessage(i)}function c(e){$("#hvIntercomPop").remove(),s()}var p=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix=" INTERCOM_DYNAMIC :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,p.port.postMessage(e)}(),p.port.onMessage.addListener(function(e,t,i){msgFromPort=e.backgroundRecordingMessage,"insertFromWorkflowPop"==msgFromPort&&e.data.serviceName==p.serviceName&&e.data.tabId==p.tabId&&d(e.data),"insertVideoInIntercomChatBox"==msgFromPort&&e.data.serviceName==p.serviceName&&e.data.tabId==p.tabId&&o(e.data)}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){for(var o in e){var i=e[o];$(i.target).hasClass("inbox2__conversation-details-sidebar-section-wrapper")&&r("normal_flow"),$(i.target).hasClass("embercom-composer-editor")&&$(i.target).is("[data-focus-visible-added]")&&r("resolution_bot"),($(i.target).hasClass("ProseMirror")||$(i.target).hasClass("settings__saved-replies__editor f__text"))&&r("saved_replies")}}).observe(document,{subtree:!0,childlist:!0,attributes:!0})})}