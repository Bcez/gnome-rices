document.getElementById("hv-workflow-pop-injected")||($('<input type=hidden id="hv-workflow-pop-injected" value=true />').appendTo("body"),$(document).ready(function(){function e(e){var o=document.getElementById(e);if(o&&o.getAttribute("value"))return o.getAttribute("value")}function o(){return{serviceName:T.serviceName,windowId:T.windowId,tabId:T.tabId}}function t(e){return e.serviceName==T.serviceName&&e.tabId==T.tabId&&e.windowId==T.windowId}function n(e,o){if(e){if(o.popConfig||(o.popConfig={}),o.popConfig.showVideoPageLibrary=!1,$("#"+o.popId).length>0&&$("#"+o.popId).remove(),k(o.popId,!0,[],o.popConfig.customAppendingElementDetails),u(o),h(o),$("#"+o.popId).data("workflowConfig",o),$("#"+o.popId).find(".hv-wf-pop-footer .right-btn-container").prepend($(y.alertMsgEle)),$("#"+o.popId).find(".hv-wf-pop-header").append($(y.workflowPopTopbar)),o.popConfig.showInsertNote){var t=y.noteForInsertVideo.replace("{insertVideoNote}",o.popConfig.insertNoteText);$("#"+o.popId).find(".hv-wf-pop-footer .right-btn-container").after(t)}c(o),d(o),r(),m(o.logPrefix,"Workflow Pop Init Button Clicked")}else b("initPop",o)}function i(e){$("#"+e.popId).remove()}function a(e,o){if(e){var t=0==$("#"+o.popId).length;t||(t=g(o)),t?(n(!0,o),s(o,"hv-create-video","edit")):s(o,o.openPopConfig.targetScreen,o.openPopConfig.targetMode),$("#"+o.popId).show()}else b("openPop",o)}function p(e,o){e?(k(o.popId,o.hasCancelBtn,o.buttons,void 0),$("#"+o.popId).show()):b("createAccessPop",o)}function s(e,t,n){var i=o();i.messageFromContentScript1234=!0,i.msgType="workflow",i.screenName=t,i.mode=n,i.popScreenSwitch=!0,i.workflowConfig=e,i.popId=e.popId,T.port.postMessage(i)}function r(){setTimeout(function(e){$("#hv-wf-embed-iframe").remove(),$("#hippovideo-preview-iframe-injected").remove();var t=o();t.messageFromContentScript1234=!0,t.injectWfPreviewPopScripts=!0,T.port.postMessage(t)},500)}function d(e){var t=o();t.messageFromContentScript1234=!0,t.msgType="workflow",t.popScreenSwitch=!0,t.screenName="hv-create-video",t.mode="create",t.popId=e.popId,t.workflowConfig=e,T.port.postMessage(t)}function c(e){var o=$("#"+e.popId).find(".hv-wf-pop-header .hv-wf-topbar");if($(o).append($(y.createVideoTopbarEle)),e.popConfig.showEditOption&&($(o).append($(y.personalizationTopbarSep)),$(o).append($(y.editVideoTopbarEle))),e.popConfig.showTemplatesOption){e.popConfig.showEditOption?$(o).append($(y.editVideoTopbarEleSep)):$(o).append($(y.personalizationTopbarSep));$(o).append($(y.templatesTopbarEle))}e.popConfig.showContactsOption&&($(o).append($(y.personalizationTopbarSep)),$(o).append($(y.contactsTopbarEle))),$(o).attr("pop-id",e.popId),$(o).find(".hv-pop-topbar-ele").off("click").on("click",l)}function l(e){if(!$(e.currentTarget).hasClass("click-not-allowed")){var o=$(e.currentTarget).parent().attr("pop-id"),t=$("#"+o).find(".hv-wf-pop-header .tp-selected").attr("screen-name"),n=$(e.currentTarget).attr("screen-name");if($("#"+o).find("#templateMfCancelBtn")&&$("#"+o).find("#templateMfCancelBtn").click(),t!==n){var i={};i.currentSelection=n;var a=f(t);i.previousSelection=a.screen,i.actionMode=a.mode;var p=f(n);i.targetScreen=p.screen,i.targetMode=p.mode,v(o,i)}}}function v(e,t){var n=o();n.messageFromContentScript1234=!0,n.msgType="workflow",n.handleTopMenuClick=!0,n.popId=e,n.menuClickMetadata=t,T.port.postMessage(n)}function f(e){return data={},"create-video"===e?(data.screen="hv-create-video",data.mode="create"):"edit-video"===e?(data.screen="hv-create-video",data.mode="edit"):"templates"===e?(data.screen="hv-templates",data.mode="templates"):"contacts"===e&&(data.screen="hv-contacts",data.mode="contacts"),data}function g(e){var o=e.popType==$("#"+e.popId).attr("pop-type");if(e.popConfig.popReinitConditions)for(var t=e.popConfig.popReinitConditions,n=0;n<t.length;n++)if(e.assetContent[t[n]]){var i=$("#"+e.popId).attr(t[n]);o=o&&i==e.assetContent[t[n]]}return!o}function m(e,t){var n=o();n.messageFromContentScript1234=!0,n.trackWorkflowActivity=!0,n.msgType="workflow",n.actionName=e+" "+t,T.port.postMessage(n)}function h(e){$("#"+e.popId).find("#"+e.popId+"CancelBtn").attr("pop-id",e.popId).attr("log-prefix",e.logPrefix),$("#"+e.popId).find("#"+e.popId+"CancelBtn").off("click").on("click",function(e){messageEmbeddedFrame("hv_pause_video");var o=$(e.currentTarget).attr("pop-id"),t=$(e.currentTarget).attr("log-prefix");$("#"+o).hide(),$("#"+o).find(".hv-create-video-container").find(".vid-preview-container iframe").removeAttr("src"),m(t,"Pop Cancel Button Clicked"),w(o)})}function w(e){var t=o();t.messageFromContentScript1234=!0,t.cancelFromWorkflowPop=!0,t.msgType="workflow",t.popId=e,T.port.postMessage(t)}function u(e){if(e.popConfig.popReinitConditions)for(var o=e.popConfig.popReinitConditions,t=0;t<o.length;t++)e.assetContent[o[t]]&&$("#"+e.popId).attr(o[t],e.assetContent[o[t]]);$("#"+e.popId).attr("pop-type",e.popType)}function b(e,t){var n=o();n.msgType="workflow",n.messageFromContentScript1234=!0,n.checkAuth=!0,n.sucessCallbackFnName=e,n.successCallbackFnParams=t,T.port.postMessage(n)}function C(){var e=$("#hvWorkflowSignInPop");0==e.length&&(k("hvWorkflowSignInPop",!0,[{name:_.signIn,id:"workflowSignInButton",type:"primary"}],void 0),e=$("#hvWorkflowSignInPop"),e.find(".hv-wf-pop-body .hv-wf-pop-content").append($(y.signInHtml)),e.find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(50),e.find("#workflowSignInButton").off("click").on("click",function(e){I(),$("#hvWorkflowSignInPop").hide()}),e.find("#hvWorkflowSignInPopCancelBtn").off("click").on("click",function(e){$("#hvWorkflowSignInPop").hide()})),e.show()}function I(){var e=o();e.messageFromContentScript1234=!0,e.openUrl=!0,e.url=P+"/users/sign_in",T.port.postMessage(e)}function k(e,o,t,n){var i=y.popTemplate;i=i.replace("{id}",e);var a=!1;if(n&&"class"==n.attributeName&&$("."+n.attributeValue).length>0&&(a=!0,$("."+n.attributeValue).append($(i))),a||$("body").append($(i)),o&&($("#"+e).find(".hv-wf-pop-footer").append($(y.cancelBtn)),$("#"+e).find(".hv-wf-pop-footer").find(".pop-cancel-btn").attr("id",e+"CancelBtn")),t&&t.length>0){$("#"+e).find(".hv-wf-pop-footer .right-btn-container").show();for(var p=0;p<t.length;p++){var s=$(y.buttonEle);$(s).attr("id",t[p].id),$(s).find("span").text(t[p].name),$("#"+e).find(".hv-wf-pop-footer .right-btn-container").append($(s)),$("#"+e).find(".hv-wf-pop-footer .right-btn-container").find("#"+t[p].id).addClass(t[p].type+"-btn")}}}var T=function(){var o={};return o.serviceName=e("hvIntegName"),o.windowId=Number(e("hvWindowId")),o.tabId=Number(e("hvTabId")),o.port=chrome.extension.connect({name:o.serviceName+"::"+o.windowId+"::"+o.tabId+"::workflow_pop"}),o}(),P="cijidiollmnkegoghpfobabpecdkeiah"===chrome.runtime.id?"https://www.hippovideo.io":"dnebjjdbjiikcmihpkcanphpbibhofkh"===chrome.runtime.id?"https://stage.hippowiz.com":"http://localhost:3000",_={cancel:chrome.i18n.getMessage("cancel_text"),signInText:chrome.i18n.getMessage("take_a_shift_from_boring_to_mind_-_blowing_emails_._boost_your_customer_engagement_and_sales_conversions_with_personalized_videos"),signIn:chrome.i18n.getMessage("signIn"),contacts:chrome.i18n.getMessage("contacts_text"),templates:chrome.i18n.getMessage("templates"),create:chrome.i18n.getMessage("create"),edit:chrome.i18n.getMessage("customize"),cancel:"CANCEL",signInText:"Take a shift from boring to mind-blowing emails. Boost your customer engagement and sales conversions with personalized videos.",signIn:"SIGN IN",contacts:"Contacts",templates:"Email Templates",create:"Create",edit:"Customize"},y={popTemplate:'<div id="{id}" class="hv-wf-pop-screen"><div class="hv-wf-pop"><div class="hv-wf-edit-mode-header" style="display:none"><div><span class="hv-edit-mode-title"></span></div></div><div class="hv-wf-pop-header"></div><div class="hv-wf-pop-body"><div class="hv-wf-pop-loading"><div class="pop-loading"><div></div><div></div><div></div><div></div></div></div><div class="hv-wf-pop-content"></div></div><div class="hv-wf-pop-footer"><div class="right-btn-container"></div></div><div id="virtual-bg-sidebar"></div></div></div>',cancelBtn:'<div class="pop-cancel-btn">'+_.cancel+"</div>",buttonEle:'<div class="pop-btn-ele"><span></span></div>',signInHtml:'<div class="sign-in-container"><div class="image"><img src="'+chrome.extension.getURL("/images/injected/hippo-video-logo.svg")+'"></div><div class="content">'+_.signInText+"</div></div>",alertMsgEle:'<div class="hv-alert-msg-ele"><div class="container"><div class="alert-msg"></div></div></div>',workflowPopTopbar:'<div class="hv-wf-topbar"></div>',createVideoTopbarEle:'<div class="hv-pop-topbar-ele hv-create-video" data-action="create" screen-name="create-video"><div class="img-container"><img src="'+chrome.extension.getURL("/images/injected/create-icon.png")+'"></div><div class="text">'+_.create+"</div></div>",editVideoTopbarEle:'<div class="hv-pop-topbar-ele hv-edit-video click-not-allowed" data-tooltip="'+_.editDisableContent+'" data-action="edit" screen-name="edit-video"><div class="img-container"><img src="'+chrome.extension.getURL("/images/injected/edit-icon.png")+'"></div><div class="text">'+_.edit+"</div></div>",templatesTopbarEle:'<div class="hv-pop-topbar-ele hv-templates click-not-allowed email-template" data-tooltip="'+_.templateDisableContent+'" screen-name="templates"><div class="img-container"><img src="'+chrome.extension.getURL("/images/injected/template-icon.svg")+'"></div><div class="text">'+_.templates+"</div></div>",contactsTopbarEle:'<div class="hv-pop-topbar-ele hv-contacts click-not-allowed" data-tooltip="'+_.contactDisableContent+'" screen-name="contacts"><div class="img-container"><img src="'+chrome.extension.getURL("/images/injected/contacts-icon.png")+'"></div><div class="text">'+_.contacts+"</div></div>",personalizationTopbarSep:'<div class="separator"><img src="'+chrome.extension.getURL("/images/injected/arrow.png")+'"></div>',editVideoTopbarEleSep:'<div class="separator edit-video-separator"><img src="'+chrome.extension.getURL("/images/injected/arrow.png")+'"></div>',noteForInsertVideo:'<div id="insertNote" class="insert-note">{insertVideoNote}</div>'};T.port.onMessage.addListener(function(e,o,s){if(e){var r=e.backgroundRecordingMessage,d=e.data||{};if("forceDestroyWFP"==r&&d.tabId==T.tabId&&d.windowId==T.windowId&&$(".hv-wf-pop-screen").remove(),t(d)){if("initWorkflowPop"==r&&n(!1,d.payload),"destroyWorkflowPop"==r&&i(d.payload),"openWorkflowPop"==r&&a(!1,d.payload),"authcheckResponse"==r)if(d.status&&d.response.status){var c=d.successCallbackFnParams||{};c.planParams=c.planParams||{},c.planParams.isVideoPagesEnabled=d.response.is_video_pages_enabled,c.planParams.isVirtualBgEnabled=d.response.is_virtualbg_enabled,c.planParams.isFreeUser=d.response.is_free_user,c.planParams.isPersonalizationEnabled=d.response.feature_params.personalization_edit,c.popConfig=c.popConfig||{},c.popConfig.showLandingPageComponent=c.popConfig.showLandingPageComponent&&c.planParams.isVideoPagesEnabled,c.popConfig.showThumbnailComponent=d.response.is_custom_thumbnail_enabled,c.popConfig.showCustomizeComponent=c.popConfig.showCustomizeComponent&&(c.popConfig.showLandingPageComponent||c.popConfig.showThumbnailComponent),c.popConfig.showTemplatesOption=c.popConfig.showTemplatesOption&&d.response.is_email_templates_enabled,"initPop"==d.sucessCallbackFnName?n(!0,c):"openPop"==d.sucessCallbackFnName?a(!0,c):"createAccessPop"==d.sucessCallbackFnName&&p(!0,c)}else C();"createAccessPop"==r&&p(!1,d),"createSigninPop"==r&&C()}}})}));