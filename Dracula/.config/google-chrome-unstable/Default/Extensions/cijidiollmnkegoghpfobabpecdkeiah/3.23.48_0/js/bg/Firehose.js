function _updateConfig(){return _getFederateToken(function(){AWS.config.update({region:"us-east-1",credentials:new AWS.CognitoIdentityCredentials({IdentityId:CognitoConfig.identity_id,Logins:{"cognito-identity.amazonaws.com":CognitoConfig.token},httpOptions:{timeout:1e4}}),httpOptions:{timeout:1e4}}),StreamName=CognitoConfig.stream_name,firehose=new AWS.Firehose})}function _getFederateToken(e){return new Promise(function(t,n){CognitoConfig=function(t,n){function o(){e&&e(),t&&t()}function i(e){var t=new Date,n=new Date(e);return t.getTime()>=n.getTime()}function r(e){try{chrome.storage.local.set({"hv-firehose-token":JSON.stringify({value:e,expiry:new Date((new Date).getTime()+6e5)})})}catch(e){}}chrome.storage.local.get(["hv-firehose-token"],function(e){if(e["hv-firehose-token"]){var t=JSON.parse(e["hv-firehose-token"]);i(t.expiry)?(chrome.storage.local.remove("hv-firehose-token"),APIClient.getFirehoseFederateToken(function(e){delete e.status,CognitoConfig=e,r(e),o()})):(CognitoConfig=t.value,o())}else APIClient.getFirehoseFederateToken(function(e){delete e.status,CognitoConfig=e,r(e),o()})})}(t,n)})}function _fallback(e){Array.isArray(e)||(e=[e]);var t=[];if(Array.isArray(e))for(var n=0;n<e.length;n++)t.push(_formatFallbackLog(e[n]));else t.push(_formatFallbackLog(e));LoggingUtils.pushLogToServer(t)}function _formatFallbackLog(e){var t,n=LoggingUtils.Severity.ALL,o=getZuluTimeInUTC();try{n=e[LoggingUtils.Constants.LOG_TYPE],o=e[LoggingUtils.Constants.DATE_TIME],t=chrome.runtime.getManifest().version+" : "+o+" : "+JSON.stringify(e)}catch(e){t=chrome.runtime.getManifest().version+" : "+o+" : "+JSON.stringify(e)}return{authoringAssetId:LoggingUtils.clientLogsAssetId,description:n,stackTrace:t}}function getZuluTimeInUTC(){return(new Date).toISOString().replace("T"," ").slice(0,23)}var CognitoConfig={},StreamName,firehose=null;pushLogRecord=function(e){_updateConfig().then(function(){var t={Record:{Data:"_"+getZuluTimeInUTC()+"_\t"+JSON.stringify(e)},DeliveryStreamName:StreamName};firehose.putRecord(t,function(e,n){e&&LoggingUtils.saveFailedLog(t)})})},pushLogRecordInBatch=function(e,t){_updateConfig().then(function(){var n={Records:e,DeliveryStreamName:StreamName};firehose.putRecordBatch(n,t||function(e,t){})})};