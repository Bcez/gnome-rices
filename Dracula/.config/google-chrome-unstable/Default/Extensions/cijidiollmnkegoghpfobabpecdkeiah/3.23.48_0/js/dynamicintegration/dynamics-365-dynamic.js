var injectedAlready=document.getElementById("hippowiz-dynamics-365-dynamic-injected"),HTML_CONTENT={hippo_button:'<td nowrap="" class="htmlBtnStyle htmlBarUnselectable hv-embed-main-container" style="width: 24px; border: 1px solid transparent;"><a class="htmlAnchorStyle htmlBarUnselectable" href="javascript:void(0)" title="Hippo Video"><img src="'+chrome.extension.getURL("/images/injected/video-icon-orange-small.svg")+'" class="htmlImgStyle htmlBarUnselectable" width="15px" height="17px"></a></td>'},REPORT_HTML={hippo_report_button:'<div data-z-index="20" role="presentation" class="hv-report-icon-wrapper"><div role="presentation" class="hv-report-content flexbox"><div class="hv-reports-icon-container flexbox"><button class="hv-integration-reports flexbox"><img src="'+chrome.extension.getURL("/images/injected/hv-integration-reports.svg")+'" height="18px" width="18px" class="report-icon"></button></div></div><div role="presentation" class="hv-reports-text flexbox">Video Reports</div></div><div role="presentation" class="outer-separator"><div role="presentation" class="inner-separator flexbox"></div></div>'},copyToClipboard=void 0;if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-dynamics-365-dynamic-injected" value=true />',copyToClipboardBtn='<button class="copy-to-clipboard" data-clipboard-target="#copy-to-clipboard-btn" style="display:none;"></button>';$(hippoCsInjected).appendTo("body"),$(copyToClipboardBtn).appendTo("body"),console.log("injected dynamics-365-dynamic script"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:m.serviceName,windowId:m.windowId,tabId:m.tabId}}function o(e,t){return $("#copyLinkWithThumbnailTarget").remove(),$("body").append('<div id="copyLinkWithThumbnailTarget" aria-hidden="true" tabindex="-1" >'+i(e,t)+"</div>"),document.querySelector("#copyLinkWithThumbnailTarget")}function i(e,t){return'<a href="'+e+'" target="_blank" tabindex="-1"><img src="'+t+'" alt="'+e+'" style="cursor: pointer;" width="360" height="200"></a><div><a href="'+e+'" target="_blank" tabindex="-1" style="cursor: pointer;">Watch Video</a></div><div><br></div>'}function n(){var e=t();e.messageFromContentScript1234=!0,e.messageType="dynamics-365-dynamic",e.injectIframeHandler=!0,m.port.postMessage(e)}function r(e){return $(e.target).attr("data-lp-id").includes("emailaddress")&&($(e.target).attr("data-lp-id").includes("|lead")||$(e.target).attr("data-lp-id").includes("|contact"))}function a(){var e=0,t=setInterval(function(){if(e++,$('[data-id="headerContainer"]').length>0)if(0==$(".hv-integration-reports").length){clearInterval(t);var o=$($('[data-id="headerContainer"]')[0]).siblings()[0];$($(o).children()[0]).prepend($(REPORT_HTML.hippo_report_button)),$(".hv-integration-reports").off("click").on("click",p)}else clearInterval(t);e>700&&clearInterval(t)},25)}function d(){var e=t();e.messageFromContentScript1234=!0,e.initWorkflowPop=!0,e.msgType="workflow",e.payload={initiatedFromTemplate:l(),logPrefix:m.logPrefix,popType:"sales",popId:"hvDynamics365Pop",assetContent:{},popConfig:{showEditOption:!0,showTemplatesOption:!1,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:!1,fetchMfInVideo:!0,mandatoryEmailMf:!1,insertVideoText:"COPY TO CLIPBOARD",showCustomizeComponent:!0,showTelePrompter:!0,showLandingPageComponent:!0}},m.port.postMessage(e)}function s(e,o){var i=t();i.messageFromContentScript1234=!0,i.initReportPop=!0,i.randomId="",i.msgType="workflow",i.reportBtn="hv-integration-reports",i.contactEmail=e,i.contactName=o,i.payload={popId:"hvDynamics365ReportPop",logPrefix:m.logPrefix},m.port.postMessage(i)}function c(){$("#hvDynamics365Pop").remove(),d()}function p(e){$(".hvDynamics365ReportPop").remove(),$(".hv-integration-reports").attr("disabled",!0),s($('[aria-label="Email"]').val(),$('[aria-label="First Name"]').val())}function l(){return window.location.href.includes("etn=template")||window.location.href.includes("etn=emailsignature")}var m=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix=" DYNAMICS_365_DYNAMIC :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,m.port.postMessage(e)}(),window.addEventListener("message",function(e){e.data.type&&"hv_init_workflow_pop"==e.data.type&&c()}),m.port.onMessage.addListener(function(e,t,i){if(msgFromPort=e.backgroundRecordingMessage,"insertFromWorkflowPop"==msgFromPort&&e.data.serviceName==m.serviceName&&e.data.tabId==m.tabId){var n=e.data.workflowConfig.assetContent,r=n.videoShareUrl,a=n.thumbnailShareUrl;copyToClipboard&&copyToClipboard.destroy(),jQuery(function(){jQuery(".copy-to-clipboard").click()}),copyToClipboard=new ClipboardJS(".copy-to-clipboard",{target:function(){return o(r,a)}}),copyToClipboard.on("success",function(e){$("#copyLinkWithThumbnailTarget").remove()}),$("#hvDynamics365Pop").remove()}}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){for(var o in e){var i=e[o];void 0!==$(i.target).attr("data-lp-id")&&0==$(".hv-integration-reports").length&&r(i)&&(window.location.href.includes("&id=")||window.location.href.includes("?id="))&&a(),$(i.target).hasClass("fullPageContentEditorFrame")&&n()}}).observe(document,{subtree:!0,childlist:!0,attributes:!0})})}