var injectedAlready=document.getElementById("hippowiz-outlook-dynamic-injected"),HTML_CONTENT={hippo_button:'<div class="ms-OverflowSet-item hippo-video-button-container">      <div class="ms-TooltipHost">        <button type="button" role="menuitem" name="Insert Video" class="hippo-video-button ms-Button ms-Button--commandBar ms-CommandBarItem-link" aria-label="Insert Video" data-is-focusable="true" tabindex="-1">          <span class="ms-Button-flexContainer">            <div role="presentation" aria-hidden="true" class="ms-Icon ms-Icon-imageContainer ms-Button-icon">              <div class="ms-Image"><img src="https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg" class="ms-Image-image is-loaded ms-Image-image--portrait"></div>            </div>          </span>        </button>      </div>    </div>'},CONTENT={refreshPage:"We've released cool new updates. Please reload the page to view them."},HTML_CODE={refreshEle:'<div class="hv-top-error">\t\t\t\t\t\t      <span> '+CONTENT.refreshPage+' </span>\t\t\t\t\t\t      <a href="javascript:void(0)" id="hv-refresh-page">Refresh</a>\t\t\t\t\t      </div>'};if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-outlook-dynamic-injected" value=true />';$(hippoCsInjected).appendTo("body");var port;console.log("injected outlook-dynamic script"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:I.serviceName,windowId:I.windowId,tabId:I.tabId}}function o(e){var t=e.track_id,o=e.content.assetContent,d=o.videoShareUrl,s=o.html,l=o.subject,c=o.thumbnailShareUrl;if(s=a(s,c),1==e.status)d+=d.includes("?")?"&track_id="+t:"?track_id="+t,c+=c.includes("?")?"&track_id="+t:"?track_id="+t;else{var u=o.mfInVideo,p=o.mfFormValues;if(u.length>0){for(var m="",v=0;v<u.length;v++)m=m+encodeURIComponent(u[v])+"="+encodeURIComponent(p[u[v]])+"&";""!=m&&(d+=d.includes("?")?"&"+m:"?"+m,c+=c.includes("?")?"&"+m:"?"+m)}}s=n(s,o.videoShareUrl,d),s=n(s,o.thumbnailShareUrl,c),s=r(s,d),$("[contenteditable='true']").empty(),i(l),e.content.popConfig.signatureContent&&(s+=e.content.popConfig.signatureContent),s="<br><div></div>"+s+"<br><div></div>",$($('[id*="virtualEditScroller"]')[0].children[0]).append(s),$("#hvOutlookPop").remove()}function n(e,t,o){return e.replaceAll(t,o)}function r(e,t){var o='<div style="padding-top: 7px;"><a href="'+t+'"target="_blank" tabindex="-1">Watch Video</a></div>';return e=$('<div id="parent"/>').html(e)[0].outerHTML,e=$(e).find("a[href='"+t+"']").append(o).parent().attr("contenteditable","false").parents("#parent").html()}function i(e){if(void 0!=e){element=$(".ms-TextField-fieldGroup .ms-TextField-field")[0];var t=new Event("input",{bubbles:!0});t.simulated=!0,element.value=e,element.dispatchEvent(t)}}function a(e,t){for(var o=$(e).find("a"),n=0;n<o.length;n++){var r=o[n],i=r.outerHTML.replace(/&amp;/g,"&");i.includes(t)&&(e=e.replace(r.outerHTML,i))}return e}function d(e){var t=$(e).parents(".ms-OverflowSet");0==$(t).find(".hippo-video-button-container").length&&(s(),$(t).prepend($(HTML_CONTENT.hippo_button)),$(t).find(".hippo-video-button").unbind("click").bind("click",m),$(t).find(".hippo-video-button").unbind("mouseenter").bind("mouseenter",b),$(t).find(".hippo-video-button").unbind("mouseleave").bind("mouseleave",w),$("*").bind("scroll",w),$(".rich-text-editor-component button.primary-button.save").addClass("hv-tool-bar-quill-override"))}function s(){var e=$("[contenteditable='true']");$(e).off("mouseup").on("mouseup",l),$(e).off("keyup").on("keyup",l)}function l(e){var t=window.getSelection(),o=t.anchorNode;$(e.currentTarget).parent().find(".hv-current-cursor").removeClass("hv-current-cursor").removeAttr("anchor-offset");var n;1==o.nodeType?n=$(o):3==o.nodeType&&(n=$(o.parentElement)),$(n).addClass("hv-current-cursor").attr("anchor-offset",t.anchorOffset)}function c(e){for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=o.length,r=0;r<e;r++)t+=o.charAt(Math.floor(Math.random()*n));return t}function u(e){var o={},n=$(".ms-BasePicker-text").find("[data-selection-index='0']").find(".ms-Persona-details").children(".ms-Persona-secondaryText").text().trim();n.length>0&&(o.Email=n);var r=t();r.messageFromContentScript1234=!0,r.initWorkflowPop=!0,r.msgType="workflow";var i=v();r.payload={logPrefix:I.logPrefix,popType:"sales",popId:"hvOutlookPop",assetContent:{uniqueId:e,mfFormValues:o},popConfig:{showEditOption:!0,showTemplatesOption:!0,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:!0,defaultHtmlContent:i.html,defaultContentSubject:g(),fetchMfInVideo:!0,mandatoryEmailMf:!0,showTelePrompter:!0,showCustomizeComponent:!0,showLandingPageComponent:!0,signatureContent:i.signatureContent}},I.port.postMessage(r)}function p(e){var o=e.workflowConfig,n=t();n.messageFromContentScript1234=!0,n.messageType="outlook_dynamic",n.getUTMToken=!0,n.popId=o.popId,n.content=o,n.serviceName=I.serviceName,I.port.postMessage(n)}function m(e){$("#hvOutlookPop").remove();var t=c(20);$(e.currentTarget).attr("random-id",t);try{u(t)}catch(e){C(e)}}function v(){var e=$("[contenteditable='true']").clone(),t=e[0].innerHTML,o=h(e);return o&&(f(e),t=$(e)[0].innerHTML),t=t.replace(new RegExp("<div>","g"),"<p>"),t=t.replace(new RegExp("<div ","g"),"<p "),t=t.replace(new RegExp("</div>","g"),"</p>"),{html:t,signatureContent:o}}function f(e){return $(e).find("#Signature").remove(),e}function h(e){var t=null;return $(e).find("#Signature").length>0&&(t=$("<div />").append($(e).find("#Signature")).html()),t}function g(){return $(".ms-TextField-fieldGroup .ms-TextField-field").val()}function b(){var e=function(e){var t=e.getBoundingClientRect(),o=window.pageXOffset||document.documentElement.scrollLeft,n=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+n-44,left:t.left+o-25}}(this),t=e.top,o=e.left;$(".hv-outlook-tooltip").offset({top:t,left:o}),$(".hv-outlook-tooltip").addClass("hv-outlook-tooltipshow")}function w(){$(".hv-outlook-tooltip").removeClass("hv-outlook-tooltipshow")}function C(e){"Extension context invalidated."==e.message?T(HTML_CODE.refreshEle,8e3):console.log(e)}function T(e,t){0==$(".hv-top-error").length&&($(e).appendTo("body"),$("#hv-refresh-page").off("click").on("click",function(){window.location.reload()}),setTimeout(function(){$(".hv-top-error").remove()},t))}var I=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix=" OUTLOOK_DYNAMIC  :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,I.port.postMessage(e)}(),I.port.onMessage.addListener(function(e,t,n){msgFromPort=e.backgroundRecordingMessage,"insertFromWorkflowPop"==msgFromPort&&e.data.serviceName==I.serviceName&&e.data.tabId==I.tabId&&p(e.data),"insertVideoInOutlookMailBox"==msgFromPort&&e.data.serviceName==I.serviceName&&e.data.tabId==I.tabId&&o(e.data)}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){for(var o in e){var n=e[o];$(n.target).hasClass("ms-Button--commandBar")&&$(n.target).attr("name")&&"attach"==$(n.target).attr("name").toLowerCase()&&$(n.target).find("img").length>0&&d(n.target)}}).observe(document,{subtree:!0,childlist:!0,attributes:!0});$('<em class="hv-outlook-tooltip">Insert Video</em>').appendTo("body")})}