var injectedAlready=document.getElementById("hippowiz-trello-injected"),HTML_CONTENT={hippo_button:"<div class='hv-embed-main-container'> <button id='hippo_video_button' data-ref='hv-embed-main-container' data-type='record_and_library' class='toolbar-action-component toggle text-editor-extension hint--top hv-embed-main-icon' data-hint='Hippo Video' type='button'><img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'></button><span class='tooltiptext'>Hippo Video</span></div>"};if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-trello-injected" value=true />';$(hippoCsInjected).appendTo("body");var port;console.log("injected trello script"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:p.serviceName,windowId:p.windowId,tabId:p.tabId}}function o(e){var t=e.data.content.assetContent,o=t.videoShareUrl,n=e.data.track_id,a="";if(e.data.content.assetContent.mfInVideo.length>0)if(1==e.data.status)a=o.includes("?")?o+"&track_id="+n:o+"?track_id="+n;else{var i=e.data.content.assetContent.mfFormValues,r="",m=1;for(mf_d in i)r=1==m?r+encodeURIComponent(mf_d)+"="+encodeURIComponent(i[mf_d]):r+"&"+encodeURIComponent(mf_d)+"="+encodeURIComponent(i[mf_d]),m++;a=o.includes("?")?o+"&"+r:o+"?"+r}return a}function n(e){var o=t();o.messageFromContentScript1234=!0,o.msgType="workflow",o.payload={playUrl:e},o.urlToBeShortened=e,o.fetchShortenUrl=!0,p.port.postMessage(o)}function a(e){var t="",o="";o=$(".comment-box-input.js-new-comment-input").val(),o.length>0?(o+="\n",o+=e,$(".comment-box-input.js-new-comment-input").val(o)):$(".comment-box-input.js-new-comment-input").val(e),t=$(".comment-box-input.js-new-comment-input").height(),$(".comment-box-input.js-new-comment-input").height(t+20),e.length>55&&(t=$(".comment-box-input.js-new-comment-input").height(),$(".comment-box-input.js-new-comment-input").height(t+20)),e.length>110&&(t=$(".comment-box-input.js-new-comment-input").height(),$(".comment-box-input.js-new-comment-input").height(t+20)),$(".primary.confirm.mod-no-top-bottom-margin.js-add-comment").attr("disabled",!1),s(),$("#hvTrelloPop").remove()}function i(){$(".hv-embed-main-container").remove(),$(".comment-box-options").append($(HTML_CONTENT.hippo_button)),$(".hv-embed-main-icon").off("click"),$(".hv-embed-main-icon").on("click",d),$(".rich-text-editor-component button.primary-button.save").addClass("hv-tool-bar-quill-override")}function r(){var e=t();e.messageFromContentScript1234=!0,e.initWorkflowPop=!0,e.msgType="workflow",e.payload={logPrefix:p.logPrefix,popType:"sales",popId:"hvTrelloPop",assetContent:{},popConfig:{showEditOption:!0,showTemplatesOption:!1,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:!0,fetchMfInVideo:!0,mandatoryEmailMf:!1,showCustomizeComponent:!0,showTelePrompter:!0,showLandingPageComponent:!0}},p.port.postMessage(e)}function m(e){var o=e.workflowConfig,n=t();n.messageFromContentScript1234=!0,n.messageType="trello_dynamic",n.getUTMToken=!0,n.popId=o.popId,n.content=o,n.serviceName=p.serviceName,p.port.postMessage(n)}function d(e){$(".window-wrapper.js-tab-parent").attr("data-elevation")&&$(".window-wrapper.js-tab-parent").attr("data-elevation",0),$("#hvTrelloPop").remove(),r()}function s(){$(".window-wrapper.js-tab-parent").length>0&&$(".window-wrapper.js-tab-parent").attr("data-elevation")&&$(".window-wrapper.js-tab-parent").attr("data-elevation",1)}var p=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix=" TRELLO_DYNAMIC :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,p.port.postMessage(e)}(),p.port.onMessage.addListener(function(e,t,i){if(msgFromPort=e.backgroundRecordingMessage,"cancelFromWorkflowPop"==msgFromPort&&"trello"==e.data.serviceName&&e.data.tabId==p.tabId&&s(),"insertFromWorkflowPop"==msgFromPort&&"trello"==e.data.serviceName&&e.data.tabId==p.tabId)if(e.data.workflowConfig.assetContent.mfInVideo.length>0)m(e.data);else{var r=e.data.workflowConfig.assetContent,d=r.videoShareUrl;n(d)}if("insertVideoInTrelloCommentBox"==msgFromPort&&e.data.tabId==p.tabId){n(o(e))}"fetchShortenUrlResponse"==msgFromPort&&e.data.serviceName==p.serviceName&&e.data.tabId==p.tabId&&a(e.data.shortenUrl)}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){for(var o in e){var n=e[o];$(n.target).hasClass("comment-box-input js-new-comment-input")&&i()}}).observe(document,{subtree:!0,childlist:!0,attributes:!0})})}