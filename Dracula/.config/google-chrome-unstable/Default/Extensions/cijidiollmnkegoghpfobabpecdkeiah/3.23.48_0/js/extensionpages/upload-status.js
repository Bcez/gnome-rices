function initUploadStatus(){chrome.runtime.onMessage.addListener(function(e,t,s){if("downloadUrl"===e.msg)for(var o=e.data,a=(new Date).getTime(),n=0;n<o.length;n++){var r=o[n].type,i=o[n].url,l=r+"_"+a+".webm";$("#downloadVideo"+r).attr("href",i),$("#downloadVideo"+r).attr("download",l),$("#downloadVideo"+r).attr("name",l),$("#downloadVideo"+r).removeClass("hide")}return!1}),$("#networkHtml").removeClass("disp-none"),$("#slowUploadText").addClass("hide"),isLessonlyExtension&&$(".upload-status-wrap").addClass("lessonly-status-wrap"),$(".upload-status-wrap").removeClass("force-hide"),statusIntervalId=setInterval(getStatus,1e3),getStatus(),$("#retry-button").click(function(){chrome.runtime.sendMessage({messageFromContentScript1234:!0,retryUpload:!0}),$("#retry-button").addClass("hv-button-loading"),trackInMixpanel("retry upload clicked",{email:userEmail})}),$("#cancelCurrentUpload").click(function(){chrome.runtime.sendMessage({messageFromContentScript1234:!0,cancelUpload:!0}),trackInMixpanel("cancel current upload clicked",{email:userEmail})}),$("#cancel-button").click(function(){$(".pop-retry-main").addClass("hide"),$(".pop-retry-delete").removeClass("hide"),trackInMixpanel("cancel upload clicked",{email:userEmail})}),$("#cancelDelete").click(function(){$(".pop-retry-delete").addClass("hide"),$(".pop-retry-main").removeClass("hide")}),$("#deleteRecording").click(function(){$(".pop-retry-main").addClass("hide"),$(".pop-retry-delete").removeClass("hide"),chrome.runtime.sendMessage({messageFromContentScript1234:!0,reloadExtension:!0})}),$("#reload-button").click(function(){chrome.runtime.sendMessage({messageFromContentScript1234:!0,reloadExtension:!0}),trackInMixpanel("reload extension clicked",{email:userEmail})}),chrome.storage.sync.get(["wizUserEmail","wizAuthToken","wizDigest"],function(e){userEmail=e.wizUserEmail,trackInMixpanel("upload status loaded",{email:userEmail})})}function getStatus(){chrome.runtime.sendMessage({messageFromContentScript1234:!0,getUploadStatus:!0},function(e){if(!e.showWebcamTour){var t,s=!1,o=!1,a=!0,n=chrome.i18n.getMessage("issue_during_recording");if(t=e.progress&&void 0!=e.progress.remainingTime?secondsToString(e.progress.remainingTime):"Calculating ...",isLessonlyExtension&&void 0!=e&&void 0!=e.assetId&&(supportString=" SupportID : "+e.assetId),e)if(e.recordingError)a=!0,s=!1,e.sourceAvailable?(n=chrome.i18n.getMessage("issue_during_recording_source_available"),downloadRequested||(downloadRequested=!0,chrome.runtime.sendMessage({messageFromContentScript1234:!0,getDownloadURL:!0}))):1==e.status&&chrome.runtime.getPlatformInfo(function(e){if("mac"==e.os){var t=chrome.i18n.getMessage("recording_failed_mac");$(".pop-retry-main-message").text(t),t=chrome.i18n.getMessage("recording_failed_note_mac"),$(".pop-retry-note").text(t)}else{var t=chrome.i18n.getMessage("recording_failed");$(".pop-retry-main-message").text(t)}});else if(e.isRecording){$(".upload-failed-container").addClass("hide"),$(".upload-progress-container").removeClass("hide");var r=isNaN(e.progress.progress)?0:Math.round(e.progress.progress);n=chrome.i18n.getMessage("recording_uploaded"),$(".pop-process-loader span").css("width",r+"%"),$(".pop-process-loader em").text("Completing in "+t),a=!1}else if(1==e.status)n=chrome.i18n.getMessage("no_video_uploaded"),$(".upload-failed-container").addClass("hide"),$(".upload-progress-container").removeClass("hide"),a=!1;else if(2==e.status){$(".upload-failed-container").addClass("hide"),$(".upload-progress-container").removeClass("hide");var r=isNaN(e.progress.progress)?0:Math.round(e.progress.progress);$(".pop-process-loader span").css("width",r+"%"),$(".remaining-time").text("Completing in "+t),n=chrome.i18n.getMessage("recorded_video_uploaded"),downloadRequested=!1,o=!0,a=!1}else 3==e.status?(clearInterval(statusIntervalId),chrome.runtime.sendMessage({messageFromContentScript1234:!0,openRecordedVideo:!0,isGuestUser:isGuestUser,isFromExtensionPage:location.href.includes("uploadStatus.html")}),$(".pop-retry-container").length>0&&$(".pop-retry-container").addClass("disp-none"),location.href.includes("uploadStatus.html")&&window.close(),a=!1):4==e.status?(downloadRequested||(downloadRequested=!0,chrome.runtime.sendMessage({messageFromContentScript1234:!0,getDownloadURL:!0})),n=chrome.i18n.getMessage("network_failure_upload_failed"),$(".pop-process-loader span").css("width","0%"),$(".upload-progress-container").addClass("hide"),$(".upload-failed-container").removeClass("hide"),s=!0,o=!0,a=!1):5==e.status&&($(".upload-progress-container").addClass("hide"),$(".upload-failed-container").removeClass("hide"),$(".pop-process-loader span").css("width","0%"),n=chrome.i18n.getMessage("record_or_upload_again"),s=!0,o=!0,a=!1);else o=!0,s=!1;n&&$(".pop-retry-main-message").text(n),5!=e.status&&$("#retry-button").removeClass("hv-button-loading"),s?$("#retry-button").removeClass("hide"):$("#retry-button").addClass("hide"),o?$("#cancel-button").removeClass("hide"):$("#cancel-button").addClass("hide"),a?$("#reload-button").removeClass("hide"):$("#reload-button").addClass("hide")}})}function secondsToString(e){var t=Math.floor(e%3600/60),s=e%60,o=Math.floor(e/3600),a=[];return o&&a.push(o+"h"),t&&a.push(t+"m"),a.push(Math.round(s)+"s"),a.join(":")}function trackInMixpanel(e,t){console.log("mixpanel event :: ",e),mixpanel.track(e,t)}!function(e,t){if(!t.__SV){var s=window;try{var o,a,n,r=s.location,i=r.hash;o=function(e,t){return(a=e.match(RegExp(t+"=([^&]*)")))?a[1]:null},i&&o(i,"state")&&(n=JSON.parse(decodeURIComponent(o(i,"state"))),"mpeditor"===n.action&&(s.sessionStorage.setItem("_mpcehash",i),history.replaceState(n.desiredHash||"",e.title,r.pathname+r.search)))}catch(e){}var l,d;window.mixpanel=t,t._i=[],t.init=function(e,s,o){var a=t;for(void 0!==o?a=t[o]=[]:o="mixpanel",a.people=a.people||[],a.toString=function(e){var t="mixpanel";return"mixpanel"!==o&&(t+="."+o),e||(t+=" (stub)"),t},a.people.toString=function(){return a.toString(1)+".people (stub)"},l="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" "),d=0;d<l.length;d++)!function(e,t){var s=t.split(".");2==s.length&&(e=e[s[0]],t=s[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}(a,l[d]);t._i.push([e,s,o])},t.__SV=1.2,s=e.createElement("script"),s.type="text/javascript",s.async=!0,s.src="undefined"!=typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"/js/bg/mixpanel-2-latest.min.js",o=e.getElementsByTagName("script")[0],o.parentNode.insertBefore(s,o)}}(document,window.mixpanel||[]),mixpanel.init("942fd8197d29b30092ef56683ab6cead",{api_host:"https://api.mixpanel.com"});var local="cijidiollmnkegoghpfobabpecdkeiah"!==chrome.runtime.id,isLessonlyExtension=-1!=chrome.runtime.getManifest().name.toLowerCase().indexOf("lessonly"),statusIntervalId,userEmail,downloadRequested=!1,isGuestUser=!1;chrome.storage.sync.get(["wizDigest"],function(e){void 0!==e.wizDigest&&""!==e.wizDigest&&(isGuestUser=!0)});