function setRecordingOptions(e){updateRecordingOptions(e.screenRecord,"screen"),updateRecordingOptions(e.webCam,"webcam"),updateRecordingOptions(e.audio,"audio")}function setRecordingConfiguration(){recordConfiguration={screenRecord:!0,webCam:!1,audio:!0,separateLayer:!1,defaultTab:!1},chrome.storage.sync.get(["userPreferences","recordingDefaults"],function(e){var i=e.userPreferences;void 0!=i&&(void 0!=i.showAdvanced&&(userPreferences.showAdvanced=i.showAdvanced),void 0!=i.webcamVisible&&(userPreferences.webcamVisible=i.webcamVisible),void 0!=i.webcamPreview&&(userPreferences.webcamPreview=i.webcamPreview),void 0!=i.systemAudio&&(userPreferences.systemAudio=i.systemAudio));var o=e.recordingDefaults;void 0!=o&&(recordConfiguration.screenRecord=o.screenRecord,recordConfiguration.webCam=o.webCam,recordConfiguration.audio=o.audio),setRecordingOptions(recordConfiguration)}),$(".hv-embed-recording-option").off("click"),$(".hv-embed-recording-option").on("click",recordingOption)}function updateRecordingOptions(e,i){"screen"==i?(e?$(".hv-embed-screen-toggle-container").show():$(".hv-embed-screen-toggle-container").hide(),recordConfiguration.screenRecord=e):"webcam"==i?(e?$(".hv-embed-webcam-selection-container").show():$(".hv-embed-webcam-selection-container").hide(),recordConfiguration.webCam=e):"audio"==i&&(e?$(".hv-embed-audio-selection-container").show():$(".hv-embed-audio-selection-container").hide(),recordConfiguration.audio=e),saveDefaults(),e?($(".hv-embed-"+i+"-box-live").show(),$(".hv-embed-"+i+"-box").hide()):($(".hv-embed-"+i+"-box-live").hide(),$(".hv-embed-"+i+"-box").show()),recordConfiguration.webCam&&recordConfiguration.screenRecord?$(".hv-embed-webcam-visible-chk-container").show():$(".hv-embed-webcam-visible-chk-container").hide(),recordConfiguration.webCam?$(".hv-embed-webcam-preview-chk-container").show():$(".hv-embed-webcam-preview-chk-container").hide()}function saveDefaults(){chrome.storage.sync.set({recordingDefaults:recordConfiguration},function(){}),chrome.storage.sync.set({userPreferences:userPreferences},function(){})}function recordingOption(e){e&&($(".hv-embed-selected-option:visible").length<=1&&e.currentTarget.classList.contains("hv-embed-selected-option")||(e.currentTarget.classList.contains("hv-embed-screenrecord-btn")?updateRecordingOptions(!recordConfiguration.screenRecord,"screen"):e.currentTarget.classList.contains("hv-embed-webcam-btn")&&videoDeviceAvailable?updateRecordingOptions(!recordConfiguration.webCam,"webcam"):e.currentTarget.classList.contains("hv-embed-audio-btn")&&audioDeviceAvailable&&updateRecordingOptions(!recordConfiguration.audio,"audio")))}function initialize(){isAllVideosEmpty=!1,isMyVideosEmpty=!1,port.onMessage.addListener(function(e,i,o){"authCheck"==e.backgroundRecordingMessage&&_displayPage(e.data.auth),"videoLibrary"==e.backgroundRecordingMessage&&populateVideoLibrary(e.data),"bothstarted"==e.backgroundRecordingMessage&&setRecordingOptions(recordConfiguration),"stopped_recording"==e.backgroundRecordingMessage&&(completedRecording=!0)})}function checkIfUserSignedIn(){port.postMessage({authCheck:!0,messageFromContentScript1234:!0}),initialize()}function checkAndShowWidget(){port.postMessage({authCheck:!0,messageFromContentScript1234:!0})}function _displayPage(e){allUrlsPermission&&(!e&&$(".hv-embed-loginPage").is(":visible")||e&&$(".hv-embed-recording-tab-content").is(":visible")||(e?($(".hv-embed-topbar-block").show(),$(".hv-embed-recording-tab-content").show(),$(".hv-embed-loginPage").hide(),$(".hv-embed-recordPage").show(),$(".hv-embed-recording-tab-content").is(":visible")&&$(".hv-embed-view-videos-link").show(),$(".hv-embed-view-videos-link").off("click"),$(".hv-embed-view-videos-link").on("click",showLibraryPanel),$(".hv-embed-record-video-link").off("click"),$(".hv-embed-record-video-link").on("click",showRecordingPanel)):($(".hv-embed-topbar-block").hide(),$(".hv-embed-loginPage").show(),$(".hv-embed-recordPage").hide(),$(".hv-embed-view-videos-link").hide(),$(".hv-embed-signin").off("click"),$(".hv-embed-signin").on("click",{url:server+"/users/sign_in",type:2},loginClick)),setRecordingConfiguration(),$(".hv-embed-widget-logo-img").attr("src",chrome.runtime.getURL("/images/injected/hippo-video-logo.svg")),$(".hv-embed-topbar-logo").attr("src",chrome.runtime.getURL("/images/injected/hippo-video-logo.svg")),$(".hv-embed-screen-rec-uns-img").attr("src",chrome.runtime.getURL("/images/injected/screen-record-uns.png")),$(".hv-embed-screen-rec-img").attr("src",chrome.runtime.getURL("/images/injected/screen-record.png")),$(".hv-embed-webcam-uns-img").attr("src",chrome.runtime.getURL("/images/injected/webcam-uns.png")),$(".hv-embed-webcam-img").attr("src",chrome.runtime.getURL("/images/injected/webcam.png")),$(".hv-embed-audio-uns-img").attr("src",chrome.runtime.getURL("/images/injected/audio-mic-uns.png")),$(".hv-embed-audio-img").attr("src",chrome.runtime.getURL("/images/injected/audio-mic.png")),$(".hv-embed-note-logo-img").attr("src",chrome.runtime.getURL("/images/injected/logo-16.png")),$(".hv-embed-view-video-image").attr("src",chrome.runtime.getURL("/images/injected/eye.png")),$(".hv-embed-green-round").each(function(){$(this).css("background-image","url("+chrome.runtime.getURL("/images/injected/tick.png")+")")}),$(".hv-embed-widget").css("background","url("+chrome.extension.getURL("/images/injected/rectangle-bg.png")+")"),$(".hv-embed-loading-gif").attr("src",chrome.runtime.getURL("/images/injected/loading.gif")),$(".hv-embed-empty-video-img").attr("src",chrome.runtime.getURL("/images/injected/empty-hippo.png"))))}function loginClick(e){port.postMessage({openUrl:!0,url:e.data.url,messageFromContentScript1234:!0}),$(".hv-embed-widget").hide()}function showLibraryPanel(){$(".hv-embed-empty-video-list").hide(),$(".hv-embed-recording-block").hide(),$(".hv-embed-library-block").show(),$(".hv-embed-video-count").show(),$(".hv-embed-view-videos-link").hide(),$(".hv-embed-record-video-link").show(),$(".hv-embed-tablinks").off("click"),$(".hv-embed-tablinks").on("click",toggleTab),$(".hv-embed-tab-myvideos").hasClass("active")?(currentTab="myvideos",handleMyVideo()):(currentTab="allvideos",handleAllVideo())}function handleCategoryChange(){$(".hv-embed-list-view").hide(),selectedCategory=$(this).val(),$(".hv-embed-video-category-"+selectedCategory).show(),searchVideo($(".hv-embed-search-video").val())}function requestMyVideos(){port.postMessage({fetchVideos:!0,messageFromContentScript1234:!0})}function requestAllVideos(){port.postMessage({fetchVideos:!0,fetchType:"all",messageFromContentScript1234:!0})}function toggleTab(e){var i,o;for($(".hv-embed-lib-tabcontent").hide(),o=document.getElementsByClassName("hv-embed-tablinks"),tabName=e.currentTarget.getAttribute("data-tabName"),"hv-embed-myvideos"==tabName?(currentTab="myvideos",handleMyVideo()):(currentTab="allvideos",$(".hv-embed-video-loading").show(),handleAllVideo()),i=0;i<o.length;i++)o[i].className=o[i].className.replace(" active","");$("."+tabName).show(),e.currentTarget.className+=" active"}function handleMyVideo(){$(".hv-embed-library-block:visible .hv-embed-myvideos").show();var e=$(".hv-embed-myvideos:visible div:visible").length;completedRecording?(requestMyVideos(),requestAllVideos(),completedRecording=!1):0!=e||isMyVideosEmpty||requestMyVideos(),$(".hv-embed-video-count").html(myVideoCount),(0==e&&isMyVideosEmpty||e>0)&&$(".hv-embed-video-loading").hide(),isMyVideosEmpty&&!$(".hv-embed-myvideos-empty-lib").is(":visible")&&$(".hv-embed-myvideos-empty-lib").show()}function handleAllVideo(){$(".hv-embed-library-block:visible .hv-embed-allvideos").show();var e=$(".hv-embed-allvideos:visible div:visible").length;completedRecording?(requestAllVideos(),requestMyVideos()):0!=e||isAllVideosEmpty||requestAllVideos(),$(".hv-embed-video-count").html(allVideoCount),(0==e&&isAllVideosEmpty||e>0)&&$(".hv-embed-video-loading").hide(),isAllVideosEmpty&&!$(".hv-embed-allvideos-empty-lib").is(":visible")&&$(".hv-embed-allvideos-empty-lib").show()}function populateVideoLibrary(e){var i=constructVideoNode(e);0==currentVideoCount?($(".hv-embed-"+e.type+"-empty-lib").show(),"myvideos"==e.type?isMyVideosEmpty=!0:isAllVideosEmpty=!0):("myvideos"==e.type?($(".hv-embed-myvideos .hv-embed-myvideos-copy-key").remove(),$(i).appendTo($(".hv-embed-myvideos")),$(".hv-embed-video-count").html(myVideoCount)):"allvideos"==e.type&&($(".hv-embed-allvideos .hv-embed-allvideos-copy-key").remove(),$(i).appendTo($(".hv-embed-allvideos")),$(".hv-embed-video-count").html(allVideoCount)),$(".hv-embed-"+e.type+"-copy-key").off("click"),$(".hv-embed-"+e.type+"-copy-key").on("click",sendCopyUrlToScript)),$(".hv-embed-video-loading").hide()}function sendCopyUrlToScript(e){if(!$(e.target).hasClass("hv-embed-prev-button")){e.preventDefault(),e.stopPropagation();var i=e.currentTarget,o=$(i).attr("data-copyurl"),t=o?$("."+o):null;null!=t&&port.postMessage({askToInsertVideoLink:!0,copyUrl:$(t).attr("value"),integType:resolveIntegrationType(),messageFromContentScript1234:!0})}}function constructVideoNode(e){var i=e.library,o=$(".hv-embed-library-template").html(),t="";return currentVideoCount=i.length,"allvideos"==e.type?allVideoCount=currentVideoCount:myVideoCount=currentVideoCount,$.each(i,function(i,d){t+=o.replace(/{{id}}/g,d.id).replace(/{{title}}/g,d.title).replace(/{{url}}/g,d.url).replace(/{{created_at}}/g,d.created_at).replace(/{{num_viewed}}/g,d.num_viewed).replace(/{{copy_id}}/g,e.type).replace(/{{thumb}}/g,d.thumb)}),t}function showRecordingPanel(){$(".hv-embed-recording-block").show(),$(".hv-embed-library-block").hide(),$(".hv-embed-video-count").hide(),$(".hv-embed-view-videos-link").show(),$(".hv-embed-record-video-link").hide()}function searchVideo(e){if(selectedCategory){var i=e.toLowerCase();$(".hv-embed-video-category-"+selectedCategory+" .hv-embed-video-title-text").each(function(){var e=$(this).text().toLowerCase();$(this).closest(".hv-embed-list-view")[-1!==e.indexOf(i)?"show":"hide"]()})}showHideEmptyVideo()}function showHideEmptyVideo(){0==$(".hv-embed-"+currentTab+":visible .hv-embed-list-view:visible").length?$(".hv-embed-"+currentTab+"-empty-lib").show():$(".hv-embed-"+currentTab+"-empty-lib").hide()}function resolveIntegrationType(){return"classroom.google.com"==location.host?"google-classroom":location.href.includes("brightspace")?"d2l":void 0}var injectedAlready=document.getElementById("hippowiz-recordandlibwidget-js-injected");if(!injectedAlready){var currentVideoCount,curentTab,myVideoCount=0,allVideoCount=0,completedRecording=!1,isMyVideosEmpty=!1,isAllVideosEmpty=!1,selectedCategory,hippoWidgetJsInjected='<input type=hidden id="hippowiz-recordandlibwidget-js-injected" value=true />';$(hippoWidgetJsInjected).appendTo("body");var local="cijidiollmnkegoghpfobabpecdkeiah"!==chrome.runtime.id,port,server=local?"http://localhost:3000":"https://www.hippovideo.io",recordConfiguration,audioDeviceAvailable=!0,videoDeviceAvailable=!0,authToken,userEmail,digest,allUrlsPermission=!0,userPreferences={showAdvanced:!0,webcamVisible:!0,webcamPreview:!0,systemAudio:!0};chrome.storage.sync.get(["wizUserEmail","wizAuthToken","wizDigest"],function(e){console.log("widget test",e)}),$(document).ready(function(){port=chrome.extension.connect({name:"widgetScript"}),checkIfUserSignedIn()})}