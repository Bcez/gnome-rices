function setRecordingOptions(e){updateRecordingOptions(e.screenRecord,"screen"),updateRecordingOptions(e.webCam,"webcam"),updateRecordingOptions(e.audio,"audio")}function updateRecordingOptions(e,i){"screen"==i?(e?$(".hv-embed-screen-toggle-container").show():$(".hv-embed-screen-toggle-container").hide(),recordConfigurationinWidget.screenRecord=e):"webcam"==i?(e?$(".hv-embed-webcam-selection-container").show():$(".hv-embed-webcam-selection-container").hide(),recordConfigurationinWidget.webCam=e):"audio"==i&&(e?$(".hv-embed-audio-selection-container").show():$(".hv-embed-audio-selection-container").hide(),recordConfigurationinWidget.audio=e),saveDefaults(),e?($(".hv-embed-"+i+"-box-live").show(),$(".hv-embed-"+i+"-box").hide()):($(".hv-embed-"+i+"-box-live").hide(),$(".hv-embed-"+i+"-box").show()),recordConfigurationinWidget.webCam&&recordConfigurationinWidget.screenRecord?$(".hv-embed-webcam-visible-chk-container").show():$(".hv-embed-webcam-visible-chk-container").hide(),recordConfigurationinWidget.webCam?$(".hv-embed-webcam-preview-chk-container").show():$(".hv-embed-webcam-preview-chk-container").hide()}function saveDefaults(){chrome.storage.sync.set({recordingDefaults:recordConfigurationinWidget},function(){}),chrome.storage.sync.set({userPreferences:userPreferences},function(){})}function setRecordingConfiguration(){recordConfigurationinWidget={screenRecord:!0,webCam:!1,audio:!0,separateLayer:!1,defaultTab:!1},chrome.storage.sync.get(["userPreferences","recordingDefaults"],function(e){var i=e.userPreferences;void 0!=i&&(void 0!=i.showAdvanced&&(userPreferences.showAdvanced=i.showAdvanced),void 0!=i.webcamVisible&&(userPreferences.webcamVisible=i.webcamVisible),void 0!=i.webcamPreview&&(userPreferences.webcamPreview=i.webcamPreview),void 0!=i.systemAudio&&(userPreferences.systemAudio=i.systemAudio));var n=e.recordingDefaults;void 0!=n&&(recordConfigurationinWidget.screenRecord=n.screenRecord,recordConfigurationinWidget.webCam=n.webCam,recordConfigurationinWidget.audio=n.audio),canAllowScreenRecord||(recordConfigurationinWidget.screenRecord=!1),setRecordingOptions(recordConfigurationinWidget)}),$(".hv-embed-recording-option").off("click"),$(".hv-embed-recording-option").on("click",recordingOption)}function recordingOption(e){e&&($(".hv-embed-selected-option:visible").length<=1&&e.currentTarget.classList.contains("hv-embed-selected-option")||(e.currentTarget.classList.contains("hv-embed-screenrecord-btn")&&canAllowScreenRecord?updateRecordingOptions(!recordConfigurationinWidget.screenRecord,"screen"):e.currentTarget.classList.contains("hv-embed-webcam-btn")&&videoDeviceAvailable?updateRecordingOptions(!recordConfigurationinWidget.webCam,"webcam"):e.currentTarget.classList.contains("hv-embed-audio-btn")&&audioDeviceAvailable&&updateRecordingOptions(!recordConfigurationinWidget.audio,"audio")))}function initialize(){port.onMessage.addListener(function(e,i,n){"authCheck"==e.backgroundRecordingMessage&&(_displayPage(e.data.auth),canAllowScreenRecord=e.data.plan_params.is_screen_record_enabled),"bothstarted"==e.backgroundRecordingMessage&&setRecordingOptions(recordConfigurationinWidget),"user_recording_preferences"===e.backgroundRecordingMessage&&(void 0==e.data.preference&&e.data.preference=={}||(recordConfigurationinWidget=e.data.preference)),"updated_user_preferences"===e.backgroundRecordingMessage&&(void 0==e.data.recordConfiguration&&e.data.recordConfiguration=={}||(recordConfigurationinWidget=e.data.recordConfiguration))})}function checkIfUserSignedIn(){port.postMessage({authCheck:!0,messageFromContentScript1234:!0}),initialize(),port.postMessage({getUserRecordingPreferences:!0,messageFromContentScript1234:!0})}function checkAndShowWidget(){port.postMessage({authCheck:!0,messageFromContentScript1234:!0})}function _displayPage(e){allUrlsPermission&&(!e&&$(".hv-embed-loginPage").is(":visible")||e&&$(".hv-embed-recording-tab-content").is(":visible")||(e?($(".hv-embed-recording-tab-content").show(),$(".hv-embed-loginPage").hide(),$(".hv-embed-recordPage").show()):($(".hv-embed-loginPage").show(),$(".hv-embed-recordPage").hide(),$(".hv-embed-signin").off("click"),$(".hv-embed-signin").on("click",{url:server+"/users/sign_in",type:2},loginClick)),setRecordingConfiguration(),$(".hv-embed-widget-logo-img").attr("src",chrome.runtime.getURL("/images/injected/hippo-video-logo.svg")),$(".hv-embed-screen-rec-uns-img").attr("src",chrome.runtime.getURL("/images/injected/screen-record-uns.png")),$(".hv-embed-screen-rec-img").attr("src",chrome.runtime.getURL("/images/injected/screen-record.png")),$(".hv-embed-webcam-uns-img").attr("src",chrome.runtime.getURL("/images/injected/webcam-uns.png")),$(".hv-embed-webcam-img").attr("src",chrome.runtime.getURL("/images/injected/webcam.png")),$(".hv-embed-audio-uns-img").attr("src",chrome.runtime.getURL("/images/injected/audio-mic-uns.png")),$(".hv-embed-audio-img").attr("src",chrome.runtime.getURL("/images/injected/audio-mic.png")),$(".hv-embed-note-logo-img").attr("src",chrome.runtime.getURL("/images/injected/logo-16.png")),$(".hv-embed-green-round").each(function(){$(this).css("background-image","url("+chrome.runtime.getURL("/images/injected/tick.png")+")")}),$(".hv-embed-widget").css("background","url("+chrome.extension.getURL("/images/injected/rectangle-bg.png")+")")))}function loginClick(e){port.postMessage({openUrl:!0,url:e.data.url,messageFromContentScript1234:!0})}var injectedAlready=document.getElementById("hippowiz-widget-js-injected");if(!injectedAlready){var hippoWidgetJsInjected='<input type=hidden id="hippowiz-widget-js-injected" value=true />';$(hippoWidgetJsInjected).appendTo("body");var local="cijidiollmnkegoghpfobabpecdkeiah"!==chrome.runtime.id,port,server=local?"http://localhost:3000":"https://www.hippovideo.io",recordConfigurationinWidget={nothing:!0},audioDeviceAvailable=!0,videoDeviceAvailable=!0,authToken,userEmail,digest,allUrlsPermission=!0,userPreferences={showAdvanced:!0,webcamVisible:!0,webcamPreview:!0,systemAudio:!0},canAllowScreenRecord=!0;chrome.storage.sync.get(["wizUserEmail","wizAuthToken","wizDigest"],function(e){console.log("widget test",e)}),$(document).ready(function(){port=chrome.extension.connect({name:"widget_script"})})}