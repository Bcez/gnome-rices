function sendEvent(e,o){var t={initiator:"hvalertpage",type:e,detail:o};window.top.postMessage(JSON.stringify(t),"*")}function findGetParameter(e){var o=null,t=[];return location.search.substr(1).split("&").forEach(function(i){t=i.split("="),t[0]===e&&(o=decodeURIComponent(t[1]))}),o}function getFaqOneLiner(e){return void 0!=oneLiners[e]?oneLiners[e]:"Something went wrong.."}function getFaqLink(e){var o={10:"common-issues.html#required-extension-permissions",11:"common-issues.html#browser-issues",12:"common-issues.html#required-extension-permissions",13:"common-issues.html#upload-issues",14:"common-issues.html#upload-issues",15:"common-issues.html#hardware-issues",16:"common-issues.html#upload-issues",18:"commonly-asked.html#how-do-i-record-a-single-tab-or-an-application",23:"common-issues.html#miscellaneous-errors",35:"common-issues.html#miscellaneous-errors",52:"common-issues.html#miscellaneous-errors",53:"common-issues.html#miscellaneous-errors"};return void 0==o[e]?void $(".error-link").hide():"https://www.hippovideo.io/faq/"+o[e]}function changeWebcamSource(){navigator.mediaDevices.enumerateDevices().then(function(e){startDeviceTesting()}).catch(function(e){console.log(e)})}function changeAudioSource(e){navigator.mediaDevices.enumerateDevices().then(function(e){startDeviceTesting()}).catch(function(e){console.log(e)})}function setVideoAudioSource(e){$(".select-webcam-source").empty(),$(".select-audio-source").empty();for(var o=this,t=0;t<e.length;t++){var i=e[t];"audioinput"==i.kind?(o.audioDeviceAvailable=!0,$(".select-audio-source").append($("<option>",{value:i.deviceId,text:i.label,selected:"default"==i.deviceId}))):"videoinput"==i.kind&&($(".select-webcam-source").append($("<option>",{value:i.deviceId,text:i.label,selected:"default"==i.deviceId})),o.videoDeviceAvailable=!0)}o.audioDeviceAvailable||(o._recordingOptionsCheck(!1,"audio"),$("#audio").attr("tooltip",commonI18N.audioNotAvailable),$(".select-audio-source").append($("<option>",{text:"commonI18N.noMicDetected"}))),startDeviceTesting()}function startDeviceTesting(){var e={optional:[{sourceId:$(".audio-source-list").val()}]},o={optional:[{sourceId:$(".webcam-source-list").val()}]},t={audio:e,video:o};canvasContext=$("#audio-test-preview-faq")[0].getContext("2d"),canvasHeight=$("#audio-test-preview-faq")[0].height,canvasWidth=$("#audio-test-preview-faq")[0].width;chrome.runtime.sendMessage({getAspectRatioAndFrameRate:!0,messageFromContentScript1234:!0},function(e){t.video.optional.push({aspectRatio:e.aspectRatio,frameRate:e.frameRate}),navigator.mediaDevices.getUserMedia(t,startDeviceTesting).then(function(e){$("#testYourDevise").removeClass("disp-none"),testPreviewStream=e;var o=document.getElementById("webcam-test-preview");o.srcObject=e,o.play();var t=audioContext.createMediaStreamSource(e);meter=createAudioMeter(audioContext),t.connect(meter),drawingMeter=!0,drawMeter(),$("#audio-test-preview-faq").show(),$(".webcam-image").addClass("disp-none")}).catch(function(e){timeOut=setTimeout(function(){navigator.mediaDevices.enumerateDevices().then(function(e){setVideoAudioSource(e)})},1e3)})})}function drawMeter(e){if(drawingMeter){var o=canvasWidth/2-65,t=canvasHeight,i=-meter.volume*canvasHeight*5;canvasContext.clearRect(0,0,canvasWidth,canvasHeight),canvasContext.fillStyle="rgba(0, 0, 0, 0.2)",canvasContext.strokeStyle="red",roundRect(canvasContext,o-10,t-canvasHeight,150,canvasHeight,50,"rgba(200,200,200,0.1)","rgba(0,0,0,0.2)",20),canvasContext.fillStyle="black",canvasContext.fillRect(o,t,130,-10),meter.checkClipping()&&(canvasContext.fillStyle="red");var r=map(Math.abs(i),0,200,50,255);canvasContext.fillStyle="rgb("+Math.floor(r)+","+Math.floor(205-r/2)+",50)",canvasContext.fillRect(o,t,130,i),window.requestAnimationFrame(drawMeter)}}function roundRect(e,o,t,i,r,n,s,a,c){var d=void 0===a||0!==a;n=void 0===n?5:n,e.save(),e.beginPath(),e.moveTo(o+n,t),e.lineTo(o+i-n,t),e.quadraticCurveTo(o+i,t,o+i,t+n),e.lineTo(o+i,t+r-n),e.quadraticCurveTo(o+i,t+r,o+i-n,t+r),e.lineTo(o+n,t+r),e.quadraticCurveTo(o,t+r,o,t+r-n),e.lineTo(o,t+n),e.quadraticCurveTo(o,t,o+n,t),e.closePath(),e.lineWidth=c,d&&0!==a&&(e.strokeStyle=void 0===a?"#000":a,e.stroke()),s&&(e.fillStyle=s,e.fill()),e.restore()}function map(e,o,t,i,r){return e>t?r:e<o?i:(e-o)*(r-i)/(t-o)+i}function setupCustomBranding(){isLessonlyExtension&&($(".enable-video-permission-gif").addClass("lessonly-video-permission-gif"),$("#aletMsgPopupDiv").addClass("lessonly-alertpage"),$("#errorTitle").text(chrome.i18n.getMessage("recording_error")),$(".hippo-error-img").hide(),$(".ok-button").text(chrome.i18n.getMessage("ok_text")),$("#testYourDevise").addClass("force-hide")),$("#aletMsgPopupDiv").removeClass("disp-none")}var drawingMeter,canvasWidth,canvasHeight,canvasContext=null,timeoutHandle,audioContext=null,timeOut,port,aspectRatio,isLessonlyExtension=-1!=chrome.runtime.getManifest().name.toLowerCase().indexOf("lessonly");$(document).ready(function(){setupCustomBranding();var e=findGetParameter("type");$("#enableSystemSettings").hide(),"10"==e&&$(".enable-video-permission-gif").removeClass("disp-none"),"10"==e||"15"==e?(setTimeout(function(){clearTimeout(timeOut)},12e4),$(".hippo-mic-error-img").show(),$(".hippo-error-img").hide(),window.AudioContext=window.AudioContext||window.webkitAudioContext,audioContext=new AudioContext,navigator.mediaDevices.enumerateDevices().then(function(e){setVideoAudioSource(e)}).catch(function(e){console.log(e)}),$(".webcam-source-list").on("change",changeWebcamSource),$(".audio-source-list").on("change",changeAudioSource)):"51"==e||"50"==e?($(".hippo-error-img").hide(),$(".hippo-mic-error-img").hide(),$("#enableSystemSettings").show(),$("#enableSystemSettings video")[0].play()):($("#testYourDevise").hide(),$(".hippo-mic-error-img").hide(),$(".hippo-error-img").show()),$(".error-message").html(getFaqOneLiner(e)),$(".error-link").attr("href",getFaqLink(e)),$(".error-link").html(chrome.i18n.getMessage("click_here_for_info")),APIClient.trackFaqAction("extension error "+e),$(".ok-button").click(function(){window.close(),sendEvent("close_clicked")})});var oneLiners={10:"Webcam/Mic permission needed for recording.",11:"Sorry chrome version not supported. Please update chrome and try again",12:"You must provide permission for screen recording",13:"Error while trying to connect with server. Check your internet connection.",14:"Error while trying to process video. Please check your internet connection.",15:"Error while recording. There seems to be some problem with your recording devices. Please check your webcam or mic.",16:"Error while processing video. Please try again.",18:"This tab cannot be recorded.",23:"Error trying to authenticate user. Please try to re-login to Hippo Video and record once again. Contact support if the problem persists.",35:"Failed to start recording. Try again.",46:"Shucks! Error initiating video recording. Please contact support.",47:"Dang! Error initiating video recording. Please try to re-login to Hippo Video and record once again. Contact support if the problem persists.",48:"Whoops! Unable to start the recording. Please check your system date/time",50:"You must provide system permission for Webcam/Mic recording",51:"You must provide system permission for Screen recording",52:"There seems to be some issue when trying to record webcam/mic. Please contact support.",53:"Kindly restart the web browser, trouble with getting screen permissions.",56:"Uh oh! Webcam or mic error. Please try selecting another webcam source, restarting your browser, or restarting your system if the problem still persists.",57:"Whoops! Failed to record. Please use a functioning webcam or mic.",58:"Error receiving audio/video stream as the webcam or mic seems to have gotten stuck. Please try restarting your webcam/mic, your web browser, or your system if the problem still persists."};