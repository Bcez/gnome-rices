var injectedAlready=document.getElementById("hippowiz-hubspot-dynamic-injected"),CONTENT={refreshPage:"We've released cool new updates. Please reload the page to view them."},HTML_CONTENT={hippo_button:"<div class='hv-embed-main-container'> <button id='hippo_video_button' data-ref='hv-embed-main-container' data-type='record_and_library' class='toolbar-action-component toggle text-editor-extension hint--top hv-embed-main-icon' data-hint='Hippo Video' type='button'><img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'  height='20px' width='19px' > </button><span class='tooltiptext'>Hippo Video</span></div>",hippo_report_button:"<li style='padding-left: 0; min-width: 110px;'><div class='hv-embed-main-container-report hv-integration-reports-button' style='margin: 20px 4px 0; text-align: center'> <button data-ref='hv-embed-main-container-report' class='hv-integration-reports' type='button' style='position: relative; width: 32px; height: 32px; padding-top: 6px; border: 1px solid #cbd6e2; border-radius: 50%; background-color: #eaf0f6;'><img src='"+chrome.extension.getURL("/images/injected/hv-integration-reports.svg")+"' height='16px' width='16px' style=''></button><small style='display: block; padding-top: 8px; font-size: 12px;'>Video Reports</small></div></li>",refreshEle:'<div class="hv-top-error">\t\t\t\t\t\t<span> '+CONTENT.refreshPage+' </span>\t\t\t\t\t\t<a href="javascript:void(0)" id="hv-refresh-page">Refresh</a>\t\t\t\t\t</div>',copyToClipboardBtn:'<button class="copy-to-clipboard" data-clipboard-target="#copy-to-clipboard-btn" style="display:none;"></button>'},isSalesNavigator=!1,copyToClipboard=void 0;if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-hubspot-dynamic-injected" value=true />';$(hippoCsInjected).appendTo("body"),$(HTML_CONTENT.copyToClipboardBtn).appendTo("body"),console.log("injected hubspot-dynamic script"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:N.serviceName,windowId:N.windowId,tabId:N.tabId}}function o(e,o){var a=t();a.messageFromContentScript1234=!0,a.msgType="workflow",a.payload={playUrl:e,thumbnailUrl:o},a.urlToBeShortened=e,a.fetchShortenUrl=!0,N.port.postMessage(a)}function a(e,t){isSalesNavigator=!1,copyToClipboard&&copyToClipboard.destroy(),jQuery(function(){jQuery(".copy-to-clipboard").click()}),copyToClipboard=new ClipboardJS(".copy-to-clipboard",{target:function(){return n(e,t)}}),copyToClipboard.on("success",function(e){$("#copyLinkWithThumbnailTarget").hide()}),$("#hvHubspotPop").remove()}function n(e,t){return $("#copyLinkWithThumbnailTarget").remove(),$("body").append('<div id="copyLinkWithThumbnailTarget" aria-hidden="true" tabindex="-1" >'+i(e,t)+"</div>"),document.querySelector("#copyLinkWithThumbnailTarget")}function i(e,t){return'<div><a href="'+e+'"><img src="'+t+'" alt="'+e+'" width="360" height="200"></a></div><div><br></div>'}function r(){var e=t();e.messageFromContentScript1234=!0,e.messageType="hubspot-dynamic",e.injectIframeScript=!0,N.port.postMessage(e)}function s(e,t){if(0==$("#hippo_video_button").length){var o=window.location.href;"sequenceflow"==e&&o.includes("hubspot.com/sequences")&&$(".draft-extend-controls:has(.draft-toolbar-button)").length>0&&d(!0),"normalflow"!=e||o.includes("hubspot.com/sequences")||d(!1)}}function d(e){var t=0,o=setInterval(function(){var a=e?".draft-extend-controls:has(.draft-toolbar-button)":".draft-extend-controls";if($(a).length>0&&0==$(a).find("#hippo_video_button").length){if(clearInterval(o),$(a).prepend($(HTML_CONTENT.hippo_button)),$(".hv-embed-main-icon").off("click").on("click",u),e){var n=$(".bold-button.draft-toolbar-button").parent().find(".hv-embed-main-container"),i=$(n).parents().find("[contenteditable='true']");p($(i)[1])}h()}++t>200&&clearInterval(o)},25)}function c(e){$(e).append($(HTML_CONTENT.hippo_report_button)),$(".hv-integration-reports").off("click").on("click",g)}function p(e){l(e),$(e).keydown(function(t){setTimeout(function(t){l(e)},200)})}function l(e){for(var t=$(e).find("img"),o=0;o<t.length;o++){var a=$($(t)[o]).attr("src");(a.includes("localhost:3000")||a.includes("stage.hippowiz.com")||a.includes("hippovideo.io"))&&$($(t)[o]).attr("alt","Oops! The thumbnail seems to be broken. Don't worry, the video will work just fine.")}}function m(e,o){var a=window.location.href.includes("/sequence/")||window.location.href.includes("/templates/"),n=t();n.messageFromContentScript1234=!0,n.initWorkflowPop=!0,n.msgType="workflow",n.payload={logPrefix:N.logPrefix,popType:"sales",popId:"hvHubspotPop",assetContent:{mfFormValues:{Email:e,"First Name":o}},popConfig:{showEditOption:!0,showTemplatesOption:!1,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:!a,fetchMfInVideo:!0,mandatoryEmailMf:!0,insertVideoText:"COPY TO CLIPBOARD",showCustomizeComponent:!0,showLandingPageComponent:!0,showTelePrompter:!0,isSequenceFlow:a}},N.port.postMessage(n)}function u(e){if($("#hvHubspotPop").remove(),window.location.href.includes("/sequence/"))try{m("","")}catch(e){C(e)}else T("integrationWorkflow")}function f(e,o){var a=t();a.messageFromContentScript1234=!0,a.initReportPop=!0,a.randomId="",a.msgType="workflow",a.reportBtn="hv-integration-reports",a.contactEmail=e,a.contactName=o,a.payload={popId:"hvHubspotReportPop",logPrefix:N.logPrefix},N.port.postMessage(a)}function g(e){$("#hvHubspotReportPop").remove(),$(".hv-integration-reports").attr("disabled",!0),T("reportWorkflow")}function h(){var e=t();e.messageFromContentScript1234=!0,e.checkHubspotOnboardingStatus=!0,e.msgType="workflow",e.flowType=y(),N.port.postMessage(e)}function v(e){var o=t();o.messageFromContentScript1234=!0,o.initIntegOnboardingPop=!0,o.msgType="workflow",o.isSequenceFlow=window.location.href.includes("/sequence/"),o.hippoBtnLocator="hv-embed-main-container",o.previewSrc=e,N.port.postMessage(o)}function b(e){var o=t();o.messageFromContentScript1234=!0,o.resetHubspotOnboardingStatus=!0,o.msgType="workflow",o.flowType=y(),o.isOnboardingPreviewShown=e,N.port.postMessage(o)}function w(e){var o=e.workflowConfig,a=t();a.messageFromContentScript1234=!0,a.messageType="hubspot_dynamic",a.getUTMToken=!0,a.popId=o.popId,a.content=o,a.serviceName=N.serviceName,N.port.postMessage(a)}function y(){return 1==window.location.href.includes("/sequence/")?"sequence":"one-to-one"}function T(e){var t="",o="";if($('[data-selenium-test="property-input-email"]').length>0)t=$('[data-selenium-test="property-input-email"]').text(),o=void 0==$('[data-selenium-test="property-input-firstname"]').val()?"":$('[data-selenium-test="property-input-firstname"]').val(),I(e,t,o);else if($("[data-sidebar-card-type=PropertiesCard]").find("[class*=UIExpandableSection__ExpandableButton]").length>0){var a=0;$("[data-sidebar-card-type=PropertiesCard]").find("[class*=UIExpandableSection__ExpandableButton]")[0].click(),k(!0);var n=setInterval(function(){$('[data-selenium-test="property-input-email"]').length>0&&(clearInterval(n),t=$('[data-selenium-test="property-input-email"]').text(),o=void 0==$('[data-selenium-test="property-input-firstname"]').val()?"":$('[data-selenium-test="property-input-firstname"]').val(),setTimeout(function(){$("[data-sidebar-card-type=PropertiesCard]").find("[class*=UIExpandableSection__ExpandableButton]")[0].click(),k(!1)},1e3),I(e,t,o)),++a>70&&(clearInterval(n),setTimeout(function(){$("[data-sidebar-card-type=PropertiesCard]").find("[class*=UIExpandableSection__ExpandableButton]")[0].click(),k(!1)},1e3),I(e,t,o))},25)}else I(e,t,o)}function I(e,t,o){try{"integrationWorkflow"==e?m(t,o):"reportWorkflow"==e&&f(t,o)}catch(e){C(e)}}function C(e){"Extension context invalidated."==e.message?_(HTML_CONTENT.refreshEle,8e3):console.log(e)}function _(e,t){0==$(".hv-top-error").length&&($(e).appendTo("body"),$("#hv-refresh-page").off("click").on("click",function(){window.location.reload()}),setTimeout(function(){$(".hv-top-error").remove()},t))}function k(e){var t=$("[data-sidebar-card-type=PropertiesCard]").find("[class*=TwoWayTransition__PlainWrapper]");$(t).length>0&&(e?($($(t)[0]).css("display","none"),$($("[data-sidebar-card-type=PropertiesCard]").find("[class*=private-icon-caret]")[0]).css("transition","all 150ms ease-in-out 0s"),$($("[data-sidebar-card-type=PropertiesCard]").find("[class*=private-icon-caret]")[0]).css("transform","rotate(0deg)")):($($(t)[0]).css("display","block"),$($("[data-sidebar-card-type=PropertiesCard]").find("[class*=private-icon-caret]")[0]).css("transition",""),$($("[data-sidebar-card-type=PropertiesCard]").find("[class*=private-icon-caret]")[0]).css("transform","")))}var N=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix=" HUBSPOT_DYNAMIC :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t.mergeFieldFormats={"First Name":"contact.firstname",Email:"contact.email","Last Name":"contact.lastname","Company Name":"contact.company","Phone Number":"contact.phone",Address:"contact.address",Country:"contact.country",City:"contact.city",State:"contact.state"},t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,N.port.postMessage(e)}(),window.addEventListener("message",function(e){e.data.type&&"hv_init_workflow_pop"==e.data.type&&(isSalesNavigator=!0,T("integrationWorkflow"))}),N.port.onMessage.addListener(function(e,t,n){if(msgFromPort=e.backgroundRecordingMessage,"cancelFromWorkflowPop"==msgFromPort&&e.data.serviceName==N.serviceName&&e.data.tabId==N.tabId&&(isSalesNavigator=!1),"hubspotOnboardingStatusResponse"==msgFromPort&&e.data.serviceName==N.serviceName&&e.data.tabId==N.tabId){var i=e.data;if(i.status){var r=i.response;!r.preview_shown&&r.preview_src&&(v(r.preview_src),b(!0))}}if("insertFromWorkflowPop"==msgFromPort&&e.data.serviceName==N.serviceName&&e.data.tabId==N.tabId&&w(e.data),"insertVideoInHubspotMailBox"==msgFromPort&&e.data.serviceName==N.serviceName&&e.data.tabId==N.tabId){var s=e.data.track_id,d=e.data.status,c=e.data.content.assetContent,p=e.data.content.popConfig.isSequenceFlow,l=c.videoShareUrl,m=c.thumbnailShareUrl,u=l.includes("?")?"&":"?";if(c.mfInVideo.includes("Email")||c.mfInVideo.push("Email"),c.mfInVideo.includes("First Name")||c.mfInVideo.push("First Name"),p){for(var f=0;f<c.mfInVideo.length;f++)u+=c.mfInVideo[f]+"={{"+(N.mergeFieldFormats[c.mfInVideo[f]]?N.mergeFieldFormats[c.mfInVideo[f]]:c.mfInVideo[f])+"}}&";l+=u,m+=u,a(l,m)}else{if(d)l+=l.includes("?")?"&track_id="+s:"?track_id="+s,m+=m.includes("?")?"&track_id="+s:"?track_id="+s;else{for(var f=0;f<c.mfInVideo.length;f++)u+=c.mfInVideo[f]+"="+c.mfFormValues[c.mfInVideo[f]],u+=f!=c.mfInVideo.length-1?"&":"";l+=u,m+=u}isSalesNavigator?o(l,m):(l+=l.includes("?")?"&_="+Date.now():"?_="+Date.now(),m+=m.includes("?")?"&_="+Date.now():"?_="+Date.now(),a(l,m))}}"fetchShortenUrlResponse"==msgFromPort&&e.data.tabId==N.tabId&&a(e.data.shortenUrl,e.data.payload.thumbnailUrl)}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){for(var o in e){var a=e[o],n=window.location.href;if($(a.target).hasClass("space-sword--editor")&&s("sequenceflow",a.target),$(a.target).hasClass("private-truncated-string")&&n.includes("/templates/")&&"template-owner-name"==$(a.target).attr("data-test-id")&&s("normalflow"),$(a.target).hasClass("private-checkbox__input sr-only")&&!n.includes("/templates/")&&s("normalflow"),$(a.target).hasClass("private-truncated-string private-truncated-string--is-flex")&&!n.includes("/templates/")&&($(a.target).parents().find(".UITag__ContentWrapper-sc-18a5m7g-2").length>0||$(a.target).parents().find(".Select-control").length>0)&&s("normalflow"),$(a.target).hasClass("private-truncated-string")&&0==$(".hv-embed-main-container-report").length&&n.includes("/contacts/")){var i=$(a.target).parents().find("[data-selenium-component=ProfileHighlightContainer]")||$(a.target).parents().find("[data-sidebar-location=CRM_RECORD_LEFT]")||$(a.target).parents().find(".uiList.private-list--inline.justify-center.private-list--unstyled"),d=i.find(".uiListItem")[1];$(d).length>0&&c(d)}if("dnd-communicator-drag-source"==$(a.target).attr("data-test"))var p=0,l=setInterval(function(){var e=$(".floating-communicator-body").find(".sales-navigator-iframe");$(e).length>0&&($(".floating-communicator-body").find(".sales-navigator-iframe").on("load",r),clearInterval(l)),++p>200&&clearInterval(l)},25)}}).observe(document,{subtree:!0,childlist:!0,attributes:!0})})}