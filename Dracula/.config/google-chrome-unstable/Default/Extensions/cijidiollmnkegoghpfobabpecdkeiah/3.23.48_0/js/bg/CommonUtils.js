var CommonUtils={isLocal:"cijidiollmnkegoghpfobabpecdkeiah"!==chrome.runtime.id};CommonUtils.sendBlobAsChunks=function(e,o,t,n){messageContentScripts(e+"-start"),console.silent("started sendBlobAsChunks for "+e,o),console.info("started sendBlobAsChunks for "+e),CommonUtils.sendBlobChunk(e,o,t,n)},CommonUtils.sendBlobChunk=function(e,o,t,n){var i=new Blob([o.slice(0,Math.min(t,o.size))],{type:"video/webm"});if(i.size<=0)return console.info("all blob chunks sent for "+e),messageContentScripts(e+"-end"),void n();CommonUtils.blobToDataUrl(i,function(i){messageContentScripts(e+"-part",i),CommonUtils.sendBlobChunk(e,o.slice(t),t,n)})},CommonUtils.blobToDataUrl=function(e,o){var t=new FileReader;t.onload=function(e){o(e.target.result)},t.readAsDataURL(e)},CommonUtils.dataURItoBlob=function(e){for(var o=atob(e.split(",")[1]),t=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(o.length),i=new Uint8Array(n),s=0;s<o.length;s++)i[s]=o.charCodeAt(s);return new Blob([n],{type:t})},CommonUtils.getError=function(e){var o={name:e,message:"Something went wrong. Please try again later..",code:-1,blameUser:!1};return constants.errorType[e]&&(o.code=constants.errorType[e]),constants.errorMessage[e]&&(o.message=constants.errorMessage[e]),-1!=constants.blameUserErrors.indexOf(e)&&(o.blameUser=!0),o},CommonUtils.sendFromLocalVideo=function(e,o,t,n,i,s){function a(o){var t=o.shift();if(void 0==t)return messageTab(n,e+"-end",void 0,s),void i();IDBUtils.getBlob(t,function(t){CommonUtils.blobToDataUrl(t,function(t){messageTab(n,e+"-part",t,s),a(o)})})}messageTab(n,e+"-start",void 0,s),IDBUtils.getKeys(o,function(e){console.info("keys for sending from local for videokey : "+o,{k:e}),a(e)})},CommonUtils.clearLocalVideos=function(e){e.screenId&&e.webcamId?IDBUtils.clearLocalVideo(e.screenId,function(){IDBUtils.clearLocalVideo(e.webcamId)}):e.screenId?IDBUtils.clearLocalVideo(e.screenId):e.webcamId&&IDBUtils.clearLocalVideo(e.webcamId)},CommonUtils.retryUpload=function(e,o){function t(o,i){var s=o.shift();if(void 0==s)return n&&e.onDataAvailable(e,n,!0),void i();IDBUtils.getBlob(s,function(s){s.size>constants.PARTUPLOADSIZE?e.onDataAvailable(e,s,!0):n=s,t(o,i)})}var n,i=e.videoId;IDBUtils.getKeys(i,function(n){console.info("keys ",{k:n}),e.resetUpload(),e.initializeAWS(function(){t(n,function(){e.finish(o,!0)})})})},CommonUtils.maximizeSize=function(e,o){var t=Math.min(o.width/e.width,o.height/e.height);return{width:e.width*t,height:e.height*t}},CommonUtils.getAudioMeter=function(e){window.AudioContext=window.AudioContext||window.webkitAudioContext,audioContext=new AudioContext;var o=audioContext.createMediaStreamSource(e);return meter=createAudioMeter(audioContext),o.connect(meter),meter},CommonUtils.checkFaultyMic=function(e,o){setTimeout(function(){e&&0===e.volume&&o&&o()},2e3)};