var injectedAlready=document.getElementById("hippowiz-freshsales-injected"),shareUrl,isRecording=!1,waitingForUrl=!1,guestUrl,recordingConfiguration,assetId,HTML_CONTENT={hippo_button:"<div class='hv-embed-main-container'> <button id='hippo_video_button' data-ref='hv-embed-main-container' data-type='record_and_library' class='toolbar-action-component toggle text-editor-extension hint--top hv-embed-main-icon' data-hint='Hippo Video' type='button'><img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'></button></div>"},mergeFieldFormats={"First Name":"{{contact.first_name}}",Email:"{{contact.email}}","Last Name":"{{contact.last_name}}","Company Name":"{{contact.work_number}}","Phone Number":"{{contact.mobile_number}}",Address:"{{contact.address}}",Country:"{{contact.country}}",City:"{{contact.city}}",State:"{{contact.state}}"};if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-freshsales-injected" value=true />';$(hippoCsInjected).appendTo("body");var port;console.log("injected freshsales script"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:c.serviceName,windowId:c.windowId,tabId:c.tabId}}function n(e){var t=e.track_id,n=e.content.popConfig.isBulkEmail,a=e.content.assetContent.videoShareUrl,i=e.content.assetContent.thumbnailShareUrl;if(e.status&&!n)a+=a.includes("?")?"&track_id="+t:"?track_id="+t,i+=i.includes("?")?"&track_id="+t:"?track_id="+t;else{var r=e.content.assetContent.mfInVideo,s=e.content.assetContent.mfFormValues;if(r.includes("Email")||r.push("Email"),r.length>0){var d="";if(n)for(var c=0;c<r.length;c++)d+=r[c]+"="+(mergeFieldFormats[r[c]]?mergeFieldFormats[r[c]]:"{{"+r[c]+"}}")+"&";else for(var c=0;c<r.length;c++)d=d+encodeURIComponent(r[c])+"="+encodeURIComponent(s[r[c]])+"&";""!=d&&(a+=a.includes("?")?"&"+d:"?"+d,i+=i.includes("?")?"&"+d:"?"+d)}}var m='<div id="copyLinkWithThumbnailTarget" aria-hidden="true" tabindex="-1" >'+o(a,i)+"</div>",l=$(".fr-iframe").contents().find(".fr-view").find(".fr-marker").first();l.length>0?$(l).parent().prepend(m):$(".fr-iframe").contents().find("body.fr-view").append(m),$("#hvFreshsalesPop").remove()}function o(e,t){return'<div><a href="'+(e+=e.includes("?")?"&":"?")+'" target="_blank" tabindex="-1"><div id="copy-thumbnail-wrapper" style="max-height:200px; max-width:360px;"><img src="'+t+'" alt="'+e+'" style="max-height: 202px; max-width: 360px;" class="thumbnail-image"></div></a><a href="'+e+'" target="_blank" tabindex="-1"><div style="padding-top: 7px;">Watch Video</div></a><div><br></div></div>'}function a(){$(".hv-embed-main-container").remove(),$(".email-compose-footer .flex:first ").prepend($(HTML_CONTENT.hippo_button)),$("#hippo_video_button").off("click").on("click",s),$(".rich-text-editor-component button.primary-button.save").addClass("hv-tool-bar-quill-override")}function i(e){var n=window.location.href,o="",a="";try{n.includes("/crm/sales/contacts/")&&!n.includes("/crm/sales/contacts/view/")&&(o=$(".__a7471--content")[0].innerText.trim(),a=$('div[data-test-detail-field="Emails"] .mg-t-2 span')[0].innerHTML)}catch(e){console.log(e)}var i=t();i.messageFromContentScript1234=!0,i.initWorkflowPop=!0,i.msgType="workflow",i.payload={logPrefix:c.logPrefix,popType:"sales",popId:"hvFreshsalesPop",assetContent:{mfFormValues:{"First Name":o,Email:a}},popConfig:{showEditOption:!0,showTemplatesOption:!1,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:!e,fetchMfInVideo:!0,mandatoryEmailMf:!0,showCustomizeComponent:!0,showLandingPageComponent:!0,showTelePrompter:!0,isBulkEmail:e}},c.port.postMessage(i)}function r(e){var n=e.workflowConfig,o=t();o.messageFromContentScript1234=!0,o.messageType="freshsales_dynamic",o.getUTMToken=!0,o.popId=n.popId,o.content=n,o.serviceName=c.serviceName,c.port.postMessage(o)}function s(e){$("#hvFreshsalesPop").remove(),i(d(e.currentTarget))}function d(e){var t=!1;return $(e).parents(".modal.slide.modal-slide.modal-md.in").find(".email-to-field--bulk").length>0&&(t=!0),t}var c=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix=" FRESHSALES_DYNAMIC :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,c.port.postMessage(e)}(),c.port.onMessage.addListener(function(e,t,o){msgFromPort=e.backgroundRecordingMessage,"insertFromWorkflowPop"==msgFromPort&&e.data.serviceName==c.serviceName&&e.data.tabId==c.tabId&&r(e.data),"insertVideoInFreshsales"==msgFromPort&&"freshsales"==e.data.serviceName&&e.data.tabId==c.tabId&&n(e.data)}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){for(var n in e){var o=e[n];$(o.target).hasClass("modal slide modal-slide modal-md in")&&0==$(".hv-embed-main-container").length&&a()}}).observe(document,{subtree:!0,childlist:!0,attributes:!0})})}