if(!document.getElementById("hv-workflow-contacts-injected")){var EMAIL_REGEX=/(?!.*\.{2})^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;$('<input type=hidden id="hv-workflow-contacts-injected" value=true />').appendTo("body"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:X.serviceName,windowId:X.windowId,tabId:X.tabId}}function o(e){var t=e.workflowConfig;$("#"+t.popId).find(".hv-wf-pop-header .hv-pop-topbar-ele").removeClass("tp-selected"),$("#"+t.popId).find(".hv-wf-pop-header .hv-contacts").addClass("tp-selected"),R(t.popId);var o=t.assetContent,a=$("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").find(".hv-contacts-container").attr("asset-id"),i=$("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").find(".hv-contacts-container").attr("template-id"),c=$("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").find(".hv-contacts-container").attr("reset-contacts");o.assetId==a&&o.templateId==i&&"true"!=c||($("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").find(".hv-contacts-container").remove(),delete o.toEmails,delete o.mergeFields,delete o.importType,delete o.unique_id,delete o.file_id,delete o.manualcontacts,delete o.vidAndThumbMfs),0===$("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").find(".hv-contacts-container").length&&($("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").append($(Q.contactsContainer)),$("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").find(".hv-contacts-container").attr("asset-id",o.assetId).attr("template-id",o.templateId),s(t.popId,t.logPrefix)),$("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").find(".hv-contacts-container").attr("asset-id",o.assetId),$("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").find(".hv-contacts-container").attr("template-id",o.templateId),n(t.popId),$("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").find(".hv-pop-content-container").hide(),$("#"+t.popId).find(".hv-wf-pop-body .hv-wf-pop-content").find(".hv-contacts-container").show()}function n(e){var t=$("#"+e).find(".hv-contacts-container .import-contacts-container").find(".selectable-menu-item-selected");if(0!=$(t).length){var o=$(t).attr("import-type");o==J.GOOGLE_CONTACTS?a(e,"gcontacts"):o==J.GOOGLE_SHEET?a(e,"gsheets"):c(e)}}function a(e,t){var o;"gcontacts"==t?(o=$("#"+e).find(".google-contacts-import-container"),$(o).length>0&&("true"===$(o).attr("grant-access")||"true"===$(o).attr("no-contacts")?i(e):c(e))):"gsheets"==t&&(o=$("#"+e).find(".google-sheet-import-container"),$(o).length>0&&("true"===$(o).attr("grant-access")||"true"===$(o).attr("no-sheets")?i(e):c(e)))}function i(e){$("#"+e).find(".hv-wf-pop-footer .right-btn-container").find("#contactsFinishBtn").hide()}function c(e){$("#"+e).find(".hv-wf-pop-footer .right-btn-container").find("#contactsFinishBtn").show()}function s(e,t){$("#"+e).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(50),0===$("#"+e).find(".hv-contacts-container .hv-contacts-screens").length?($("#"+e).find(".hv-contacts-container").append($(Q.contactScreens)),r(e,t)):$("#"+e).find(".hv-contacts-container .hv-contact-screen").show()}function r(e,t){$("#"+e).find(".hv-contacts-container .hv-contact-screen").hide(),$("#"+e).find(".hv-contacts-container .contact-type-selection").show(),0==$("#"+e).find(".hv-contacts-container .contact-type-selection").find(".type-selection-container").length?($("#"+e).find(".hv-contacts-container .contact-type-selection").append($(Q.typeSelectionContainer)),$("#"+e).find(".hv-contacts-container .type-selection-container").find(".hv-btn").attr("pop-id",e).attr("log-prefix",t),$("#"+e).find(".hv-contacts-container .type-selection-container").find(".hv-btn").off("click").on("click",function(e){var t=$(e.currentTarget).attr("option-type"),o=$(e.currentTarget).attr("pop-id"),n=$(e.currentTarget).attr("log-prefix");"import"===t?(d(o,n,J.GOOGLE_SHEET),q(n,"Import Contacts Button Clicked In Type Selection")):(d(o,n,J.MANUAL),q(n,"Add Contacts Button Clicked In Type Selection"))})):$("#"+e).find(".hv-contacts-container .contact-type-selection").find(".type-selection-container").show()}function d(e,t,o){$("#"+e).find(".hv-contacts-container .hv-contact-screen").hide(),$("#"+e).find(".hv-contacts-container .contact-import-screen").show(),0===$("#"+e).find(".hv-contacts-container .contact-import-screen").find("import-contacts-container").length?($("#"+e).find(".hv-contacts-container .contact-import-screen").append($(Q.importContactsContainer)),$("#"+e).find(".hv-contacts-container .import-contacts-container").append($(Q.importMenu)),$("#"+e).find(".hv-contacts-container .import-contacts-container").append($(Q.importContactContentContainer)),p(e,t)):$("#"+e).find(".hv-contacts-container .import-contacts-container").show(),c(e),$("#"+e).find(".hv-contacts-container .import-contacts-container").find(".selectable-menu-item").attr("pop-id",e).attr("log-prefix",t),$("#"+e).find(".hv-contacts-container .import-contacts-container").find(".selectable-menu-item").off("click").on("click",function(e){var t=$(e.currentTarget).attr("import-type"),o=$(e.currentTarget).attr("pop-id"),n=$(e.currentTarget).attr("log-prefix");$("#"+o).find(".hv-contacts-container .import-contacts-container").find(".selectable-menu-item").removeClass("selectable-menu-item-selected"),$("#"+o).find(".hv-contacts-container .import-contacts-container").find(".import-contacts-content").hide(),$("#"+o).find(".hv-contacts-container .import-contacts-container").find('.import-contacts-content[import-type="'+t+'"]').show(),$("#"+o).find(".hv-contacts-container .import-contacts-container").find('.selectable-menu-item[import-type="'+t+'"]').addClass("selectable-menu-item-selected"),t===J.SHEET?(l(o),q(n,"Import From Local Sheet Menu Clicked")):t===J.GOOGLE_SHEET?(f(o),q(n,"Import From Google Sheet Menu Clicked")):t===J.GOOGLE_CONTACTS?(y(o),q(n,"Import From Google Contacts Menu Clicked")):t===J.MANUAL&&(A(o),q(n,"Add Contacts Menu Clicked"))}),$("#"+e).find(".hv-contacts-container .import-contacts-container").find('.selectable-menu-item[import-type="'+o+'"]').click()}function p(e,t){buttons=[{name:K.finish,id:"contactsFinishBtn",type:"primary"}];for(var o=0;o<buttons.length;o++)if(0==$("#"+e).find(".hv-wf-pop-footer .right-btn-container").find("#"+buttons[o].id).length){var n=$(Q.buttonEle);$(n).attr("id",buttons[o].id),$(n).find("span").text(buttons[o].name),$("#"+e).find(".hv-wf-pop-footer .right-btn-container").append($(n)),$("#"+e).find(".hv-wf-pop-footer .right-btn-container").find("#"+buttons[o].id).addClass(buttons[o].type+"-btn")}$("#"+e).find(".hv-wf-pop-footer .right-btn-container").find("#contactsFinishBtn span").attr("pop-id",e).attr("log-prefix",t),$("#"+e).find(".hv-wf-pop-footer .right-btn-container").find("#contactsFinishBtn span").off("click").on("click",function(e){var t=$(e.currentTarget).attr("pop-id"),o=$(e.currentTarget).attr("log-prefix");L(t);var n=$("#"+t).data("workflowConfig");n.selectedImportType?n.selectedImportType==J.SHEET?T(n):n.selectedImportType==J.GOOGLE_SHEET?k(n):n.selectedImportType==J.GOOGLE_CONTACTS?M(n):n.selectedImportType==J.MANUAL&&D(n):P(t),q(o,"Finish Button In Contacts Clicked")})}function l(e){0===$("#"+e).find(".hv-contacts-container .local-sheet-import-container").length&&($("#"+e).find('.hv-contacts-container .import-contacts-content[import-type="'+J.SHEET+'"]').append($(Q.localSheetImportContainer)),$("#"+e).find("#hvLocalSheetFile").attr("pop-id",e),$("#"+e).find("#hvLocalSheetFile").off("change").on("change",function(e){var t=$(e.currentTarget).attr("pop-id"),o=$("#"+t).data("workflowConfig");$("#"+t).find(".hv-contacts-container .local-sheet-import-container").find(".file-selection-container").hide(),$("#"+t).find(".hv-contacts-container .local-sheet-import-container").find(".file-selected-container").addClass("display-flex"),o.selectedFile=e.target.files[0],j(o),$("#"+t).find(".hv-contacts-container .file-selected-container").find(".selected-file-name").text(selectedFile.name)}),$("#"+popIds).find(".hv-contacts-container .local-sheet-import-container").find(".reselect-file").attr("pop-id",e),$("#"+e).find(".hv-contacts-container .local-sheet-import-container").find(".reselect-file").off("click").on("click",function(e){var t=$(e.currentTarget).attr("pop-id");$("#"+t).find(".hv-contacts-container .file-selected-container").removeClass("display-flex"),$("#"+t).find(".hv-contacts-container .local-sheet-import-container").find(".file-selection-container").show();var o=$("#"+t).data("workflowConfig");o.selectedFile=void 0,j(o)}))}function f(e){0===$("#"+e).find(".hv-contacts-container .google-sheet-import-container").length?($("#"+e).find('.hv-contacts-container .import-contacts-content[import-type="'+J.GOOGLE_SHEET+'"]').append($(Q.googleSheetImportContainer)),i(e),m(e),$("#"+e).find(".hv-contacts-container .gsheet-access-container").find(".hv-btn").attr("pop-id",e),$("#"+e).find(".hv-contacts-container .gsheet-access-container").find(".hv-btn").off("click").on("click",function(e){O($(e.currentTarget).attr("pop-id"),"drive")})):a(e,"gsheets");var t=$("#"+e).data("workflowConfig");t.selectedImportType=J.GOOGLE_SHEET,j(t)}function g(e){var o=t();o.messageFromContentScript1234=!0,o.msgType="workflow",o.screenName=X.screenName,o.configureGDriveAccount=!0,o.authcode=e.authcode,o.optionalData=e.optionalData,o.popId=e.popId,X.port.postMessage(o)}function m(e,o){$("#"+e).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeIn(10);var n=t();n.messageFromContentScript1234=!0,n.msgType="workflow",n.fetchGdriveAccounts=!0,n.screenName=X.screenName,n.optionalData=o,n.popId=e,X.port.postMessage(n)}function h(e){$("#"+e.popId).find(".google-sheet-import-container .gsheet-account-data-container").show(),$("#"+e.popId).find(".google-sheet-import-container .gsheet-account-data-container div").removeClass("display-flex");var t=e.response.accounts;if(0==t.length)$("#"+e.popId).find(".google-sheet-import-container .accounts-container").hide(),$("#"+e.popId).find(".google-sheet-import-container .gsheet-access-container").addClass("display-flex"),$("#"+e.popId).find(".google-sheet-import-container").attr("grant-access",!0),i(e.popId);else{$("#"+e.popId).find(".google-sheet-import-container").attr("grant-access",!1),$("#"+e.popId).find(".google-sheet-import-container .accounts-container").addClass("display-flex"),$("#"+e.popId).find("#hvGSheetImportAccountSelect").empty();for(var o=0;o<t.length;o++){var n=t[o];$("#"+e.popId).find("#hvGSheetImportAccountSelect").append('<option value="'+n.user_id+'" email="'+n.email+'">'+n.email+"</option>")}if($("#"+e.popId).find("#hvGSheetImportAccountSelect").append('<option value="-1">'+K.addAccount+"</option>"),$("#"+e.popId).find("#hvGSheetImportAccountSelect").attr("pop-id",e.popId),$("#"+e.popId).find("#hvGSheetImportAccountSelect").off("change").on("change",function(e){var t=$(e.currentTarget).attr("pop-id"),o=$(e.currentTarget).val(),n=$(e.currentTarget).find(":selected").attr("email");if("-1"===o)for(var a=[],i=$("#"+t).find("#hvGSheetImportAccountSelect").find("option"),c=0;c<$(i).length;c++){var s=$(i)[c];$(s).text()!==K.addAccount&&a.push($(s).attr("value"));var r={existingEmails:a};O(t,"drive",r)}else $("#"+t).find(".google-sheet-import-container .gsheet-listing-container").empty().removeClass("display-flex"),$("#"+t).find(".google-sheet-import-container .gsheet-list-container").hide(),v(t,o,n)}),e.optionalData&&e.optionalData.existingEmails){for(var a=!1,c=e.optionalData.existingEmails,s=0;s<t.length;s++){var r=t[s];if(!c.includes(r.user_id)){$("#"+e.popId).find("#hvGSheetImportAccountSelect").val(r.user_id).trigger("change"),a=!0;break}}a||$("#"+e.popId).find("#hvGSheetImportAccountSelect").val(t[0].user_id).trigger("change")}else $("#"+e.popId).find("#hvGSheetImportAccountSelect").val(t[0].user_id).trigger("change")}}function v(e,o,n,a){$("#"+e).find(".google-sheet-import-container .sheet-loading").fadeIn(10);var i=t();i.messageFromContentScript1234=!0,i.msgType="workflow",i.listDriveFiles=!0,i.params={account_email:n,unique_id:o,file_type:"spreadsheet",page_token:a},i.popId=e,i.screenName=X.screenName,X.port.postMessage(i)}function u(e){$("#"+e.popId).find(".google-sheet-import-container .sheet-loading").fadeOut(50);var t=$("#"+e.popId).find(".google-sheet-import-container .gsheet-listing-container");t.find(".load-more-sheets").remove();var o=e.params.page_token,n=e.response;if(o||0!==n.files.length){if(n.files.length>0){$("#"+e.popId).find(".google-sheet-import-container").attr("no-sheets",!1),o||c(e.popId),t.hasClass("display-flex")||(t.addClass("display-flex"),$("#"+e.popId).find(".google-sheet-import-container .gsheet-list-container").show()),t.attr("account-email",e.params.account_email).attr("unique-id",e.params.unique_id).attr("pop-id",e.popId);for(var a=n.files,s=0;s<a.length;s++){var r=a[s],d=$(Q.googleSheetElement);$(d).attr("file-id",r.id),$(d).find(".sheet-name").text(r.name),t.append($(d))}t.find(".google-sheet-ele").off("click").on("click",function(e){var t=$(e.currentTarget).closest(".gsheet-listing-container").attr("pop-id"),o=$("#"+t).data("workflowConfig");if($(e.currentTarget).hasClass("google-sheet-selected"))$(e.currentTarget).removeClass("google-sheet-selected"),o.selectedFile=void 0,o.fileSelectedAccountMail=void 0,o.fileSelectedAccountId=void 0;else{var n=$("#"+t).find(".google-sheet-import-container .gsheet-listing-container");$(n).find(".google-sheet-ele").removeClass("google-sheet-selected"),$(e.currentTarget).addClass("google-sheet-selected"),o.selectedFile=$(e.currentTarget).attr("file-id"),o.fileSelectedAccountMail=$(n).attr("account-email"),o.fileSelectedAccountId=$(n).attr("unique-id")}j(o)})}}else $("#"+e.popId).find(".google-sheet-import-container .empty-sheet-container").addClass("display-flex"),$("#"+e.popId).find(".google-sheet-import-container").attr("no-sheets",!0),i(e.popId);n.page_token&&(t.append($(Q.loadMoreGoogleSheets)),t.find("#hvLoadMoreGoogleSheets").attr("unique-id",e.params.unique_id).attr("page-token",n.page_token).attr("email",e.params.account_email).attr("pop-id",e.popId),t.find("#hvLoadMoreGoogleSheets").off("click").on("click",function(e){var t=$(e.currentTarget);v($(t).attr("pop-id"),$(t).attr("unique-id"),$(t).attr("email"),$(t).attr("page-token"))})),$("#"+e.popId).find("#saveAsListCheckbox").attr("pop-id",e.popId),$("#"+e.popId).find("#saveAsListCheckbox").off("change").on("change",function(e){var t=$(e.currentTarget).attr("pop-id");$(e.currentTarget).is(":checked")?$("#"+t).find(".save-as-list-container .input-container").show():$("#"+t).find(".save-as-list-container .input-container").hide()})}function C(e){var o=t();o.messageFromContentScript1234=!0,o.msgType="workflow",o.screenName=X.screenName,o.configureGContactAccount=!0,o.authcode=e.authcode,o.optionalData=e.optionalData,o.popId=e.popId,X.port.postMessage(o)}function I(e,o){$("#"+e).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeIn(10);var n=t();n.messageFromContentScript1234=!0,n.msgType="workflow",n.fetchGContactAccounts=!0,n.screenName=X.screenName,n.optionalData=o,n.popId=e,X.port.postMessage(n)}function w(e){var t=e.response.google_contacts_accounts,o=$("#"+e.popId);if(0==t.length)o.find(".hv-contacts-container .google-contacts-content").removeClass("display-flex"),o.find(".hv-contacts-container .gcontacts-access-container").addClass("display-flex"),i(e.popId),o.find(".google-contacts-import-container").attr("grant-access",!0);else{o.find(".google-contacts-import-container").attr("grant-access",!1),o.find(".hv-contacts-container .google-contacts-content").removeClass("display-flex"),o.find(".hv-contacts-container .gcontacts-content-container").addClass("display-flex"),o.find(".gcontacts-content-container .gcontacts-list-container").empty(),o.find("#hvGContactImportAccountSelect").empty();for(var n=0;n<t.length;n++){var a=t[n];o.find("#hvGContactImportAccountSelect").append('<option value="'+a.user_id+'" email="'+a.email+'">'+a.email+"</option>")}if(o.find("#hvGContactImportAccountSelect").append('<option value="-1">'+K.addAccount+"</option>"),o.find("#hvGContactImportAccountSelect").attr("pop-id",e.popId),o.find("#hvGContactImportAccountSelect").off("change").on("change",function(e){var t=$(e.currentTarget).attr("pop-id"),o=$(e.currentTarget).val(),n=$(e.currentTarget).find(":selected").attr("email");if("-1"===o){for(var a=[],i=$("#"+t).find("#hvGSheetImportAccountSelect").find("option"),c=0;c<$(i).length;c++){var s=$(i)[c];$(s).text()!==K.addAccount&&a.push($(s).attr("value"))}O(t,"gcontacts",{existingEmails:a})}else $("#"+t).find(".gcontacts-content-container .gcontacts-list-container").empty(),F(t,o,n)}),e.optionalData&&e.optionalData.existingEmails){for(var c=e.optionalData.existingEmails,s=!1,r=0;r<t.length;r++){var d=t[r];if(!c.includes(d.user_id)){$("#"+e.popId).find("#hvGContactImportAccountSelect").val(d.user_id).trigger("change"),s=!0;break}}s||$("#"+e.popId).find("#hvGContactImportAccountSelect").val(t[0].user_id).trigger("change")}else $("#"+e.popId).find("#hvGContactImportAccountSelect").val(t[0].user_id).trigger("change")}}function F(e,o,n){$("#"+e).find(".gcontacts-content-container .gcontacts-loading-container").fadeIn(10);var a=t();a.messageFromContentScript1234=!0,a.msgType="workflow",a.popId=e,a.screenName=X.screenName,a.listGoogleContacts=!0,a.params={account_email:n,unique_id:o},X.port.postMessage(a)}function _(e){$("#"+e.popId).find(".gcontacts-content-container .gcontacts-loading-container").fadeOut(50),$("#"+e.popId).find(".gcontacts-content-container .empty-container").removeClass("display-flex");var t=$("#"+e.popId).find(".gcontacts-content-container .gcontacts-list-container"),o=e.response.emails||[];if(0===o.length)t.removeClass("display-flex").hide(),$("#"+e.popId).find(".gcontacts-content-container .empty-container").addClass("display-flex"),$("#"+e.popId).find(".google-contacts-import-container").attr("no-contacts",!0),i(e.popId);else{$("#"+e.popId).find(".google-contacts-import-container").attr("no-contacts",!1),c(e.popId),t.hasClass("display-flex")||t.addClass("display-flex");for(var n=0;n<o.length;n++){var a=o[n],s=$(Q.googleContactEle);$(s).find(".label-ele").text(a),t.append($(s))}t.find(".google-contact-ele").off("click").on("click",function(e){var t=$(e.currentTarget);$(t).hasClass("google-contact-ele-selected")?$(t).removeClass("google-contact-ele-selected"):$(t).addClass("google-contact-ele-selected")})}}function y(e){0===$("#"+e).find(".hv-contacts-container .google-contacts-import-container").length?($("#"+e).find('.hv-contacts-container .import-contacts-content[import-type="'+J.GOOGLE_CONTACTS+'"]').append($(Q.googleContactsImportContainer)),$("#"+e).find("#hvGcontactsAccessBtn").attr("pop-id",e),$("#"+e).find("#hvGcontactsAccessBtn").off("click").on("click",function(e){O($(e.currentTarget).attr("pop-id"),"gcontacts")}),I(e),i(e)):a(e,"gcontacts");var t=$("#"+e).data("workflowConfig");t.selectedImportType=J.GOOGLE_CONTACTS,j(t)}function A(e){var t=$("#"+e).data("workflowConfig");t.selectedImportType=J.MANUAL,j(t),0===$("#"+e).find(".hv-contacts-container .manual-contacts-container").length?($("#"+e).find('.hv-contacts-container .import-contacts-content[import-type="'+J.MANUAL+'"]').append($(Q.manualContactsContainer)),S(t)):c(e)}function S(e){$("#"+e.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeIn(10);var o=t();o.messageFromContentScript1234=!0,o.msgType="workflow",o.popId=e.popId,o.fetchMergeFields=!0,o.screenName=X.screenName,o.params={is_page:e.assetContent.isPage,asset_id:e.assetContent.assetId,page_id:e.assetContent.pageId},!e.assetContent.isPage&&e.assetContent.customPageDetails&&(o.params.is_custom_asset=!0,o.params.custom_page_id=e.assetContent.customPageDetails.pageId,o.params.custom_asset_id=e.assetContent.assetId),X.port.postMessage(o)}function b(e){$("#"+e.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(50);for(var t=$("#"+e.popId).data("workflowConfig"),o=e.response.merge_fields||[],n=t.assetContent.mfInTemplates||[],a=0;a<n.length;a++){var i=n[a];o.includes(i)||o.push(i)}o.length>0&&(o.includes("Email")&&o.indexOf("Email")>-1&&o.splice(o.indexOf("Email"),1),o.includes("First Name")&&o.indexOf("First Name")>-1&&o.splice(o.indexOf("First Name"),1)),o.push("First Name"),$("#"+e.popId).find(".hv-contacts-container .manual-contacts-container").append($(Q.mergeFieldInputContainer));var s=$("#"+e.popId).find(".hv-contacts-container .merge-field-input-container");s.attr("mfs",o.join(","));for(var r=0;r<3;r++){for(var d=$(Q.mergeFieldInputEle),p=0;p<o.length;p++){var l=o[p],f=$(Q.mergeFieldInput);$(f).find("input").attr("placeholder",l),$(d).find(".merge-field-inputs").append($(f))}s.append($(d))}s.append($(Q.addAnotherMergeFieldEle)),s.find("#manualContactsAddAnotherBtn").attr("log-prefix",t.logPrefix),s.find("#manualContactsAddAnotherBtn").off("click").on("click",function(e){for(var t=$(e.currentTarget).attr("log-prefix"),o=$(e.currentTarget).parent().parent(),n=$(o).attr("mfs").split(","),a=$(Q.mergeFieldInputEle),i=0;i<n.length;i++){var c=n[i],s=$(Q.mergeFieldInput);$(s).find("input").attr("placeholder",c),$(a).find(".merge-field-inputs").append($(s))}$(a).insertBefore($(e.currentTarget).parent()),q(t,"Add Additional Manual Contact")}),c(e.popId)}function T(e){e.selectedFile}function k(e){if(e.selectedFile&&e.fileSelectedAccountMail&&e.fileSelectedAccountId){if($("#"+e.popId).find("#saveAsListCheckbox").is(":checked")){if(""==$("#"+e.popId).find("#contactListName").val().trim())return z(e.popId,K.fillTheListName,"error"),void P(e.popId)}$("#"+e.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeIn(10),E(e)}else z(e.popId,K.chooseSheet,"error"),P(e.popId)}function E(e){var o=t();o.messageFromContentScript1234=!0,o.msgType="workflow",o.popId=e.popId,o.parseGoogleSheet=!0,o.params={unique_id:e.fileSelectedAccountId,file_id:e.selectedFile},X.port.postMessage(o)}function G(e){var t=e.response;if(0==t.emails.length)$("#"+e.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(50),z(e.popId,K.noEmailsPresentInSheet,"error"),P(e.popId);else if(t.emails.length>500)$("#"+e.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(50),z(e.popId,K.noEmailsExceededInSheet,"error"),P(e.popId);else{var o=$("#"+e.popId).data("workflowConfig"),n=o.assetContent;n.toEmails=t.emails,n.listName=$("#"+o.popId).find("#contactListName").val(),n.mergeFields=t.mergeFields||[],n.importType=J.GOOGLE_SHEET,n.unique_id=o.fileSelectedAccountId,n.file_id=o.selectedFile,j(o),N(e.popId)}P(e.popId)}function N(e){var o=$("#"+e).data("workflowConfig"),n=x(o.assetContent);o.assetContent.videoShareUrl=n.video,o.assetContent.thumbnailShareUrl=n.thumbnail,j(o);var a=t();a.insertFromWorkflowPop=!0,a.messageFromContentScript1234=!0,a.msgType="workflow",a.workflowConfig=o,X.port.postMessage(a),$("#"+o.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(100)}function x(e){var t={};return!e.isPage&&e.customPageDetails?(t.video=e.customPageDetails.customerHost+"/page/"+e.customPageDetails.pageDeliveryToken+"?custom_asset_token="+e.deliveryToken+"&org_tok="+e.orgTok,t.thumbnail=e.customPageDetails.customerHost+"/page/thumbnail/"+e.customPageDetails.pageDeliveryToken+"?custom_asset_token="+e.deliveryToken+"&org_tok="+e.orgTok):e.isPage&&e.pageId?(t.video=e.customerHost+e.urlParam+e.deliveryToken+"?org_tok="+e.orgTok,t.thumbnail=e.customerHost+e.thumbnailParam+e.deliveryToken+"?org_tok="+e.orgTok):(t.video=e.customerHost+e.urlParam+e.deliveryToken,t.thumbnail=e.customerHost+e.thumbnailParam+e.deliveryToken),t.thumbnail+=t.thumbnail.includes("?")?"&is_play_time=true":"?is_play_time=true",t}function M(e){$("#"+e.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeIn(10);var t=$("#"+e.popId).find(".gcontacts-content-container .gcontacts-list-container").find(".google-contact-ele-selected");if(0===$(t).length)$("#"+e.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(10),z(e.popId,K.selectContact,"error");else{for(var o=[],n=$(t).length,a=0;a<n;a++){var i=$(t)[a],c=$(i).find(".label-ele").text();o.push(c)}e.assetContent.importType=J.GOOGLE_CONTACTS,e.assetContent.toEmails=o,e.assetContent.listName="",j(e),N(e.popId)}P(e.popId)}function D(e){for(var t=[],o=[],n=$("#"+e.popId).find(".manual-contacts-container .merge-field-input-ele"),a=$(n).length,i=!1,c=!1,s=0;s<a;s++){var r=$(n)[s];$(r).find(".email-input input").removeClass("invalid-email-input");var d=$(r).find(".email-input input").val();if(d){W(d.trim())||($(r).find(".email-input input").addClass("invalid-email-input"),i=!0),t.includes(d.trim())&&($(r).find(".email-input input").addClass("invalid-email-input"),c=!0);for(var p={},l=$(r).find(".merge-field-inputs .merge-field-input input"),f=0;f<$(l).length;f++){var g=$(l)[f];p[$(g).attr("placeholder").toLowerCase()]=$(g).val()}t.push(d.trim()),p.Email=d.trim(),p.email=d.trim(),o.push(p)}}if(i||c)return i?z(e.popId,K.invalidEmailAddress,"error"):z(e.popId,K.duplicateEmailAddress,"error"),void P(e.popId);if(t.length>0){var m=e.assetContent;m.toEmails=t,m.importType=J.MANUAL,m.manualcontacts=o,m.vidAndThumbMfs=($("#"+e.popId).find(".hv-contacts-container .merge-field-input-container").attr("mfs")||"").split(","),m.listName="",j(e),N(e.popId)}else z(e.popId,K.fillContact,"error");P(e.popId)}function O(e,o,n){var a,i;"drive"===o?(a="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/userinfo.email",i="gdrive"):"gcontacts"==o&&(a="https://www.googleapis.com/auth/contacts.readonly https://www.googleapis.com/auth/userinfo.email",i="gcontacts");var c,s=V+"/video/oauth";c=V.includes("local")?"545792173243-j7c0qsehnht1ncch7hdjpdhh8oqmkitt.apps.googleusercontent.com":V.includes("stage")?"545792173243-j7c0qsehnht1ncch7hdjpdhh8oqmkitt.apps.googleusercontent.com":"989612280692-8vs3vmbppgd16ijvnk7uf4nrg3404tqv.apps.googleusercontent.com";var r=t();r.messageFromContentScript1234=!0,r.requestGoogleAccess=!0,r.popId=e,r.url="https://accounts.google.com/o/oauth2/auth?access_type=offline&scope="+a+"&client_id="+c+"&redirect_uri="+s+"&response_type=code&state="+i+"&approval_prompt=force",r.screenName=X.screenName,r.service=o,r.optionalData=n,X.port.postMessage(r)}function L(e){$("#"+e).find(".hv-wf-pop-footer .right-btn-container").find("#contactsFinishBtn").addClass("disabled-btn")}function P(e){$("#"+e).find(".hv-wf-pop-footer .right-btn-container").find("#contactsFinishBtn").removeClass("disabled-btn")}function R(e){$("#"+e).find(".hv-wf-pop-footer .right-btn-container").find(".pop-btn-ele").hide(),$("#"+e).find(".hv-wf-pop-footer .hv-alert-msg-ele").hide()}function H(e){return e&&e.serviceName==X.serviceName&&e.tabId==X.tabId&&e.windowId==X.windowId}function B(e,o){var n=t();n.msgType="workflow",n.messageFromContentScript1234=!0,n.popScreenSwitch=!0,n.screenName=o.targetScreen,n.mode=o.targetMode,n.popId=e,n.workflowConfig=$("#"+e).data("workflowConfig"),X.port.postMessage(n)}function U(e){var t=e.workflowConfig.assetContent||{};t.modes?t.modes.includes("contacts")||t.modes.push("contacts"):t.modes=["contacts"];var o=e.workflowConfig.popId;$("#"+o).find(".hv-wf-pop-header .hv-pop-topbar-ele").removeClass("click-not-allowed").removeAttr("data-tooltip"),!e.disableCreate&&t.modes.includes("create")||$("#"+o).find(".hv-wf-pop-header .hv-create-video").addClass("click-not-allowed").attr("data-tooltip",K.createNotAllowed),t.modes.includes("edit")&&!t.isPage||$("#"+o).find(".hv-wf-pop-header .hv-edit-video").addClass("click-not-allowed").attr("data-tooltip",K.editDisableContent),t.modes.includes("templates")||$("#"+o).find(".hv-wf-pop-header .hv-templates").addClass("click-not-allowed").attr("data-tooltip",K.templateDisableContent),t.modes.includes("contacts")||$("#"+o).find(".hv-wf-pop-header .hv-contacts").addClass("click-not-allowed").attr("data-tooltip",K.contactDisableContent);var n=e.workflowConfig;n.assetContent=t,j(n)}function j(e){$("#"+e.popId).data("workflowConfig",e)}function q(e,o){var n=t();n.messageFromContentScript1234=!0,n.trackWorkflowActivity=!0,n.msgType="workflow",n.actionName=e+" "+o,X.port.postMessage(n)}function z(e,o,n){var a=t();a.messageFromContentScript1234=!0,a.flashAlertInWorkflowPop=!0,a.msgType="workflow",a.popId=e,a.msg=o,a.alertType=n,X.port.postMessage(a)}function W(e){return!!e&&EMAIL_REGEX.test(e.trim())}var X=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.screenName="hv-contacts",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId+"::"+t.screenName}),t}(),V="cijidiollmnkegoghpfobabpecdkeiah"===chrome.runtime.id?"https://www.hippovideo.io":"dnebjjdbjiikcmihpkcanphpbibhofkh"===chrome.runtime.id?"https://stage.hippowiz.com":"http://localhost:3000",J={GOOGLE_SHEET:"1",GOOGLE_CONTACTS:"2",SHEET:"3",MANUAL:"4",HIPPO_CONTACTS:"5"},K={editDisableContent:chrome.i18n.getMessage("create_import_video_to_enable_edit"),templateDisableContent:chrome.i18n.getMessage("get_your_video_ready_to_enable_templates"),contactDisableContent:chrome.i18n.getMessage("complete_your_video_and_email_content_to_add_contacts"),createNotAllowed:chrome.i18n.getMessage("create_not_allowed_in_edit"),importContactsDescription:chrome.i18n.getMessage("import_contacts_from_google_sheet"),addContactDescription:chrome.i18n.getMessage("add_contacts_manually"),importContacts:chrome.i18n.getMessage("import_contacts"),addContacts:chrome.i18n.getMessage("add_contacts"),importFromLocal:chrome.i18n.getMessage("import_from_local"),importFromGoogleSheets:chrome.i18n.getMessage("import_from_google_sheets"),importFromGoogleContacts:chrome.i18n.getMessage("import_from_google_contacts"),chooseFile:chrome.i18n.getMessage("choose_file"),or:chrome.i18n.getMessage("or_text"),dragAndDrop:chrome.i18n.getMessage("choose_file_from_computer"),supportedFormats:chrome.i18n.getMessage("supports_only_xls_xlsx_csv_with_size_5MB"),downloadSampleFile:chrome.i18n.getMessage("download_sample_file"),selectedFile:chrome.i18n.getMessage("selected_file"),accounts:chrome.i18n.getMessage("accounts"),gdriveAccessTxt:chrome.i18n.getMessage("grant_access_to_your_google_drive_account"),grantAccess:chrome.i18n.getMessage("grant_access"),addAccount:chrome.i18n.getMessage("add_account"),noSheetsFound:chrome.i18n.getMessage("no_sheet_found"),gContactsAccessText:chrome.i18n.getMessage("grant_access_to_your_google_contacts_account"),contactsNotFound:chrome.i18n.getMessage("contacts_not_found"),addAnother:chrome.i18n.getMessage("add_another"),finish:chrome.i18n.getMessage("insert_video"),wentWrong:chrome.i18n.getMessage("something_went_wrong"),accessDenied:chrome.i18n.getMessage("access_denied"),chooseSheet:chrome.i18n.getMessage("please_select_sheet_to_continue"),noEmailsPresentInSheet:chrome.i18n.getMessage("email_addresses_are_missing_in_sheet"),noEmailsExceededInSheet:chrome.i18n.getMessage("email_addresses_are_exceeded_in_sheet"),selectContact:chrome.i18n.getMessage("please_choose_atleast_one_contact"),fillContact:chrome.i18n.getMessage("please_fill_atleast_one_email_address"),saveAsList:chrome.i18n.getMessage("save_as_list"),enterListName:chrome.i18n.getMessage("enter_list_name"),fillTheListName:chrome.i18n.getMessage("fill_the_list_name"),
editDisableContent:"Create or import a video to enable editing",templateDisableContent:"Get your video ready to enable Templates.",contactDisableContent:"Complete your video and email content to add contacts",createNotAllowed:"Create not allowed in edit mode",importContactsDescription:"Import contacts from Google Sheet, Google Contacts and Local files to send personalized video email campaign",addContactDescription:"Add contacts manually to send personalized video email campaign",importContacts:"IMPORT CONTACTS",addContacts:"ADD CONTACTS",importFromLocal:"IMPORT FROM LOCAL",importFromGoogleSheets:"IMPORT FROM GOOGLE SHEETS",importFromGoogleContacts:"IMPORT FROM GOOGLE CONTACTS",chooseFile:"Choose File",or:"or",dragAndDrop:"click to choose file from computer",supportedFormats:"Supports only XLS, XLSX, CSV formats with a maximum file size of 5 MB",downloadSampleFile:"Download Sample File",selectedFile:"Selected File:",accounts:"Accounts",gdriveAccessTxt:"Grant access to your Google Drive account to import contacts and merge fields from Google Sheet",grantAccess:"GRANT ACCESS",addAccount:"Add Account",noSheetsFound:"NO SHEETS FOUND",gContactsAccessText:"Grant access to your Google Contacts account to import contacts and merge fields",contactsNotFound:"CONTACTS NOT FOUND",addAnother:"ADD ANOTHER",finish:"INSERT VIDEO",wentWrong:"Something went wrong! Please contact support@hippovideo.io",accessDenied:"Access Denied!",chooseSheet:"Please select a sheet to continue.",noEmailsPresentInSheet:"Email addresses are missing in the sheet you imported. Please select a different sheet.",selectContact:"Please choose at least one contact to continue.",fillContact:"Please fill at least one email address to continue.",saveAsList:"Save as List",enterListName:"Enter List Name",fillTheListName:"Fill the List Name",duplicateEmailAddress:"Contact(s) has duplicate emails. Please check!",invalidEmailAddress:"Contact(s) has invalid emails. Please check!"},Q={contactsContainer:'<div class="hv-pop-content-container hv-contacts-container"></div>',contactScreens:'<div class="hv-contacts-screens"><div class="hv-contact-screen contact-type-selection"></div><div class="hv-contact-screen contact-import-screen"></div></div>',typeSelectionContainer:'<div class="type-selection-container"><div class="contact-type-ele"><div class="description">'+K.importContactsDescription+'</div><div class="hv-btn gradient-btn" option-type="import"><span>'+K.importContacts+'</span></div></div><div class="contact-type-ele"><div class="description">'+K.addContactDescription+'</div><div class="hv-btn gradient-btn" option-type="add"><span>'+K.addContacts+"</span></div></div></div>",importContactsContainer:'<div class="import-contacts-container"></div>',importMenu:'<div class="selectable-menu"><div class="selectable-menu-item" import-type="'+J.GOOGLE_SHEET+'">'+K.importFromGoogleSheets+'</div><div class="selectable-menu-item" import-type="'+J.GOOGLE_CONTACTS+'">'+K.importFromGoogleContacts+'</div><div class="selectable-menu-item" import-type="'+J.MANUAL+'">'+K.addContacts+"</div></div>",importContactContentContainer:'<div class="import-contacts-content-container"><div class="import-contacts-content" import-type="'+J.SHEET+'"></div><div class="import-contacts-content" import-type="'+J.GOOGLE_SHEET+'"></div><div class="import-contacts-content" import-type="'+J.GOOGLE_CONTACTS+'"></div><div class="import-contacts-content" import-type="'+J.MANUAL+'"></div></div>',localSheetImportContainer:'<div class="local-sheet-import-container"><div class="file-selection-container"><div class="file-choose-container"><div class="choose-file">'+K.chooseFile+"</div><div>"+K.or+'</div><div><img src="'+chrome.extension.getURL("/images/injected/upload-selected.svg")+'"></div><div>'+K.dragAndDrop+'</div><input id="hvLocalSheetFile" class="hv-local-sheet-file" type="file" accept=".csv,.xls,.xlsx" visbility="hidden"></div><div class="local-file-import-note"><div class="note">'+K.supportedFormats+'</div><div class="download-link"><a href="https://s3.amazonaws.com/sample-docs/ContactsPersonalization.xlsx">'+K.downloadSampleFile+'</a></div></div></div><div class="file-selected-container"><div class="selected-file">'+K.selectedFile+'</div><div class="selected-file-name"></div><div class="reselect-file"><img src="'+chrome.extension.getURL("/images/injected/icon-close.png")+'"></div></div></div>',googleSheetImportContainer:'<div class="google-sheet-import-container"><div class="accounts-container"><div class="account-text">'+K.accounts+'</div><div class="account-select"><select id="hvGSheetImportAccountSelect"></select></div></div><div class="gsheet-account-data-container"><div class="gsheet-list-container"><div class="gsheet-listing-container hv-custom-scroll"></div><div class="save-as-list-container"><div class="list-label"><input type="checkbox" id="saveAsListCheckbox"><label for="saveAsListCheckbox">'+K.saveAsList+'</label></div><div class="input-container"><input type="text" id="contactListName" placeholder="'+K.enterListName+'"></div></div></div><div class="gsheet-access-container"><div class="img-container"><img src="'+chrome.extension.getURL("/images/injected/google_sheets_icon.png")+'"></div><div class="hv-text">'+K.gdriveAccessTxt+'</div><div class="hv-btn">'+K.grantAccess+'</div></div><div class="empty-sheet-container"><div>'+K.noSheetsFound+'</div></div><div class="sheet-loading"><div class="loading-container"><div class="pop-loading"><div></div><div></div><div></div><div></div></div></div></div></div></div>',googleContactsImportContainer:'<div class="google-contacts-import-container"><div class="google-contacts-content gcontacts-content-container"><div class="accounts-container"><div class="account-text">'+K.accounts+'</div><div class="account-select"><select id="hvGContactImportAccountSelect"></select></div></div><div class="gcontacts-content empty-container"><div>'+K.contactsNotFound+'</div></div><div class="gcontacts-content gcontacts-list-container hv-custom-scroll"></div><div class="gcontacts-content gcontacts-loading-container"><div class="gcontacts-loading"><div class="pop-loading"><div></div><div></div><div></div><div></div></div></div></div></div><div class="google-contacts-content gcontacts-access-container"><div class="img-container"><img src="'+chrome.extension.getURL("/images/injected/google-contacts-logo.png")+'"></div><div class="access-text">'+K.gContactsAccessText+'</div><div class="gcontact-access-btn" id="hvGcontactsAccessBtn">'+K.grantAccess+"</div></div></div>",manualContactsContainer:'<div class="manual-contacts-container"></div>',googleSheetElement:'<div class="google-sheet-ele"><div class="logo-container"><img src="'+chrome.extension.getURL("/images/injected/spreadsheet_icon.png")+'"></div><div class="sheet-name"></div></div>',loadMoreGoogleSheets:'<div class="load-more-sheets"><div id="hvLoadMoreGoogleSheets">LOAD MORE</div></div>',googleContactEle:'<div class="google-contact-ele"><label class="label-ele"></label></div>',mergeFieldInputContainer:'<div class="merge-field-input-container hv-custom-scroll"></div>',mergeFieldInputEle:'<div class="merge-field-input-ele"><div class="email-input"><input type="text" placeholder="'+chrome.i18n.getMessage("email")+'"></div><div class="merge-field-inputs"></div></div>',mergeFieldInput:'<div class="merge-field-input"><input type="text"></div>',addAnotherMergeFieldEle:'<div class="add-another-btn-container"><span id="manualContactsAddAnotherBtn">'+K.addAnother+"</span></div>",buttonEle:'<div class="pop-btn-ele"><span></span></div>'};X.port.onMessage.addListener(function(e,t,n){if(e){var a=e.backgroundRecordingMessage,i=e.data||{};H(i)&&("handleTopMenuClick"==a&&i.menuClickMetadata.previousSelection==X.screenName&&B(i.popId,i.menuClickMetadata),"popScreenSwitch"===a&&i.screenName==X.screenName&&(U(i),o(i)),"googleAccessResponse"==a&&i.screenName==X.screenName&&(i.status?"drive"===i.service?g(i):"gcontacts"===i.service&&C(i):($("#"+i.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(10),z(i.popId,K.wentWrong,"error"))),"configureGDriveAccountResponse"==a&&i.screenName==X.screenName&&(i.status?m(i.popId,i.optionalData):($("#"+i.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(10),z(i.popId,K.wentWrong,"error"))),"fetchGdriveAccountsResponse"==a&&i.screenName==X.screenName&&($("#"+i.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(10),i.status?h(i):z(i.popId,K.wentWrong,"error")),"listDriveFilesResponse"==a&&i.screenName==X.screenName&&(i.status?u(i):($("#"+i.popId).find(".google-sheet-import-container .sheet-loading").fadeOut(50),z(i.popId,K.wentWrong,"error"))),"configureGContactAccountResponse"==a&&i.screenName==X.screenName&&(i.status?I(i.popId,i.optionalData):($("#"+i.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(10),z(i.popId,K.wentWrong,"error"))),"fetchGContactAccountResponse"==a&&i.screenName==X.screenName&&($("#"+i.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(10),i.status?w(i):z(i.popId,K.wentWrong,"error")),"fetchGoogleContactsResponse"==a&&i.screenName==X.screenName&&(i.status?_(i):($("#"+i.popId).find(".gcontacts-content-container .gcontacts-loading-container").fadeOut(50),z(i.popId,K.wentWrong,"error"))),"fetchMergeFieldsResponse"==a&&i.screenName==X.screenName&&(i.status?b(i):($("#"+i.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(10),z(i.popId,K.wentWrong,"error"))),"parseGoogleSheetResponse"===a&&(i.status?i.response.status?G(i):z(i.popId,i.response.msg?i.response.msg:K.wentWrong,"error"):($("#"+i.popId).find(".hv-wf-pop-body .hv-wf-pop-loading").fadeOut(10),P(i.popId),z(i.popId,K.wentWrong,"error"))))}})})}