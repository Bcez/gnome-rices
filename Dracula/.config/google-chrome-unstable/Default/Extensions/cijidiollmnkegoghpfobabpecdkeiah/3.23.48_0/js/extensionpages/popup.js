function initialize(){port.onMessage.addListener(function(e,i,o){if("google-signup-success"==e.backgroundRecordingMessage&&checkIfUserSignedIn(),"currentstate"==e.backgroundRecordingMessage&&(!e.data.showNetworkAlert&&e.data.uploadErrorCount&&e.data.uploadErrorCount>1&&(hasUploadIssue=!0,$("#uploadWarning").empty().load(chrome.extension.getURL("html/extension/upload-error-warning.html"),function(){initI18n($("#uploadWarning")),$("#uploadWarning").removeClass("disp-none"),initUploadWarning()})),e.data.showNetworkAlert&&$("#networkHtml").empty().load(chrome.extension.getURL("html/extension/pop-retry.html"),function(){initI18n($("#networkHtml")),initUploadStatus()}),e.data.isRecordingInitiated&&!e.data.isRecording?e.data.waitingForScreenPermission?_displayPreRecordingPage("Waiting for screen permission","screenPermissionWait"):_displayPreRecordingPage("Initializing recording.. Please wait."):e.data.isRecording&&e.data.recordingConfiguration&&e.data.recordingConfiguration.showWebcamTour?($("#recording-tab-content-cover").removeClass("disp-none"),$("#record-btn").addClass("grey-out-bg-img")):(e.data.isRecording||e.data.isPaused)&&(isGuestUser&&_displayRecordingPage(),recordConfiguration=e.data.recordingConfiguration,setRecordingOptions(recordConfiguration),showFinish(),e.data.isPaused&&($("#pause-record-btn").hide(),$("#resume-record-btn").show(),$(".record-title").text(chrome.i18n.getMessage("paused_text")))),e.data.isSlowNetwork),"stopWebcamTour"==e.backgroundRecordingMessage&&($("#recording-tab-content-cover").addClass("disp-none"),$("#record-btn").removeClass("grey-out-bg-img")),"webcamlist"==e.backgroundRecordingMessage){if(e.data.success){audioDeviceAvailable=!1,videoDeviceAvailable=!1,$(".webcam-source-list").empty(),$(".audio-source-list").empty(),webcamPermissionDenied=!0;for(var r=0;r<e.data.devices.length;r++){var t=e.data.devices[r];"audioinput"==t.kind?($(".audio-source-list").append($("<option>",{value:t.deviceId,text:t.label,selected:"default"==t.deviceId})),userPreferences.audioSource===t.deviceId&&$(".audio-source-list").val(userPreferences.audioSource),audioDeviceAvailable=!0,isEmpty(t.label)||(webcamPermissionDenied=!1)):"videoinput"==t.kind&&($(".webcam-source-list").append($("<option>",{value:t.deviceId,text:t.label,selected:"default"==t.deviceId})),userPreferences.webcamSource===t.deviceId&&$(".webcam-source-list").val(userPreferences.webcamSource),videoDeviceAvailable=!0,isEmpty(t.label)||(webcamPermissionDenied=!1))}audioDeviceAvailable||updateRecordingOptions(!1,"audio"),videoDeviceAvailable||updateRecordingOptions(!1,"webcam")}else 0==e.data.success&&(webcamPermissionDenied=!0);$(".webcam-source-list option[value="+userPreferences.webcamSource+"]").length>0&&startDeviceTesting(),console.log(e.data)}}),port.postMessage({getState:!0,getWebcams:!0,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()})}function checkFaultyMic(e){setTimeout(function(){e&&0===e.volume&&port.postMessage({faultyMicSource:!0,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()})},2e3)}function handleHamburgerMenu(){$(this).toggleClass("open")}function initI18n(e){for(var i=0;i<e.length;i++){var o=e[i],r=o.innerHTML.toString(),t=r.replace(/__MSG_(\w+)__/g,function(e,i){return i?chrome.i18n.getMessage(i):""});t!=r&&(o.innerHTML=t)}}function createUUID(e){var i=(new Date).getTime(),o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var o=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==e?o:3&o|8).toString(16)});return $("#recordinguuid").val(o),port.postMessage({messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val(),uuidfrom:e}),o}function openAdvancedSettings(){trackInMixpanel("Advanced Settings ext",{email:userEmail}),recordConfiguration.defaultTab=document.getElementById("recordScreen").checked,checkAndShowAudioCheckboxes(),$(".hippo-extension-container").hide(),$(".advanced-setting-options").removeClass("hide").slideDown(),createUUID("openAdvancedSettings")}function closeAdvancedSettings(){$(".advanced-setting-options").addClass("hide"),$(".hippo-extension-container").fadeIn(),recordConfiguration.webCam&&($("#webcam-preview-checkbox")[0].checked?($(".webcam-selected-img").hide(),$(".webcam-box-live").show()):($(".webcam-selected-img").show(),$(".webcam-box-live").hide())),hideWebcamShapeInfo()}function openProfileSettings(){handleGoToLibraryOption(!1),trackInMixpanel("open more option ext",{email:userEmail}),$(".profile-settings-menu").removeClass("hide").fadeIn(400),createUUID("openProfileSettings")}function closeProfileSettings(){handleGoToLibraryOption(!0),$(".profile-settings-menu").fadeOut()}function tabChanged(){trackInMixpanel("record screen ext",{email:userEmail}),recordConfiguration.defaultTab=document.getElementById("recordScreen").checked,saveDefaults(),updateRecordingPreferences("fullDesktop",document.getElementById("recordScreen").checked),checkAndShowAudioCheckboxes()}function startRecording(){if(webcamPermissionDenied&&(recordConfiguration.webCam||recordConfiguration.audio))return void requestPermission();isRecordLimitExceed||(preCheckAndInitiateRecording(),setUserdataOnLowerThird())}function setUserdataOnLowerThird(){$(".lowerThirdUserNameTextSet").text(userNameDisplay),$(".lowerThirdUserDesignationTextSet").text(userDesignation),"large"===$(".webcam-size").val()&&$("hvRectLowerthird-Container").css("width","15%")}function initRecording(){if(trackInMixpanel("start recording ext",{email:userEmail}),recordConfiguration.fromPopup=!0,recordConfiguration.initiator="popup",recordConfiguration.tabRecording=recordConfiguration.screenRecord&&!document.getElementById("recordScreen").checked,recordConfiguration.separateLayer=!document.getElementById("makeMyWebcamVisible").checked,recordConfiguration.resolution=$("#vdo-resolution-list").val(),recordConfiguration.systemAudio="mac"!=os&&"linux"!=os&&$("#system-audio-checkbox")[0].checked,recordConfiguration.tabAudio=$("#tab-audio-checkbox")[0].checked,recordConfiguration.highlights=$("#highlight-checkbox")[0].checked,recordConfiguration.webcamPosition=$(".hv-webcam-position li.hv-webcam-selected").attr("data-webcamposition"),recordConfiguration.aspectRatio=$(".webcam-aspect-ratio").val(),recordConfiguration.webcamSize=$(".webcam-size").val(),recordConfiguration.lowerThird=$("#lower-Third-checkbox")[0].checked,recordConfiguration.webcamShape=$(".hv-webcam-shape li.hv-webcam-selected").attr("data-webcamshape"),"circle"==recordConfiguration.webcamShape?recordConfiguration.separateLayer=!1:disableLowerThirdCheckBox(),recordConfiguration.fullDesktop=document.getElementById("recordScreen").checked,recordConfiguration.isDefaultFullDesktop=document.getElementById("fullDesktop-default-checkbox").checked,recordConfiguration.webCam){var e=document.getElementById("mirrorWebCamCheckBox"),i=!0;null!=e&&(i=e.checked),recordConfiguration.isMirrorWebCam=void 0==i||i}console.log("recordConfiguration   -----\x3e   "+recordConfiguration),recordConfiguration.switchTabAlertShown=!1,updateRecordingPreferences("webcamSource",$(".webcam-source-list").val()),updateRecordingPreferences("audioSource",$(".audio-source-list").val()),$(".webcam-source-list").find("option").length>1&&(recordConfiguration.webcamSource=$(".webcam-source-list").val()),$(".audio-source-list").find("option").length>1&&(recordConfiguration.audioSource=$(".audio-source-list").val()),createUUID("initRecording"),port.postMessage({showCameraOnOtherTabs:(recordConfiguration.webCam||recordConfiguration.pseudoWebcam)&&!recordConfiguration.separateLayer,doBackgroundRecording:!0,config:recordConfiguration,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()}),window.close()}function finishRecording(){trackInMixpanel("stop recording ext",{email:userEmail}),port.postMessage({stopBackgroundRecording:!0,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()}),setInterval(function(){window.close()},1e3)}function pauseResumeRecording(){port.postMessage({togglePauseResume:!0,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()}),window.close()}function showFinish(){$("#recording-tab-content").addClass("disp-none"),$("#tabsDiv").hide(),$("#record-btn").unbind("click"),recordConfiguration.screenRecord||$("#screenCapture").hide(),recordConfiguration.webCam||recordConfiguration.pseudoWebcam||$("#webcamCapture").hide(),recordConfiguration.audio||$("#audioCapture").hide(),$("#stop-recording-tab-content").removeClass("disp-none"),$("#stop-record-btn").bind("click",finishRecording),$("#pause-record-btn, #resume-record-btn").bind("click",pauseResumeRecording),$(".cancel-btn").bind("click",cancelRecording)}function registerCallback(e){console.log(e),chrome.runtime.lastError||(chrome.storage.local.set({registered:e}),chrome.storage.local.set({token_update:!1}),chrome.storage.sync.get(["wizUserEmail","wizAuthToken","wizDigest"],function(i){var o={url:server+"/notifications/update_device_specific_token",type:"post",data:{authentication_token:i.wizAuthToken,email:i.wizUserEmail,registration_token:e,device:"app_chrome_extension"}};$.ajax({url:o.url,method:"post",data:o.data,success:function(e){0==e.code&&chrome.storage.local.set({token_update:!0})},error:function(e){}})}))}function checkIfUserSignedIn(){chrome.storage.sync.get(["wizUserEmail","wizAuthToken","wizDigest"],function(e){chrome.storage.local.get("token_update",function(e){if(!e.token_update){var i=["989612280692"];chrome.gcm.register(i,registerCallback)}}),console.log("Getting from storage >>>>>>>>>>>>> ",e);var i={authentication_token:e.wizAuthToken,email:e.wizUserEmail};void 0!==e.wizDigest&&""!==e.wizDigest?(console.log("Show for Digest video recording..."),digest=e.wizDigest,_displayPage()):$.ajax({url:server+"/api/user/token_valid.json",method:"POST",data:i,success:function(i){if(i.status){if(i.is_lower_third_enabled)try{userFirstName=i.user_info.first_name,userLastName=i.user_info.last_name,userFirstName||(userFirstName=i.user_info.email.split("@")[0]),userNameDisplay=userFirstName,userLastName&&(userNameDisplay=userFirstName+" "+userLastName),$("#lowerThirdUserNameTextSet").text(userNameDisplay),userDesignation=i.user_info.designation,userDesignation||(userDesignation=i.user_info.individual_segment),chrome.storage.local.set({userNameDisplay:userNameDisplay}),chrome.storage.local.set({userDesignation:userDesignation})}catch(e){console.log("Lower Third Error = ",e)}i.record_limit_exceed&&(isRecordLimitExceed=!0,$("#recordLimitExceed").show(),$("#record-btn").addClass("disabled"),$("#createNewVideo").hide()),i.can_show_circle_webcam?$(".hv-webcam-shape").show():(enableAspectRatio(),enableMakeMyWebcamVisible()),i.is_lower_third_enabled||($(".hv-lowerthird-checkbox").hide(),$("#lower-Third-checkbox").attr("checked",!1)),i.allow_recording||($(".recording-not-allowed").show(),$("#createNewVideo").hide(),updateRecordingOptions(!1,"webcam")),"480"==i.resolution?($("#resolution1080").prop("disabled",!0),$("#resolution720").prop("disabled",!0),"1080"===userPreferences.resolution||"720"===userPreferences.resolution?$("#resolution480").prop("selected",!0):$("#resolution"+userPreferences.resolution).prop("selected",!0)):"720"==i.resolution?($("#resolution1080").prop("disabled",!0),"1080"===userPreferences.resolution?$("#resolution720").prop("selected",!0):$("#resolution"+userPreferences.resolution).prop("selected",!0)):$("#resolution"+userPreferences.resolution).prop("selected",!0),chrome.storage.local.set({changeBitrate:i.change_bitrate,wizUserId:i.user_info.user_id,isFreeUser:i.is_free_user,isLifeTimePlan:i.is_lifetime_plan}),authToken=e.wizAuthToken,userEmail=e.wizUserEmail;var o=i.is_guest;isSalesUser=i.show_contacts,isFreeUser=i.is_free_user,canShowCircleWebcam=i.can_show_circle_webcam,o?($(".notification-bell").hide(),$(".more-option").hide(),isGuestUser=!0,_hideInitialLoading(),initialize()):(isGuestUser=!1,_displayPage(),chrome.storage.sync.set({hide_guest_signup_btn:!0},function(){})),3e5!==i.record_max_time&&6e5!==i.record_max_time||isGuestUser||($(".record-time-limit").text(i.record_max_time/1e3/60),$("#advancedSettingDiv").addClass("edit-record-box-free"),$("#fiveMinWarnning").show()),i.dynamicIntegConfig&&port.postMessage({dynamicIntegConfig:!0,config:i.dynamicIntegConfig,integUrls:i.dynamicIntegUrls,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()}),port.postMessage({setFreeUser:!0,isFreeUser:isFreeUser,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()}),i.allow_referral&&$(".referral-link-div").show(),_setMoreOption(i)}else authToken=void 0,userEmail=void 0,_displayPage()},error:function(e){authToken=void 0,userEmail=void 0,_displayPage()}})})}function checkForUpdates(){chrome.runtime.requestUpdateCheck(function(e){"update_available"==e?console.log("update pending..."):"no_update"==e?console.log("no update found"):"throttled"==e?console.log("Oops, I'm asking too frequently - I need to back off."):console.log("Extension update status not captured...",e)})}function _displayPage(){_hideInitialLoading(),allUrlsPermission&&(void 0!==authToken?(_displayRecordPage(),initialize()):void 0!==digest?(_displayRecordingPage(),initialize()):_displaySignupPage())}function _hideInitialLoading(){$("#initialLoading").hide()}function _displayRecordPage(){-1!=chrome.runtime.getManifest().name.toLowerCase().indexOf("lessonly")?$("#lessonly-home").removeClass("disp-none"):($("#recordPage").show(),$("#recording-tab-content").removeClass("disp-none"),$("#videoCount").hide(),$("#loginPage").hide(),$("#tabsDiv").show(),showRecordingTab())}function _displayPreRecordingPage(e,i){$("#recording-tab-content").addClass("disp-none"),$("#stop-recording-tab-content").removeClass("disp-none"),$("#stop-record-btn").addClass("disabled"),$(".pop-outside-click").addClass("disp-none"),$("#pause-record-btn").hide(),$("#stop-recording-tab-content").attr("disabled","disabled"),$(".record-title").hide(),$(".waiting-title").show(),$(".being-created-msg").hide(),$(".will-be-created-msg").show(),"screenPermissionWait"==i&&($(".pop-outside-click").removeClass("disp-none"),openPermissionVideo(),$(".cancel-btn").bind("click",function(){cancelRecording({type:i})})),recordConfiguration.screenRecord||$("#screenCapture").hide(),recordConfiguration.webCam||recordConfiguration.pseudoWebcam||$("#webcamCapture").hide(),recordConfiguration.audio||$("#audioCapture").hide(),$("#waiting-msg").html(e)}function _displayRecordingPage(){$("#recording-tab-content").removeClass("disp-none"),$("#loginPage").hide(),$("#tabsDiv").hide()}function _displaySignupPage(){$("#loginPage").show(),$("#recordPage").hide(),$("#tabsDiv").hide(),$("#wiz-google-signup").unbind("click").bind("click",googleSignup),$("#wiz-google-signout").unbind("click").bind("click",googleSignout),chrome.storage.sync.get(["hide_guest_signup_btn"],function(e){var i=e.hide_guest_signup_btn;void 0==i||0==i?($("#guest_signup").show(),$("#guest_signup").unbind("click").bind("click",guestSignUp)):$("#guest_signup").hide()}),setBadgeText(""),$("#wiz-signup").unbind("click").bind("click",{url:server+"/users/register",type:1},loginClick),$("#wiz-signin").unbind("click").bind("click",{url:server+"/users/sign_in",type:2},loginClick)}function signout(){console.log("sign out called ...."),port.postMessage({signout:!0,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()}),setTimeout(function(){window.close()},500)}function googleSignup(){console.log("google sign up called...."),port.postMessage({googleSignup:!0,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()})}function openTab(e){chrome.tabs.create({url:e})}function googleSignout(){console.log("google sign out called...."),port.postMessage({googleSignout:!0,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()})}function guestSignUp(){chrome.storage.sync.get(["wizUserEmail","wizAuthToken"],function(e){void 0==e.wizUserEmail||void 0==e.wizAuthToken||0==e.wizUserEmail.length||0==e.wizAuthToken.length?$.ajax({url:server+"/guest/sign_up.json",method:"POST",success:function(e){e.status&&(chrome.storage.sync.set({wizUserEmail:e.email,wizAuthToken:e.auth_token},function(){}),authToken=e.auth_token,userEmail=e.email,_displayRecordPage(),$(".notification-bell").hide(),$(".more-option").hide())}}):(authToken=e.wizAuthToken,userEmail=e.wizUserEmail,_displayRecordPage(),$(".notification-bell").hide(),$(".more-option").hide())})}function loginClick(e){trackInMixpanel(1===e.data.type?"signup ext":"signin ext"),chrome.tabs.create({url:e.data.url})}function showRecordingTab(){$("#recording-tab-content").show(),$(".recent-videos-container").hide(),$(".recent-notifications-container").hide(),startDeviceTesting(),createUUID("showRecordingTab")}function showNotificationsTab(){trackInMixpanel("show library ext",{email:userEmail}),$("#recording-tab-content").hide(),$(".recent-notifications-container").fadeIn(400),$(".profile-settings-menu").fadeOut(400),fetchRecentVideos()}function showLibraryTab(){trackInMixpanel("show library ext",{email:userEmail}),$("#recording-tab-content").hide(),$(".recent-videos-container").fadeIn(400),$(".profile-settings-menu").fadeOut(400),$(".recent-notifications-container").fadeOut(400),$("#seeAllVideos").addClass("disp-none"),fetchRecentVideos(),createUUID("showLibraryTab")}function updateRecordingPreferences(e,i,o){chrome.storage.sync.get(["userPreferences","recordingDefaults"],function(r){var t=r.userPreferences,n=r.recordingDefaults;void 0==t&&(t={}),t[e]=i,chrome.storage.sync.set({userPreferences:t},function(){}),void 0!=t&&port.postMessage({recordConfigUpdated:!0,recordConfiguration:t,recordingDefaults:n,messageFromContentScript1234:!0,recordinguuid:$("#recordinguuid").val()}),o&&o()})}function setRecordingOptions(e){$("#webcam-preview-checkbox").attr("checked",userPreferences.webcamPreview),$("#lower-Third-checkbox").attr("checked",userPreferences.lowerThird),$("#makeMyWebcamVisible").attr("checked",userPreferences.webcamVisible),$("#system-audio-checkbox").attr("checked",userPreferences.systemAudio),$("#fullDesktop-default-checkbox").attr("checked",userPreferences.isDefaultFullDesktop),$("#tab-audio-checkbox").attr("checked",userPreferences.tabAudio),$("#highlight-checkbox").attr("checked",userPreferences.highlights),$(".hv-webcam-position li[data-webcamposition='"+userPreferences.webcamPosition+"']").addClass("hv-webcam-selected"),$(".webcam-aspect-ratio").val(userPreferences.aspectRatio),$(".webcam-size").val(userPreferences.webcamSize),$(".hv-webcam-shape li[data-webcamshape='"+userPreferences.webcamShape+"']").addClass("hv-webcam-selected"),$(".vdo-resolution-list").val(userPreferences.resolution),$("#mirrorWebCamCheckBox").length>0&&(void 0!=userPreferences.isMirrorWebCam?$("#mirrorWebCamCheckBox").attr("checked",userPreferences.isMirrorWebCam):(userPreferences.isMirrorWebCam=!0,$("#mirrorWebCamCheckBox").attr("checked",!0)),toggleWebcam(userPreferences.isMirrorWebCam));var i=userPreferences.webcamShape;updateRecordingOptions(e.screenRecord,"screen"),updateRecordingOptions(e.webCam,"webcam"),updateRecordingOptions(e.audio,"audio"),$("#recordScreen").attr("checked",userPreferences.fullDesktop),0==userPreferences.showGitomerImg&&($("#videoTipsWithImg").hide(),$("#videoTipsWithOutImg").show()),userPreferences.webcamShape=i,"circle"==userPreferences.webcamShape&&e.screenRecord?(disableAspectRatio(),disableMakeMyWebcamVisible(),enableLowerThirdCheckBox()):"rectangle"==userPreferences.webcamShape&&e.screenRecord&&(enableAspectRatio(),disableLowerThirdCheckBox(),enableMakeMyWebcamVisible()),e.screenRecord||e.webCam||e.audio||showAtleastOneOptionAlert()}function showAtleastOneOptionAlert(){$("#recordOptionWarning").show(),$(".record-btn-container").addClass("record-btn-warning")}function hideAtleastOneOptionAlert(){$("#recordOptionWarning").hide(),$(".record-btn-container").removeClass("record-btn-warning")}function recordingOption(e){e&&(trackInMixpanel("recording options changed ext",{email:userEmail}),hideAtleastOneOptionAlert(),$(".selected-opt:visible").length<=1&&e.currentTarget.classList.contains("selected-opt")||(e.currentTarget.classList.contains("screen-record")&&userPreferences.isScreenRecordEnabled?updateRecordingOptions(!recordConfiguration.screenRecord,"screen"):e.currentTarget.classList.contains("webcam-record")&&videoDeviceAvailable?(updateRecordingOptions(!recordConfiguration.webCam,"webcam"),recordConfiguration.webCam?startDeviceTesting():stopPreviewDevices("VIDEO")):e.currentTarget.classList.contains("audio-record")&&audioDeviceAvailable&&(updateRecordingOptions(!recordConfiguration.audio,"audio"),recordConfiguration.audio?startDeviceTesting():stopPreviewDevices("AUDIO"))))}function updateRecordingOptions(e,i){"screen"==i?(e?($(".toggleWrapper").show(),"circle"==getCurrentWebcamShape()?disableAspectRatio():enableAspectRatio()):($(".toggleWrapper").hide(),enableAspectRatio()),recordConfiguration.screenRecord=e):"webcam"==i?(recordConfiguration.webCam=e,e?$("#mirroWebCamDiv").show():$("#mirroWebCamDiv").hide()):"audio"==i&&(recordConfiguration.audio=e),saveDefaults(),e?($("."+i+"-box-live").show(),$("."+i+"-box").hide(),$("#"+i+"Record").addClass("selected-opt"),$("."+i+"-selected-tick").removeClass("disp-none"),$("."+i+"-disable-cover").hide(),$("."+i+"-wrap-box").removeClass("grey-change"),$("."+i+"-unselected").addClass("disp-none")):($("."+i+"-box-live").hide(),$("."+i+"-box").show(),$("#"+i+"Record").removeClass("selected-opt"),$("."+i+"-selected-tick").addClass("disp-none"),$("."+i+"-disable-cover").show(),$("."+i+"-wrap-box").addClass("grey-change"),$("."+i+"-unselected").removeClass("disp-none")),recordConfiguration.webCam?$("#webcam-preview-checkbox")[0].checked?($(".webcam-selected-img").hide(),$(".webcam-box-live").show()):($(".webcam-selected-img").show(),$(".webcam-box-live").hide()):($(".webcam-selected-img").hide(),$(".webcam-box-live").hide(),$(".webcam-box").show()),recordConfiguration.webCam&&!recordConfiguration.screenRecord?(recordConfiguration.separateLayer=!1,$(".webcam-only-disable-cover").show(),disableLowerThirdCheckBox()):($(".webcam-only-disable-cover").hide(),"circle"==getCurrentWebcamShape()?(enableLowerThirdCheckBox(),disableMakeMyWebcamVisible()):"rectangle"==getCurrentWebcamShape()&&(disableLowerThirdCheckBox(),enableMakeMyWebcamVisible())),checkAndShowAudioCheckboxes()}function checkAndShowAudioCheckboxes(){"mac"!=os&&"linux"!=os&&recordConfiguration.screenRecord&&recordConfiguration.defaultTab?$(".system-audio-chk-container").show():$(".system-audio-chk-container").hide(),recordConfiguration.defaultTab?$(".tab-audio-chk-container").hide():$(".tab-audio-chk-container").show()}function fetchRecentVideos(){trackInMixpanel("all videos ext",{email:userEmail}),$(".recent-video-loading").removeClass("disp-none"),$("#recentVideoList").hide(),stopPreviewDevices("VIDEO");var e={url:server+"/api/video/recent_videos.json",type:"POST",data:{authentication_token:authToken,email:userEmail,limit:20}};$.ajax({url:e.url,method:"POST",data:e.data,success:function(e){constructVideoNode(e.libraries)},error:function(e){console.log("hippowiz login failed >>> "+e)}})}function constructVideoNode(e){var i=document.getElementById("template-list-item"),o=i.innerHTML,r="";for(var t in e){var n=e[t];console.log(n),r+=o.replace(/{{id}}/g,n.id).replace(/{{video_url}}/g,server+"/video/view/"+n.id).replace(/{{title}}/g,n.title).replace(/{{url}}/g,n.url).replace(/{{created_at}}/g,n.created_at).replace(/{{num_played}}/g,n.num_played).replace(/{{share_url}}/g,n.url).replace(/{{edit_url}}/g,server+"/video/view/"+n.id+"?tag=edit").replace(/{{thumb}}/g,n.processing?"/images/extension/video-processing-thumbnail.png":n.thumbnail_url)}if($("#videoCount").show(),$("#recentVideoList").show(),e.length<1?document.getElementById("emptyLib").style.display="block":document.getElementById("recentVideoList").innerHTML=r,$(".recent-video-loading").addClass("disp-none"),e.length>=20&&$("#seeAllVideos").removeClass("disp-none"),copyToClipboard&&copyToClipboard.destroy(),copyToClipboard=new ClipboardJS(".copy-share-link",{target:function(e){var i=e.id,o=(i||"").replace("/play/","/thumbnail/");return o+=o.includes("?")?"&is_play_time=true":"?is_play_time=true",copyShareUrl(i,o)}}),copyToClipboard.on("success",function(e){var i=e.trigger;$("#copyLinkWithThumbnailTarget").hide(),$(i).siblings(".copied-success-msg").show().delay(3e3).fadeOut()}),$(".recent-video-list").mouseleave(showHideShareContent),$(".hv-recent-options").mouseenter(hvRecentOptionsHover),$(".hv-recent-options").mouseleave(hvRecentOptionsLeave),$(".video-list-box").scroll(showGoToLibrary),isSalesUser){$(".recent-video-id").each(function(){var e=$(this).attr("id"),i=($(this),server+"/contacts/home?asset_id="+e+"&to_show_draft_video=true");$(this).find(".hv-recent-sendmail").attr("href",i)});$(".hv-recent-sendmail img").attr("src","/images/extension/hv-new-mail.svg"),$(".hv-recent-sendmail span").text("Send Mail")}isFreeUser&&($(".hv-recent-sendmail").remove(),$(".hv-recent-options").addClass("hv-recent-hover"),$(".hv-recent-options").mouseleave(hvRecentOptionsHover))}function handleGoToLibraryOption(e){$(".recent-videos-container:visible").length>0&&(1==e?$("#seeAllVideos").removeClass("disp-none"):$("#seeAllVideos").addClass("disp-none"))}function fetchNotifications(){handleGoToLibraryOption(!1),$("#view-notification-loader").show();var e=$("#view-all-notifications").attr("next_start");chrome.browserAction.setBadgeText({text:""}),trackInMixpanel("notifications clicked from extension",{email:userEmail}),$(".recent-notifications-container").show();var i={url:server+"/notifications/show",type:"GET",data:{authentication_token:authToken,email:userEmail,from:parseInt(e),to:parseInt(e)+10-1}};$.ajax({url:i.url,method:"GET",data:i.data,success:function(i){0==i.code&&($("#view-notification-loader").hide(),constructNotificationsNode(i.notifications.data,e))},error:function(e){$("#view-notification-loader").hide(),console.log("hippowiz login failed >>> "+e)}});var i={url:server+"/notifications/clear_batch_count",type:"GET",data:{authentication_token:authToken,email:userEmail}};$.ajax({url:i.url,method:"GET",data:i.data,success:function(e){0==e.code&&$(".notification_count").hide()},error:function(e){console.log("hippowiz login failed >>> "+e)}}),createUUID("fetchNotifications")}function notificationRead(e){var i=e.currentTarget.attributes.notification_id.nodeValue;console.log(e);var o={url:server+"/notifications/mark_read?notification_id="+i,type:"GET",data:{authentication_token:authToken,email:userEmail}};$.ajax({url:o.url,method:"GET",data:o.data,success:function(e){0==e.code&&$("#notification_video_id-"+i).addClass("reed")},error:function(e){console.log("hippowiz login failed >>> "+e)}}),openTab(e.currentTarget.attributes.notification_link.nodeValue)}function constructNotificationsNode(e,i){var o=document.getElementById("notifications-list-item"),r=o.innerHTML,t="";e.length<10?$(".view-all-box").hide():$("#view-all-notifications").click(function(e){fetchNotifications()});var n=$("#view-all-notifications")[0],a=parseInt(i)+e.length;n.setAttribute("next_start",a.toString());for(var c in e){var s=e[c],d="";switch(s.type){case 0:d="<img class='thumb-pic' src='/images/injected/hippo-wiz-tiny-icon.png'>";break;case 1:d="<div class='initial-box'>"+s.user_name+"</div>";break;case 2:d="<img class='thumb-pic' src='/images/injected/hippo-wiz-tiny-icon.png'>";break;case 3:d="<img class='thumb-pic' src='/images/injected/notification-views.svg'>";break;case 4:d="<img class='thumb-pic' src='/images/injected/notifications_export.svg'>";break;case 5:d="<img class='thumb-pic' src='/images/injected/notifications_reactions.svg'>";break;default:d="<img class='thumb-pic' src='/images/injected/hippo-wiz-tiny-icon.png'>"}var l="";l=0==s.viewed?"":"reed",t+=r.replace(/{{link}}/g,s.link).replace(/{{type}}/g,s.type).replace(/{{notification_id}}/g,s.notification_id).replace(/{{message}}/g,s.message).replace(/{{created_at}}/g,s.created_at).replace(/{{reed}}/g,l).replace(/{{avatar_update}}/g,d)}if($("#recentNotificationList").show(),e.length<1)a<1&&($(".notification-empty").show(),$(".notifications-list-item").empty(),$(".view-all-box").hide());else{var u=document.getElementById("recentNotificationList").innerHTML;document.getElementById("recentNotificationList").innerHTML=u+t}$(".notification-list-box").click(notificationRead)}function closeNotification(){handleGoToLibraryOption(!0),$(".recent-notifications-container").hide()}function saveDefaults(){chrome.storage.sync.set({recordingDefaults:recordConfiguration},function(){}),chrome.storage.sync.set({userPreferences:userPreferences},function(){})}function trackInMixpanel(e,i){local||(console.log("mixpanel event :: ",e),mixpanel.track(e,i))}function startDeviceTesting(e){if($("#test-recording-devices").hide(),trackInMixpanel("start device testing ext",{email:userEmail}),stopPreviewDevices(),testingScreen=!0,recordConfiguration.audio||recordConfiguration.webCam&&$("#webcam-preview-checkbox")[0].checked){var i=recordConfiguration.audio;recordConfiguration.audio&&$(".audio-source-list").val()&&(i={optional:[{sourceId:$(".audio-source-list").val()}]});var o=recordConfiguration.webCam;recordConfiguration.webCam&&$(".webcam-source-list").val()&&($(".webcam-img-selected").hide(),o={maxWidth:1280,maxHeight:720,frameRate:24,deviceId:$(".webcam-source-list").val()},"Default"!=$(".webcam-aspect-ratio").val()&&(o.aspectRatio=$(".webcam-aspect-ratio").val())),0==$("#webcam-preview-checkbox")[0].checked&&(o=!1);var r={audio:i,video:o};$(".allow-permission").hide(),webcamPermissionDenied=!1,console.log("constraints",r),chrome.runtime.sendMessage({getAspectRatioAndFrameRate:!0,messageFromContentScript1234:!0},function(e){o&&e.frameRate&&(o.frameRate=e.frameRate),navigator.mediaDevices.getUserMedia(r).then(function(e){if(testPreviewStream=e,recordConfiguration.webCam){var i=document.getElementById("webcam-test-preview");i.srcObject=e,i.play()}if(recordConfiguration.audio){var o=audioContext.createMediaStreamSource(e);meter=createAudioMeter(audioContext),checkFaultyMic(meter),o.connect(meter),drawingMeter=!0,drawMeter(),$("#audio-test-preview").show()}else $("#audio-test-preview").hide()}).catch(function(e){console.error("error opening recording devices",e),$(".allow-permission").show(),webcamPermissionDenied=!0})})}}function stopPreviewDevices(e){if(e||(e="BOTH"),testingScreen=!1,testPreviewStream){console.log(testPreviewStream.getTracks());for(var i in testPreviewStream.getTracks())"audio"!=testPreviewStream.getTracks()[i].kind||"BOTH"!=e&&"AUDIO"!=e||testPreviewStream.getTracks()[i].stop(),"video"!=testPreviewStream.getTracks()[i].kind||"BOTH"!=e&&"VIDEO"!=e||testPreviewStream.getTracks()[i].stop()}"BOTH"!=e&&"AUDIO"!=e||(drawingMeter=!1)}function webcamPreviewToggled(){$("#webcam-preview-checkbox")[0].checked?startDeviceTesting():stopPreviewDevices("VIDEO"),updateRecordingPreferences("webcamPreview",$("#webcam-preview-checkbox")[0].checked)}function webcamVisibleToggled(){updateRecordingPreferences("webcamVisible",$("#makeMyWebcamVisible")[0].checked)}function systemAudioToggled(){updateRecordingPreferences("systemAudio",$("#system-audio-checkbox")[0].checked)}function fullDesktopDefaultToggled(){updateRecordingPreferences("isDefaultFullDesktop",$("#fullDesktop-default-checkbox")[0].checked)}function mirroWebCamCheckBoxToggled(){var e=$("#mirrorWebCamCheckBox");if($(e).length>0){var i=$(e)[0].checked;updateRecordingPreferences("isMirrorWebCam",i),toggleWebcam(i)}}function toggleWebcam(e){var i=$("#webcam-test-preview");$(i).length>0&&("false"==e||0==e?$(i).addClass("mirror-video-class"):$(i).removeClass("mirror-video-class"))}function tabAudioToggled(){updateRecordingPreferences("tabAudio",$("#tab-audio-checkbox")[0].checked)}function highlightsOptionsToggled(){updateRecordingPreferences("highlights",$("#highlight-checkbox")[0].checked)}function drawMeter(e){if(drawingMeter){
var i=canvasWidth/2-65,o=canvasHeight,r=-meter.volume*canvasHeight*5;canvasContext.clearRect(0,0,canvasWidth,canvasHeight),canvasContext.fillStyle="rgba(0, 0, 0, 0.2)",canvasContext.strokeStyle="red",roundRect(canvasContext,i-10,o-canvasHeight,150,canvasHeight,50,"rgba(200,200,200,0.1)","rgba(0,0,0,0.2)",20),canvasContext.fillStyle="black",canvasContext.fillRect(i,o,130,-10),meter.checkClipping()&&(canvasContext.fillStyle="red");var t=map(Math.abs(r),0,200,50,255);canvasContext.fillStyle="rgb("+Math.floor(t)+","+Math.floor(205-t/2)+",50)",canvasContext.fillRect(i,o,130,r),window.requestAnimationFrame(drawMeter)}}function requestPermission(){var e=chrome.extension.getURL("html/injected/onboard.html");chrome.tabs.create({url:e})}function roundRect(e,i,o,r,t,n,a,c,s){var d=void 0===c||0!==c;n=void 0===n?5:n,e.save(),e.beginPath(),e.moveTo(i+n,o),e.lineTo(i+r-n,o),e.quadraticCurveTo(i+r,o,i+r,o+n),e.lineTo(i+r,o+t-n),e.quadraticCurveTo(i+r,o+t,i+r-n,o+t),e.lineTo(i+n,o+t),e.quadraticCurveTo(i,o+t,i,o+t-n),e.lineTo(i,o+n),e.quadraticCurveTo(i,o,i+n,o),e.closePath(),e.lineWidth=s,d&&0!==c&&(e.strokeStyle=void 0===c?"#000":c,e.stroke()),a&&(e.fillStyle=a,e.fill()),e.restore()}function map(e,i,o,r,t){return e>o?t:e<i?r:(e-i)*(t-r)/(o-i)+r}function isEmpty(e){return!e||0===e.length}function settingsChanged(e){trackInMixpanel($(this).attr("class")+" changed ext",{email:userEmail})}function setBadgeText(e,i){void 0===i?chrome.browserAction.setBadgeBackgroundColor({color:[255,0,0,255]}):chrome.browserAction.setBadgeBackgroundColor({color:i}),chrome.browserAction.setBadgeText({text:e+""})}function _setMoreOption(e){$(".user-mail-id").text(e.user_info.email);var i="",o="";topbarEnabled=e.feature_params.top_bar,console.log("response.feature_params ",e.feature_params),isMirrorVideoEnabled=e.feature_params.mirror_video,isMirrorVideoEnabled||($("#mirroWebCamDiv").remove(),userPreferences.isMirrorWebCam=!0,chrome.storage.sync.get(["userPreferences","recordingDefaults"],function(e){var i=e.userPreferences;void 0==i&&(i={}),i.isMirrorWebCam=!0,chrome.storage.sync.set({userPreferences:i},function(){}),toggleWebcam(!0),console.log("Setting userpreferences ",i)})),console.log("isMirrorVideoEnabled inside set more option ",isMirrorVideoEnabled),setting_tab=e.user_info.setting_tab,isStudent=e.is_student_login,null!==e.user_info.first_name&&(i=e.user_info.first_name),null!==e.user_info.last_name&&(o=e.user_info.last_name),""!==i||""!==o?($(".user-full-name").text(i+" "+o),$(".user-first-letter").text(""!==i?i[0]:o[0])):$(".user-first-letter").text(e.user_info.email[0]),userPreferences.isScreenRecordEnabled=e.is_screen_record_enabled,userPreferences.isScreenRecordEnabled||(updateRecordingPreferences("isScreenRecordEnabled",!1),updateRecordingOptions(!1,"screen")),e.user_params.enabled?$("#manageUsers").show():$("#manageUsers").hide(),isStudent&&($("#manageUsers").hide(),$("#integrationSettings").hide()),e.user_info.profile_pic?($("#userFirstLetter").hide(),$("#userProfilePic").show(),$("#userProfilePic").attr("src",e.user_info.profile_pic)):($("#userFirstLetter").show(),$("#userProfilePic").hide());var r=e.notification_count>0?e.notification_count:"";e.notification_count>0?e.notification_count:$(".notification_count").hide(),$(".notification_count").text(r),$(".notification_count").addClass("pop-anim"),setBadgeText(r,"#30a7ce"),chrome.storage.local.set({token_update:!1})}function manageUsers(){trackInMixpanel("manage users ext",{email:userEmail}),chrome.tabs.create({url:server+"/directory/users"})}function openPricingPage(){trackInMixpanel("get add-on from extenstion",{email:userEmail}),chrome.tabs.create({url:server+"/settings/subscription"})}function closeNotPossibleWarning(){$(".recording-not-possible").addClass("hide")}function openVideoTips(e){trackInMixpanel("video tips from extenstion",{email:userEmail}),"videoTipsWithImg"==e.currentTarget.id&&updateRecordingPreferences("showGitomerImg",!1),chrome.tabs.create({url:"https://www.hippovideo.io/video-making-tips"})}function editOrSendMailClicked(){trackInMixpanel(isSalesUser?"clicked send mail link from extension.":"clicked edit option link from extension.")}function integrationSettings(){trackInMixpanel("integration setting ext",{email:userEmail});var e=server+"/settings/integrations";chrome.tabs.create({url:e})}function seeAllVideos(){console.log("Is Student : ",isStudent),trackInMixpanel("see all videos ext",{email:userEmail});var e=server+"/video/record?tag=all_videos";!setting_tab&&isStudent||(e=server+"/video/library"),chrome.tabs.create({url:e})}function cancelRecording(e){var i={cancelBackgroundRecording:!0,messageFromContentScript1234:!0};e&&"screenPermissionWait"==e.type&&(i.cancelScreenRequest=!0),i.recordinguuid=$("#recordinguuid").val(),port.postMessage(i),window.close()}function copyShareUrl(e,i){return trackInMixpanel("Copied link from extension."),$("#copyLinkWithThumbnailTarget").remove(),$("body").append('<div id="copyLinkWithThumbnailTarget" aria-hidden="true" tabindex="-1" >'+getStyleHtmlToCopy(e,i)+"</div>"),document.querySelector("#copyLinkWithThumbnailTarget")}function getStyleHtmlToCopy(e,i){return'<a href="'+(e+=e.includes("?")?"&":"?")+'" target="_blank" tabindex="-1"><img src="'+i+'" alt="'+e+'" width="360" height="200"></a><div style="padding-top: 7px;"><a href="'+e+'" target="_blank" tabindex="-1" style="cursor: pointer;">Watch Video</a></div><div><br></div>'}function hvRecentOptionsLeave(){$(this).siblings(".hv-recent-options").show(),$(this).removeClass("hv-recent-hover")}function hvRecentOptionsHover(){$(this).siblings(".hv-recent-options").hide(),$(this).addClass("hv-recent-hover")}function showGoToLibrary(){$(this).scrollTop()>0&&$("#seeAllVideos").addClass("showGoToLibrary")}function showHideShareContent(){$(".copy-share-link").show()}function webcamPosition(e){trackInMixpanel("Webcam position change",{email:userEmail}),$(e.currentTarget).siblings().removeClass("hv-webcam-selected"),$(e.currentTarget).addClass("hv-webcam-selected"),updateRecordingPreferences("webcamPosition",$(e.currentTarget).attr("data-webcamposition"))}function webcamSize(e){trackInMixpanel("Webcam size change",{email:userEmail}),updateRecordingPreferences("webcamSize",e.currentTarget.value)}function webcamShape(e){const i=$(e.currentTarget).attr("data-webcamshape");trackInMixpanel("Webcam shape change from extension - "+i,{email:userEmail}),$(e.currentTarget).siblings().removeClass("hv-webcam-selected"),$(e.currentTarget).addClass("hv-webcam-selected"),toggleWebcamShape(i),showWebcamShapeInfo(i),updateRecordingPreferences("webcamShape",i)}function showWebcamShapeInfo(e){$(".audio-wrap-box").addClass("withStickyFooter"),$("#hv-webcam-shape-info-container").addClass("stickyFooter"),$(".webcam_shape_info").addClass("hide"),$("#webcam_shape_info_icon, #webcam_info_"+e).removeClass("hide")}function hideWebcamShapeInfo(){$(".audio-wrap-box").removeClass("withStickyFooter"),$("#hv-webcam-shape-info-container").removeClass("stickyFooter"),$("#webcam_shape_info_icon, .webcam_shape_info").addClass("hide")}function toggleWebcamShape(e){updateRecordingPreferences("webcamShape",e,function(){if("circle"==e){disableAspectRatio();var i=document.getElementById("makeMyWebcamVisible");null!=i&&(i.checked=!0),disableMakeMyWebcamVisible(),enableLowerThirdCheckBox()}else enableAspectRatio(),enableMakeMyWebcamVisible(),disableLowerThirdCheckBox()})}function lowerThirdToggled(){$("#lower-Third-checkbox")[0].checked?$("#circleWebcamPreviewWithLowerthird").show():$("#circleWebcamPreviewWithLowerthird").hide(),updateRecordingPreferences("lowerThird",$("#lower-Third-checkbox")[0].checked)}function getCurrentWebcamShape(){return $(".hv-webcam-shape li.hv-webcam-selected").attr("data-webcamshape")}function disableAspectRatio(){$(".webcam-aspect-ratio").val("1.33333333").prop("disabled",!0)}function enableAspectRatio(){$(".webcam-aspect-ratio").val(userPreferences.aspectRatio).prop("disabled",!1)}function disableMakeMyWebcamVisible(){$("#hv-makeMyWebcamVisibleCover").show()}function enableMakeMyWebcamVisible(){$("#hv-makeMyWebcamVisibleCover").hide()}function disableLowerThirdCheckBox(){$("#hv-lowerthird-invisiblity").show()}function enableLowerThirdCheckBox(){$("#hv-lowerthird-invisiblity").hide()}function webcamAspectRatioChanged(e){trackInMixpanel("aspect ratio change",{email:userEmail}),updateRecordingPreferences("aspectRatio",e.currentTarget.value)}function changeResolution(e){trackInMixpanel("Resolution change",{email:userEmail}),updateRecordingPreferences("resolution",e.currentTarget.value)}function changeWebcamSource(e){trackInMixpanel("Webcam source change",{email:userEmail}),updateRecordingPreferences("webcamSource",e.currentTarget.value)}function changeAudioSource(e){trackInMixpanel("Audio source change",{email:userEmail}),updateRecordingPreferences("audioSource",e.currentTarget.value)}function openUpgradePage(){trackInMixpanel("upgrade page from ext",{email:userEmail});var e=server+"/video/pricing";chrome.tabs.create({url:e})}function openReferralPage(){trackInMixpanel("referral page from ext",{email:userEmail});var e=server+"/video/referral";setting_tab&&(e=server+"/settings/referral"),chrome.tabs.create({url:e})}function getCurrentTabURL(e){getCurrentTabDetails(function(i){e(i.url)})}function getCurrentTabDetails(e){chrome.tabs.query({active:!0,currentWindow:!0},function(i){e(i[0])})}function preCheckAndInitiateRecording(){getCurrentTabURL(function(e){e.startsWith("chrome://")?$(".recording-not-possible").removeClass("hide"):initRecording()})}!function(e,i){if(!i.__SV){var o=window;try{var r,t,n,a=o.location,c=a.hash;r=function(e,i){return(t=e.match(RegExp(i+"=([^&]*)")))?t[1]:null},c&&r(c,"state")&&(n=JSON.parse(decodeURIComponent(r(c,"state"))),"mpeditor"===n.action&&(o.sessionStorage.setItem("_mpcehash",c),history.replaceState(n.desiredHash||"",e.title,a.pathname+a.search)))}catch(e){}var s,d;window.mixpanel=i,i._i=[],i.init=function(e,o,r){var t=i;for(void 0!==r?t=i[r]=[]:r="mixpanel",t.people=t.people||[],t.toString=function(e){var i="mixpanel";return"mixpanel"!==r&&(i+="."+r),e||(i+=" (stub)"),i},t.people.toString=function(){return t.toString(1)+".people (stub)"},s="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" "),d=0;d<s.length;d++)!function(e,i){var o=i.split(".");2==o.length&&(e=e[o[0]],i=o[1]),e[i]=function(){e.push([i].concat(Array.prototype.slice.call(arguments,0)))}}(t,s[d]);i._i.push([e,o,r])},i.__SV=1.2,o=e.createElement("script"),o.type="text/javascript",o.async=!0,o.src="undefined"!=typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"/js/bg/mixpanel-2-latest.min.js",r=e.getElementsByTagName("script")[0],r.parentNode.insertBefore(o,r)}}(document,window.mixpanel||[]),mixpanel.init("942fd8197d29b30092ef56683ab6cead",{api_host:"https://api.mixpanel.com"});var local="cijidiollmnkegoghpfobabpecdkeiah"!==chrome.runtime.id,server=local?"http://localhost:3000":"https://www.hippovideo.io",isLessonlyExtension=-1!=chrome.runtime.getManifest().name.toLowerCase().indexOf("lessonly"),port,recordConfiguration,audioDeviceAvailable=!0,videoDeviceAvailable=!0,authToken,userEmail,digest,allUrlsPermission=!0,canvasContext=null,audioContext=null,meter=null,drawingMeter,canvasWidth,canvasHeight,webcamPermissionDenied=!1,setting_tab=!1,topbarEnabled=!1,isMirrorVideoEnabled=!1,userPreferences={showAdvanced:!0,webcamVisible:!0,webcamPreview:!0,lowerThird:!1,systemAudio:!0,tabAudio:!0,highlights:!0,highlightState:"hvOpenHighlight",resolution:720,webcamPosition:"bottom-left",webcamSize:"medium",webcamShape:"rectangle",webcamSource:"default",aspectRatio:"1.77777778",videoBitRate:4e3,fullDesktop:!0,isDefaultFullDesktop:!1,webcamBitRate:4e3,showGitomerImg:!0,isMirrorWebCam:!0,isScreenRecordEnabled:!0},isGuestUser=!1,isSalesUser=!1,isFreeUser=!1,isRecordLimitExceed=!1,webcamPermissionDenied=!1,isStudent=!1,hasUploadIssue=!1,canShowCircleWebcam=!1,copyToClipboard=void 0,os,userFirstName="",userLastName="",userNameDisplay="",userDesignation="";$(document).ready(function(){chrome.runtime.getPlatformInfo(function(e){os=e.os,port=chrome.extension.connect({name:"mycontentscript"}),recordConfiguration={screenRecord:!0,webCam:!0,audio:!0,separateLayer:!1,pseudoWebcam:!1},chrome.storage.sync.get(["userPreferences","recordingDefaults"],function(e){var i=e.userPreferences;void 0!=i&&(void 0!=i.showAdvanced&&(userPreferences.showAdvanced=i.showAdvanced),void 0!=i.webcamVisible&&(userPreferences.webcamVisible=i.webcamVisible),void 0!=i.webcamPreview&&(userPreferences.webcamPreview=i.webcamPreview),void 0!=i.systemAudio&&(userPreferences.systemAudio=i.systemAudio),void 0!=i.tabAudio&&(userPreferences.tabAudio=i.tabAudio),void 0!=i.highlights&&(userPreferences.highlights=i.highlights),void 0!=i.highlightState&&(userPreferences.highlightState=i.highlightState),void 0!=i.webcamPosition&&(userPreferences.webcamPosition=i.webcamPosition),void 0==i.webcamSize&&void 0==i.webCamSize||(userPreferences.webcamSize=i.webcamSize||i.webCamSize),void 0!=i.webcamShape&&(userPreferences.webcamShape=i.webcamShape),void 0!=i.aspectRatio&&(userPreferences.aspectRatio=i.aspectRatio),void 0!=i.resolution&&(userPreferences.resolution=i.resolution),void 0!=i.webcamSource&&(userPreferences.webcamSource=i.webcamSource),void 0!=i.audioSource&&(userPreferences.audioSource=i.audioSource),void 0!=i.isDefaultFullDesktop&&(userPreferences.isDefaultFullDesktop=i.isDefaultFullDesktop),void 0!=i.fullDesktop&&(userPreferences.fullDesktop=i.fullDesktop),i.isDefaultFullDesktop&&(userPreferences.fullDesktop=!0),void 0!=i.showGitomerImg&&(userPreferences.showGitomerImg=i.showGitomerImg),void 0!=i.isMirrorWebCam?userPreferences.isMirrorWebCam=i.isMirrorWebCam:userPreferences.isMirrorWebCam=!0,void 0!=i.isScreenRecordEnabled&&(userPreferences.isScreenRecordEnabled=i.isScreenRecordEnabled),void 0!=i.lowerThird&&(userPreferences.lowerThird=i.lowerThird));var o=e.recordingDefaults;void 0!=o&&(recordConfiguration.screenRecord=o.screenRecord,recordConfiguration.webCam=o.webCam,recordConfiguration.audio=o.audio,recordConfiguration.defaultTab=o.defaultTab),setRecordingOptions(recordConfiguration)}),$(".option-btn").bind("click",recordingOption),$("#record-btn").bind("click",startRecording),$("#recordScreen").bind("change",tabChanged),$("#createNewVideo").click(showRecordingTab),$("#library-tab").click(showLibraryTab),$("#makeMyWebcamVisible").change(webcamVisibleToggled),$("#webcam-preview-checkbox").change(webcamPreviewToggled),$("#system-audio-checkbox").change(systemAudioToggled),$("#fullDesktop-default-checkbox").change(fullDesktopDefaultToggled),$("#mirrorWebCamCheckBox").length>0&&$("#mirrorWebCamCheckBox").change(mirroWebCamCheckBoxToggled),$("#tab-audio-checkbox").change(tabAudioToggled),$("#lower-Third-checkbox").change(lowerThirdToggled),$("#signout").bind("click",signout),$("#highlight-checkbox").change(highlightsOptionsToggled),$("#manageUsers").click(manageUsers),$("#integrationSettings").click(integrationSettings),$("#nav-icon").click(handleHamburgerMenu),$(".advanced-settings").click(openAdvancedSettings),$(".advanced-settings-back").click(closeAdvancedSettings),$(".more-option").click(openProfileSettings),$(".profile-close").click(closeProfileSettings),$("#seeAllVideos").click(seeAllVideos),$(".hv-webcam-position li").click(webcamPosition),$(".webcam-aspect-ratio").change(webcamAspectRatioChanged),$(".webcam-size").change(webcamSize),$(".hv-webcam-shape li").click(webcamShape),$(".notification-bell").click(fetchNotifications),$(".notification-close").click(closeNotification),$(".vdo-resolution-list").change(changeResolution),$(".webcam-source-list").change(changeWebcamSource),$(".audio-source-list").change(changeAudioSource),$(".upgrade-link").click(openUpgradePage),$(".referral-link").click(openReferralPage),$(".get-add-on").click(openPricingPage),$(".recording-not-possible .okay-btn").click(closeNotPossibleWarning),$(".video-tips").click(openVideoTips),$(".hv-recent-sendmail").click(editOrSendMailClicked),$("#wiz-no-thanks").click(function(){window.close()}),$(".webcam-source-list, .audio-source-list, .webcam-aspect-ratio").bind("change",function(){startDeviceTesting()}),$(".allow-permission").click(requestPermission),$("#loginPage").hide(),$("#tabsDiv").hide(),$(".webcam-source-list, .audio-source-list, .vdo-resolution-list").change(settingsChanged),checkIfUserSignedIn(),checkForUpdates(),canvasContext=$("#audio-test-preview")[0].getContext("2d"),canvasHeight=$("#audio-test-preview")[0].height,canvasWidth=$("#audio-test-preview")[0].width,window.AudioContext=window.AudioContext||window.webkitAudioContext,audioContext=new AudioContext,isLessonlyExtension&&$("#stop-recording-tab-content #audioCapture").find("span").text(chrome.i18n.getMessage("audio_text"))})});var testingScreen=!1,testPreviewStream;