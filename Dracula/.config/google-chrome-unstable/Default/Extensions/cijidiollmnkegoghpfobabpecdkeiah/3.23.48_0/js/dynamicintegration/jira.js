var injectedAlready=document.getElementById("hippowiz-jira-dynamic-injected"),HTML_CONTENT={hippo_button:"<div class='hv-embed-main-container'> <button id='hippo_video_button' data-ref='hv-embed-main-container' data-type='record_and_library' class='toolbar-action-component toggle text-editor-extension hint--top hv-embed-main-icon' data-hint='Hippo Video' type='button'><img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'  height='24px' width='22px' > </button><span class='tooltiptext'>Hippo Video</span></div>"};if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-jira-dynamic-injected" value=true />';$(hippoCsInjected).appendTo("body"),console.log("injected JIRA  dynamic script"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:l.serviceName,windowId:l.windowId,tabId:l.tabId}}function n(e,t){var n=e.track_id,o=e.content.assetContent,i=o.videoShareUrl,r=o.thumbnailShareUrl,d=o.html,s=o.videoTitle;if(1==e.status)i+=i.includes("?")?"&track_id="+n:"?track_id="+n,r+=r.includes("?")?"&track_id="+n:"?track_id="+n;else{var c=o.mfInVideo,m=o.mfFormValues;if(c.length>0){for(var p="",l=0;l<c.length;l++)p=p+encodeURIComponent(c[l])+"="+encodeURIComponent(m[c[l]])+"&";""!=p&&(i+=i.includes("?")?"&"+p:"?"+p,r+=r.includes("?")?"&"+p:"?"+p)}}d=a(d,o.thumbnailShareUrl,i,r,s);var u=$(".hv-embed-main-icon[data-random-id="+t+"]");if($(".ak-editor-content-area").length>0){var h=$(u).parents()[5];$(h).find($('[aria-label="Main content area"]')).append(d)}$("#hvJiraPop").remove()}function a(e,t,n,a,i){for(var r=$(e).find("a"),d=0;d<r.length;d++){var s=r[d],c=s.outerHTML.replace(/&amp;/g,"&");if(c.includes(t)){var m=o(n,a);e=e.includes(s.outerHTML)?e.replace(s.outerHTML,m):e.includes(c)?e.replace(c,m):e.replace(s.outerHTML,m)}}return e}function o(e,t){return'<a href="'+e+'" target="_blank" tabindex="-1"><img src="'+t+'" alt="'+e+'" style="cursor: pointer;" width="360" height="200"></a><div style="padding-top: 7px;"><a href="'+e+'" target="_blank" tabindex="-1" style="cursor: pointer;">Watch Video</a></div><div><br></div>'}function i(){$(".hv-embed-main-container").remove(),$(".jAfoQQ:last").length>0&&$(".jAfoQQ:last").prepend($(HTML_CONTENT.hippo_button)),$(".hv-embed-main-icon").on("click",s)}function r(e){var n=m(),a=n.firstName,o=t();o.messageFromContentScript1234=!0,o.initWorkflowPop=!0,o.msgType="workflow",o.payload={logPrefix:l.logPrefix,popType:"sales",popId:"hvJiraPop",assetContent:{uniqueId:e,mfFormValues:{"First Name":a}},popConfig:{showEditOption:!0,showTemplatesOption:!1,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:!0,fetchMfInVideo:!0,mandatoryEmailMf:!1,showCustomizeComponent:!0,showTelePrompter:!0,defaultMergeFields:["First Name"],askDefaultMergeFields:!0,showLandingPageComponent:!0}},l.port.postMessage(o)}function d(e){var n=e.workflowConfig,a=t();a.messageFromContentScript1234=!0,a.messageType="jira_dynamic",a.getUTMToken=!0,a.popId=n.popId,a.content=n,a.serviceName=l.serviceName,l.port.postMessage(a)}function s(e){$("#hvJiraPop").remove();var t=c(20);$(e.currentTarget).attr("data-random-id",t),r(t)}function c(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=n.length,o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*a));return t}function m(){var e=p(),t=$(".hyncac span.css-ob4lje").css("background-image");return{firstName:t===e.reporter.url?e.assignee.name:t===e.assignee.url?e.reporter.name:e.assignee.name}}function p(){for(var e,t,n,a,o=$(".gbXyYv"),i=0;i<o.length;i++)if("Assignee"==o[i].childNodes[0].childNodes[0].innerText)e=o[i].childNodes[1].innerText,n=$(o[i].childNodes[1]).find("span.css-ob4lje").css("background-image");else if("Reporter"==o[i].childNodes[0].childNodes[0].innerText){t=o[i].childNodes[1].innerText,a=$(o[i].childNodes[1]).find("span.css-ob4lje").css("background-image");break}return{assignee:{name:e,url:n},reporter:{name:t,url:a}}}var l=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix=" JIRA_DYNAMIC :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,l.port.postMessage(e)}(),l.port.onMessage.addListener(function(e,t,a){if(msgFromPort=e.backgroundRecordingMessage,"insertFromWorkflowPop"==msgFromPort&&e.data.serviceName==l.serviceName&&e.data.tabId==l.tabId&&d(e.data),"insertVideoInJiraCommentBox"==msgFromPort&&e.data.tabId==l.tabId){var o=e.data.content.assetContent.uniqueId;n(e.data,o)}}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){for(var n in e){var a=e[n];if($(a.target).hasClass("dHydut")){var o=$(".iNgaKz").find(".hv-embed-main-container");0==$(o).length&&i()}}}).observe(document,{subtree:!0,childlist:!0,attributes:!0})})}