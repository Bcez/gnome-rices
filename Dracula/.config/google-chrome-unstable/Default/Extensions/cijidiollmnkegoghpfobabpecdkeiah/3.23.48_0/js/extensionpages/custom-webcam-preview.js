function getLightingFeedback(){var e=$("#webcamPreview")[0];$("#hvBrightnessCanvas").removeClass("hide");var a=document.getElementById("hvBrightnessCanvas"),i=a.getContext("2d");setTimeout(function(){a.width=e.videoWidth/15,a.height=e.videoHeight/15,updateBrightnessFrame(e,a,i)},1200)}function updateBrightnessFrame(e,a,i){var c=getFrameBrightness(e,a,i);lightingFeedbackTimeout=setTimeout(function(){window.requestAnimationFrame(function(){updateBrightnessFrame(e,a,i)})},2e3),chrome.runtime.sendMessage({lightingFeedback:!0,messageFromContentScript1234:!0,data:c})}function getFrameBrightness(e,a,i){i.drawImage(e,0,0,e.videoWidth,e.videoHeight,0,0,a.width,a.height);for(var c=i.getImageData(0,0,a.width,a.height),r=0,o=0;o<c.data.length;o+=4)r+=.21*c.data[o]+.72*c.data[o+1]+.07*c.data[o+2];return r/=c.data.length}function sendWebcamQualityFeedback(e){e.getVideoTracks().forEach(function(e){var a=e.getSettings();webcamQuality=webcamQualityFeedback(a),chrome.runtime.sendMessage({webcamQuality:!0,messageFromContentScript1234:!0,data:webcamQuality})})}function webcamQualityFeedback(e){var a=e.width,i=e.height,c=a+" x "+i,r="Low";return a>=1920?r="High":a>=1024&&(r="Good"),webcamQuality.frameRate=e.frameRate,webcamQuality.maxRes=c,webcamQuality.quality=r,webcamQuality}function toggleWebcam(e){var a=$("video#webcamPreview");$(a).length>0&&("false"==e||0==e?$(a).addClass("mirror-video-class"):$(a).removeClass("mirror-video-class"))}function getQueryParamsValue(e){var a=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),c=i.exec(a);if(c)return c[2]?decodeURIComponent(c[2].replace(/\+/g," ")):""}function showCountdown(){var e=3;$("#hippo-overlay-time").show();var a=setInterval(function(){$("#countdown").html(e--),e<0&&(clearInterval(a),$("#hippo-overlay-time").hide())},1e3)}function showAudioAnimation(e){window.AudioContext=window.AudioContext||window.webkitAudioContext;var a=new AudioContext,i=a.createMediaStreamSource(e);meter=createAudioMeter(a),i.connect(meter),canvasContext=$("#previewAudioMeter")[0].getContext("2d"),canvasHeight=$("#previewAudioMeter")[0].height,canvasWidth=$("#previewAudioMeter")[0].width,meterWidth=130,meterX=canvasWidth/2-meterWidth/2,meterY=canvasHeight,drawMeter()}function drawMeter(){var e=$("#previewAudioMeter")[0];drawAnimationMeter(meter.volume,e);try{window.parent.postMessage({volume:meter.volume,type:"audioMeter"},"*")}catch(e){}window.requestAnimationFrame(drawMeter)}function drawAnimationMeter(e,a){var i=e*canvasHeight*5,c=map(2*i,0,200,50,255);canvasContext.clearRect(0,0,canvasWidth,canvasHeight),canvasContext.fillStyle="#000",canvasContext.fillRect(0,canvasHeight,canvasWidth,-3),canvasContext.fillStyle="rgb("+Math.floor(c)+", "+Math.floor(205-c/2)+", 50)",canvasContext.fillRect(0,canvasHeight,canvasWidth,-i)}function map(e,a,i,c,r){return e>i?r:e<a?c:(e-a)*(r-c)/(i-a)+c}function requestPermission(){var e=chrome.extension.getURL("html/injected/onboard.html");chrome.tabs.create({url:e})}function toggleWebcamPreviewIcons(e){$("#webcamPreview, #webcamIcons_container").unbind("mouseover").bind("mouseover",function(){$("#webcamIcons_container").show()}),$("#webcamPreview, #webcamIcons_container").unbind("mouseleave").bind("mouseleave",function(){$("#webcamIcons_container").hide()}),$("#webcamIcons_container div").mouseenter(function(){$(this).addClass("hv-icon-hover")}).mouseleave(function(){$(this).removeClass("hv-icon-hover")}),$("#webcamIcons_container").addClass(e),regWebcamPreviewIconsEvents(),getRecordingInfo()}function regWebcamPreviewIconsEvents(){$(".hv-webcampause, .hv-webcamplay").unbind("click").bind("click",function(){togglePlayPause()}),$(".hv-stoprecording").unbind("click").bind("click",function(){stopRecording()})}function stopRecording(){chrome.runtime.sendMessage({stopBackgroundRecording:!0,messageFromContentScript1234:!0})}function togglePlayPause(){chrome.runtime.sendMessage({togglePauseResume:!0,messageFromContentScript1234:!0},function(e){e&&updatePausePlayIcons(e.status)})}function getRecordingInfo(){chrome.runtime.sendMessage({getRecordingInfo:!0,messageFromContentScript1234:!0},function(e){if(e){var a=e.recordingConfiguration||{};if(a.highlights||a.showWebcamTour&&1==a.showWebcamTour)hideWebcamIcons();else if(!a.highlights)if(updatePausePlayIcons(e.isPaused?"paused":"resumed"),void 0==a.isWebcamPreviewMaximized||1==a.isWebcamPreviewMaximized)$("#webcamIcons_container").addClass("hv-webcam-circle-center-align"),"small"==a.webcamSize&&"circle"==a.webcamShape&&($("#webcamPreview").addClass("webcamCircle_objPosition_small"),$(".webcamPreview-wrapper").addClass("hv-videocircle-small"));else if($("#webcamIcons_container").removeClass("hv-webcam-circle-center-align"),"small"==a.webcamSize&&"circle"==a.webcamShape){$("#webcamPreview").removeClass("webcamCircle_objPosition_small");var i=getQueryParamsValue("camResizeValue");"minimize"==i&&$("#webcamPreview").addClass("webcamCircle_objPosition_small"),$(".webcamPreview-wrapper").removeClass("hv-videocircle-small")}}})}function updatePausePlayIcons(e){"paused"==e?($(".hv-webcampause").addClass("disp-none"),$(".hv-webcamplay").removeClass("disp-none")):"resumed"==e&&($(".hv-webcamplay").addClass("disp-none"),$(".hv-webcampause").removeClass("disp-none"))}function hideWebcamIcons(){$("#webcamPreview, #webcamIcons_container").unbind("mouseover"),$("#webcamIcons_container").hide()}function regWebcamDoubleClickEvent(){$("#webcamPreview").unbind("dblclick").bind("dblclick",function(){chrome.runtime.sendMessage({webcamPreviewDoubleClicked:!0,messageFromContentScript1234:!0}),$("#webcamIcons_container").addClass("hv-webcam-circle-center-align"),"small"==webcamSize&&"circle"==webcamShape&&($("#webcamPreview").removeClass("webcamCircle_objPosition_small"),$(".webcamPreview-wrapper").addClass("hv-videocircle-small")),$("#circleWebcamPreviewWithLowerthird").addClass("hvLowerThird-CircleWebcam-Style")})}var localStream,port=chrome.runtime.connect({name:"mycontentscript"}),canvasContext,canvasHeight,canvasWidth,meterWidth,meterX,meterY,webcamShape,webcamSize,webcamQuality={frameRate:24,maxRes:"640 x 480",quality:"Good"};$(document).ready(function(){var e=!0,a={width:{ideal:1280,max:1280},height:{ideal:720,max:720},frameRate:20,aspectRatio:1.77},i=getQueryParamsValue("audioMeter"),c=getQueryParamsValue("changeWebcamSize");webcamShape=getQueryParamsValue("webcamShape");var r=getQueryParamsValue("aspectRatio"),o=getQueryParamsValue("webcamWidthPercentage"),t=getQueryParamsValue("webcamAspectRatio"),s=getQueryParamsValue("webcamDeviceId"),n=getQueryParamsValue("audioDeviceId"),m=getQueryParamsValue("isMirrorWebCam"),l=getQueryParamsValue("camResizeValue"),d=getQueryParamsValue("isLowerThirdEnabled"),w=getQueryParamsValue("isNewRecordingScreen");7e3==getQueryParamsValue("webcamBitRate")&&(a.width={ideal:1920,max:1920},a.height={ideal:1080,max:1080}),void 0!=m&&(m=JSON.parse(m)),w&&($(".hv-custom-webcam-container").addClass("hvrecorder-newscreen"),$(".audio-meter-container").remove(),$(".hvrecorder-mic-container").removeClass("hvrecorder-hide")),$(".ask-webcam-permission-container, .hvrecorder-permission-request").click(requestPermission),chrome.storage.local.get("userNameDisplay",function(e){$(".circleLowerThird-UserNameValue").text(e.userNameDisplay)});chrome.storage.local.get("userDesignation",function(e){$(".circleLowerThird-UserDesignationValue").text(e.userDesignation)}),void 0!=o&&($(".hv-custom-webcam-container:not(.hv-custom-webcam-container_circle) #webcamPreview").css("width","100%"),$(".hv-custom-webcam-container:not(.hv-custom-webcam-container_circle)").css("paddingBottom","5px"),$(".hv-custom-webcam-container:not(.hv-custom-webcam-container_circle) .main-block").css("display","block"),$(".hv-custom-webcam-container:not(.hv-custom-webcam-container_circle) .webcamPreview-wrapper").css("width",o+"%"),$(".hv-custom-webcam-container:not(.hv-custom-webcam-container_circle) .webcamPreview-wrapper").css("border","1px solid #ddd")),void 0!=s&&(a.deviceId=s),void 0!=n&&(e={optional:[{sourceId:n}]}),void 0!=t&&(a.aspectRatio=t),"false"==i&&($(".audio-meter-container").hide(),"circle"!=webcamShape&&$(".hv-custom-webcam-container .webcam-video").addClass("hv-full-width")),void 0!=d&&"undefined"!=d&&0!=d&&"false"!=d&&null!=d&&d||$(".webcamPreview-wrapper").addClass("hv-lowerthird-hidden"),chrome.runtime.sendMessage({getAspectRatioAndFrameRate:!0,messageFromContentScript1234:!0},function(i){if(void 0==m&&void 0!=i.isMirrorWebCam&&(m=i.isMirrorWebCam),a.aspectRatio=i.aspectRatio,!a.deviceId&&i.webcamSource&&(a.deviceId=i.webcamSource),!0===e&&i.audioSource&&(e={optional:[{sourceId:i.audioSource}]}),"true"==c){var o=getQueryParamsValue("sizePositionAspectRatio").split("_");webcamSize=o[0],"medium"==webcamSize&&"circle"!=webcamShape&&$(".hv-custom-webcam-container .webcam-video").addClass("hv-medium-width"),"small"==webcamSize&&"circle"!=webcamShape&&$(".hv-custom-webcam-container .webcam-video").addClass("hv-small-width"),"small"==webcamSize&&"circle"==webcamShape&&$("#circleWebcamPreviewWithLowerthird").addClass("circleLowerThirdSmallContainer"),"minimize"==l&&"small"==webcamSize&&"circle"==webcamShape?$("#webcamPreview").addClass("webcamCircle_objPosition_small"):"maximize"==l&&"small"==webcamSize&&"circle"==webcamShape&&($("#webcamPreview").removeClass("webcamCircle_objPosition_small"),$(".webcamPreview-wrapper").addClass("hv-videocircle-small")),"circle"==webcamShape?(toggleWebcamPreviewIcons(webcamSize),regWebcamDoubleClickEvent(),$(".hv-custom-webcam-container").addClass("hv-custom-webcam-container_circle"),$("#circleWebcamPreviewWithLowerthird").removeClass("circleWebcamPreview-Lowerthird-showHide"),"small"==o[0]?$(".hv-custom-webcam-container .webcam-video").addClass("hv-full-height hv-full-width"):$(".hv-custom-webcam-container .webcam-video").addClass("hv-full-height hv-full-width webcamCircle_objPosition_"+o[0])):($(".hv-custom-webcam-container .webcam-video").addClass("hv-auto-height"),$("#circleWebcamPreviewWithLowerthird").addClass("circleWebcamPreview-Lowerthird-showHide"));var t=o[1].split("-")[0],s=o[1].split("-")[1];"top"==t?$(".hv-custom-webcam-container .main-block").addClass("hv-top-align"):"bottom"==t&&$(".hv-custom-webcam-container .main-block").addClass("hv-bottom-align"),"right"==s?$(".hv-custom-webcam-container .main-block").addClass("hv-right-align"):"left"==s?$(".hv-custom-webcam-container .main-block").addClass("hv-left-align"):$(".hv-custom-webcam-container .main-block").addClass("hv-center-align"),"Default"==o[2]?a.aspectRatio=void 0:a.aspectRatio=o[2]}else $(".hv-custom-webcam-container .main-block").addClass("hv-center-align");r&&(a.aspectRatio="Default"==r?void 0:r),"minimize"==l?("small"==o[0]?($("#webcamPreview").addClass("webcamCircle_objPosition_small"),$("#circleWebcamPreviewWithLowerthird").removeClass("hvLowerThird-CircleWebcam-Style")):$("#circleWebcamPreviewWithLowerthird").removeClass("hvLowerThird-CircleWebcam-Style"),"small"==webcamSize&&"circle"==webcamShape&&$("#webcamPreview").addClass("webcamCircle_objPosition_small")):"maximize"==l&&("small"==o[0]?($("#webcamPreview").removeClass("webcamCircle_objPosition_small"),$("#circleWebcamPreviewWithLowerthird").addClass("hvLowerThird-CircleWebcam-Style")):$("#circleWebcamPreviewWithLowerthird").addClass("hvLowerThird-CircleWebcam-Style"),"small"==webcamSize&&"circle"==webcamShape&&$("#webcamPreview").removeClass("webcamCircle_objPosition_small")),a.frameRate=i.frameRate,navigator.mediaDevices.getUserMedia({audio:e,video:a}).then(function(e){$(".webcam-video").removeClass("hide"),$(".ask-webcam-permission-container").addClass("hv-text-link"),localStream=e,$("video#webcamPreview")[0].srcObject=e,$("video#webcamPreview")[0].play(),w&&(sendWebcamQualityFeedback(e),getLightingFeedback()),showAudioAnimation(e),toggleWebcam(m),window.parent.postMessage("stream_available","*")}).catch(function(e){$(".webcam-video").addClass("hide"),$(".ask-webcam-permission-container").removeClass("hv-text-link"),e?(console.error("Webcam error in customWebcamPreview",{name:e.name,message:e.message}),"NotReadableError"==e.name?$(".ask-webcam-permission-container span").text("Check if webcam is configured correctly"):e.message.includes("Failed due to shutdown")?$(".ask-webcam-permission-container span").text("Could not access webcam/mic"):$(".ask-webcam-permission-container span").text("Allow Webcam & Audio Permission")):console.error("Webcam error in customWebcamPreview null"),w?($(".hvrecorder-permission-container").removeClass("disp-none"),chrome.runtime.sendMessage({askWebcamPermission:!0,messageFromContentScript1234:!0,data:"new_recording_screen"})):$(".ask-webcam-permission-container").show()})})}),port.onMessage.addListener(function(e,a,i){"highlightState"==e.backgroundRecordingMessage&&("hvPlay"!==e.data.current_action&&"hvPause"!==e.data.current_action||updatePausePlayIcons("hvPlay"==e.data.pause_play?"resumed":"paused")),"MarkupToolEnabled"==e.backgroundRecordingMessage&&e.data.markupToolEnabled&&"circle"==webcamShape&&hideWebcamIcons(),"stopWebcamTour"==e.backgroundRecordingMessage&&toggleWebcamPreviewIcons(webcamSize),"webcamPreviewMinimized"==e.backgroundRecordingMessage&&($("#webcamIcons_container").removeClass("hv-webcam-circle-center-align"),$("#circleWebcamPreviewWithLowerthird").removeClass("hvLowerThird-CircleWebcam-Style"),$("#webcamIcons_container").removeClass("webcam-small-resize"),$(".webcamPreview-wrapper").removeClass("hv-videocircle-small")),"webcamPreviewMinimized"==e.backgroundRecordingMessage&&"small"==webcamSize&&"circle"==webcamShape?($("#webcamPreview").addClass("webcamCircle_objPosition_small"),$("#circleWebcamPreviewWithLowerthird").removeClass("hvLowerThird-CircleWebcam-Style")):"webcamPreviewDoubleClicked"==e.backgroundRecordingMessage&&"small"==webcamSize&&"circle"==webcamShape&&($("#webcamPreview").removeClass("webcamCircle_objPosition_small"),$(".webcamPreview-wrapper").addClass("hv-videocircle-small"),$("#circleWebcamPreviewWithLowerthird").addClass("hvLowerThird-CircleWebcam-Style"))}),showCountdown();