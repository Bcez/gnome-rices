var injectedAlready=document.getElementById("hippowiz-saleshandy-dynamic-injected"),HTML_CONTENT={hippo_button_in_email_sequence:'<button  aria-label="Hippo Video" title="Hippo Video" type="button" tabindex="-1" class="tox-tbtn hv-embed-main-container" aria-disabled="false"><img class="hippo-icon" src="https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg" height="19px"></button>',hippo_button:'<div class="mce-container mce-flow-layout-item mce-btn-group hv-embed-main-container" hv-saleshandy-tooltip="Hippo Video" role="group"><div><div class="mce-widget mce-btn mce-first mce-last" tabindex="-1" role="button" aria-label="Insert Template"><button role="presentation" type="button" tabindex="-1"><img class="hippo-icon" src="https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg" height="19px"></button><span class="hv-saleshandy-tooltiptext">Hippo Video</span></div></div></div>',hippo_template_button:'<div class="mce-container mce-flow-layout-item mce-btn-group hv-embed-main-container" hv-saleshandy-tooltip="Hippo Video" role="group"><div><div class="mce-widget mce-btn mce-first mce-last" tabindex="-1" role="button" aria-label="Insert Template"><button role="presentation" type="button" tabindex="-1"><img class="hippo-icon" src="https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg" height="19px"></button><span class="hv-template-tooltiptext">Hippo Video</span></div></div></div>',report_button:'<i _ngcontent-c12="" class="pointer fnt15 noMar iconRound ActionhoverIcon hv-integration-reports-button" mdtooltip="Video Reports"><img class="hv-reports-icon" src="'+chrome.extension.getURL("/images/injected/hv-integration-reports.svg")+'" height="15px" width="15px"><span class="hv-saleshandy-tooltiptext" style="font-style: normal;margin-left: -22px;">Video Reports</span></i>',report_button_in_email_sequence:'<div class="hv-reports-container"><button type="button" class="hv-integration-reports"><img src="'+chrome.extension.getURL("/images/injected/hv-integration-reports.svg")+'" width="20px" height="28px"><div class="hv-report-tooltip">Video Reports</div></button></div>'};if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-saleshandy-dynamic-injected" value=true />';$(hippoCsInjected).appendTo("body");var copyToClipboardBtn='<button class="copy-to-clipboard" data-clipboard-target="#copy-to-clipboard-btn" style="display:none;"></button>';$(copyToClipboardBtn).appendTo("body"),console.log("injected saleshandy-dynamic script"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:g.serviceName,windowId:g.windowId,tabId:g.tabId}}function n(e){if(window.location.href.includes("/template")?$(".mce-stack-layout").find('[role="toolbar"]').find(".mce-container-body").append($(HTML_CONTENT.hippo_template_button)):$(".mce-stack-layout").find('[role="toolbar"]').find(".mce-container-body").append($(HTML_CONTENT.hippo_button)),"EmailSequence"==e&&(window.location.href.includes("/sequence")||window.location.href.includes("/templates"))){var t=$(".tox-toolbar__group");$($(".tox-toolbar__primary")[0].childNodes[t.length-2]).append($(HTML_CONTENT.hippo_button_in_email_sequence))}$(".hv-embed-main-container").off("click").on("click",function(){r(c())})}function o(e,t){"EmailSequence"==t&&window.location.href.includes("/prospects")?($(".action-list").prepend($(HTML_CONTENT.report_button_in_email_sequence)),$(".hv-integration-reports").off("click").on("click",function(e){a(i(e.target,"EmailSequence"))})):($(e).find(".CommonActionIcon").prepend($(HTML_CONTENT.report_button)),$(".hv-integration-reports-button").off("click").on("click",function(e){a(i(e.target))}))}function i(e,t){var n={email:"",name:""};return"EmailSequence"==t?$(e).parents(".prospect-info").length>0&&(n.email=$(".prospect-email").text().trim(),n.name=$(".prospect-name").find("span").text()):$(e).parents(".subscribeCol").length>0&&(n.email=$(e).parents(".subscribeCol").siblings(".emailCol").find("span").text().trim(),n.name=$(e).parents(".subscribeCol").siblings(".nameCol").find("span").text()),n}function a(e){var n=t();n.messageFromContentScript1234=!0,n.initReportPop=!0,n.randomId="",n.msgType="workflow",n.reportBtn="hv-integration-reports",n.contactEmail=e.email,n.contactName=e.name,n.payload={popId:"hvSaleshandyReportPop",logPrefix:g.logPrefix},g.port.postMessage(n)}function r(e){var n=t(),o=s(e);n.messageFromContentScript1234=!0,n.initWorkflowPop=!0,n.msgType="workflow",n.payload={logPrefix:g.logPrefix,popType:"sales",popId:"hvSaleshandyPop",assetContent:{mfFormValues:{Email:o.email}},popConfig:{showEditOption:!0,showTemplatesOption:!1,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:e,fetchMfInVideo:!0,mandatoryEmailMf:e,insertVideoText:"COPY TO CLIPBOARD",showCustomizeComponent:!0,showLandingPageComponent:!0,showTelePrompter:!0,isMailFlow:e}},g.port.postMessage(n)}function s(e){var t={email:""};if(e&&window.location.href.includes("/emails")){var n=$('[aria-label="Add recipients "]');0==n.length&&(n=$('[aria-label="Add recipients"]')),n.length>0&&$(".setEmailInputBdr").find("tag").length>1&&(t.email=$($(".setEmailInputBdr").find("tag")[0]).find(".tag__text").attr("title"))}return t}function c(){return window.location.href.includes("/emails")}function l(e){var t=e.workflowConfig;t.popConfig.isMailFlow?d(t):p(!1,t)}function d(e){var n=t();n.messageFromContentScript1234=!0,n.messageType="saleshandy_dynamic",n.getUTMToken=!0,n.popId=e.popId,n.content=e,n.serviceName=g.serviceName,g.port.postMessage(n)}function p(e,t){var n,o;if(e){t.content.assetContent.uniqueId,n=t.content.assetContent.videoShareUrl,o=t.content.assetContent.thumbnailShareUrl;var i=t.track_id;if(1==t.status)n+=n.includes("?")?"&track_id="+i:"?track_id="+i,o+=o.includes("?")?"&track_id="+i:"?track_id="+i;else{var a=t.content.assetContent.mfInVideo,r=t.content.assetContent.mfFormValues;if(a.length>0){for(var s="",c=0;c<a.length;c++)s=s+encodeURIComponent(a[c])+"="+encodeURIComponent(r[a[c]])+"&";""!=s&&(n+=n.includes("?")?"&"+s:"?"+s,o+=o.includes("?")?"&"+s:"?"+s)}}}else{n=t.assetContent.videoShareUrl,o=t.assetContent.thumbnailShareUrl,t.assetContent.uniqueId;var a=t.assetContent.mfInVideo;a=a||[],a.includes("Email")||a.includes("email")||a.push("Email");for(var s="utm_source=hv-campaigns&hreferer=saleshandy_dynamic&",c=0;c<a.length;c++)s=s+encodeURIComponent(a[c])+"="+(h[a[c]]?h[a[c]]:"{{"+a[c]+"}}")+"&";""!=s&&(n+=n.includes("?")?"&"+s:"?"+s,o+=o.includes("?")?"&"+s:"?"+s)}jQuery(function(){jQuery(".copy-to-clipboard").click()}),copyToClipboard=new ClipboardJS(".copy-to-clipboard",{target:function(){return m(n,o)}}),copyToClipboard.on("success",function(e){$("#copyLinkWithThumbnailTarget").remove()}),$("#hvSaleshandyPop").remove()}function m(e,t){return $("#copyLinkWithThumbnailTarget").remove(),$("body").append('<div id="copyLinkWithThumbnailTarget" aria-hidden="true" tabindex="-1" >'+u(e,t)+"</div>"),document.querySelector("#copyLinkWithThumbnailTarget")}function u(e,t){return'<a href="'+e+'" target="_blank" tabindex="-1"><img src="'+t+'" alt="'+e+'" style="cursor: pointer;" width="360" height="200"></a><div><a href="'+e+'" target="_blank" tabindex="-1" style="cursor: pointer;">Watch Video</a></div><div><br></div>'}var h={Email:"{{Email}}","First Name":"{{First Name}}","Last Name":"{{Last Name}}",Country:"{{Country}}",City:"{{City}}","Phone Number":"{{Phone Number}}","Company Name":"{{Company}}",Title:"{{Job Title}}",State:"{{State}}"},g=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix="SALESHANDY_DYNAMIC :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,g.port.postMessage(e)}(),g.port.onMessage.addListener(function(e,t,n){if(msgFromPort=e.backgroundRecordingMessage,"insertFromWorkflowPop"==msgFromPort&&e.data.serviceName==g.serviceName&&e.data.tabId==g.tabId&&l(e.data),"insertVideoInSaleshandy"==msgFromPort&&e.data.tabId==g.tabId){p(!0,e.data)}}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){for(var i in e){var a=e[i];$(a.target).hasClass("mce-container")&&$(a.target).hasClass("mce-toolbar")&&0==$(".hv-embed-main-container").length&&n(),$(a.target).hasClass("editor-editable-content")&&0==$(".hv-embed-main-container").length&&n("EmailSequence"),$(a.target).hasClass("CommonActionIconContainer")&&window.location.href.includes("/contacts")&&0==$(a.target).find(".hv-integration-reports-button").length&&o(a.target,"EmailTracking"),$(a.target).hasClass("modal-backdrop")&&0==$(".hv-integration-reports").length&&o("","EmailSequence")}}).observe(document,{subtree:!0,childlist:!0,attributes:!0})})}