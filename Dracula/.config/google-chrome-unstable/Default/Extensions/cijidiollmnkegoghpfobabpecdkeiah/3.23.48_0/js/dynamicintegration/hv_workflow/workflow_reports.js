var injectedAlready=document.getElementById("hv-workflow-reports-injected");if(!injectedAlready){var reportsScriptInjected='<input type=hidden id="hv-workflow-reports-injected" value=true />';$(reportsScriptInjected).appendTo("body");var reportBtn="",contactEmail="",contactName="",contactId="",activityNextStart=0,activityHasNext=!1,initialOffsetValue=0,initialNextOffsetValue=20,toLoadReports=!0,toLoadActivities=!0;$(document).ready(function(){function t(t){var e=document.getElementById(t);if(e&&e.getAttribute("value"))return e.getAttribute("value")}function e(){return{serviceName:T.serviceName,windowId:T.windowId,tabId:T.tabId}}function i(t,e){t?_():C("initReport",e.payload)}function o(t){return t.serviceName==T.serviceName&&t.tabId==T.tabId&&t.windowId==T.windowId}function a(t){$(".hv-wf-report-pop-screen").length>0&&j();var e=x(t);$("body").append($(e)),$(".hv-integ-reports").addClass("show-hv-upgrade"),$(".hv-integ-reports").append(M.maskedReportImage),$(".hv-integ-reports").append(M.upgradePop),$(".hv-report-upgrade").off("click").on("click",S),$(".hv-report-close").off("click").on("click",j)}function r(t){var e=x(t);$("body").append($(e)),$(".hv-integ-reports").append(M.reportHeader),$(".hv-integ-reports").append(M.reportSection),$(".hv-integ-reports").append(M.activitySection),$(".hv-integ-reports").append(M.reportFooter),$(".hv-btn-activity").off("click").on("click",V),$(".hv-report-close").off("click").on("click",j),$(".hv-integ-setting").off("click").on("click",U)}function s(t){var e=t.offsetData,i=t.response.count_of_fetched_reports,o=t.response.report_data;if($("#hv-report-load-more").attr("data-offset"),e==initialOffsetValue){var a=d(o,e,i);if("empty"==a)l(!1);else if("data_found"==a){var r=e+i;i<initialNextOffsetValue?($("#hv-report-load-more").attr("data-offset",r),$("#hv-report-load-more").attr("data-next-offset",initialNextOffsetValue),$("#hv-report-load-more").attr("total-reports",i),l(!1)):i==initialNextOffsetValue&&($("#hv-report-load-more").attr("data-offset",r),$("#hv-report-load-more").attr("data-next-offset",r+initialNextOffsetValue),$("#hv-report-load-more").attr("total-reports",i),l(!0))}$(".hv-btn-activity").off("click").on("click",V)}else v(o,i,e)}function n(t){var e="";for(var i in t){var o,a,r,s=t[i],n=s[0],c=s[1],d=c.is_deleted,p=E+"/video/reports/"+n,v=c.loads,l=c.view_count;0==v&&0==l?(o="NA",a="NA",r='<td style="text-align: center;">NA</td>'):(o=c.last_view_date,a=c.max_watch_seconds,r='<td><div class="hv-reports-percentage">                                        <i style="width:'+c.max_play+'%"></i>                                        </div>                                        <span>'+c.max_play+"%</span>                                    </td>"),e+="<tr><td is-video-deleted ="+(d?"true":"false")+">"+(d?'<span class = "hv-deleted-report"><img src='+c.thumbnail+' width="100px" height = "100px">'+c.title+"</span>":"<a href="+p+' target="_blank"><img src='+c.thumbnail+' width="100px" height = "100px">'+c.title+"</a>")+"</td>                                <td>"+v+"</td>                                <td>"+l+"</td>                                <td>"+o+"</td>                                <td>"+a+"</td>"+r+"</tr>"}return e}function c(t,e,i){var o="empty",a="";if(!jQuery.isEmptyObject(t)||e!=initialOffsetValue||0!=i&&null!=i){o="data_found";var r=n(t);a='<table class="hv-reports-table">                                    <thead>                                        <tr>                                            <th>'+D.videoName+"</th><th>"+D.loads+"</th><th>"+D.view+"</th><th>"+D.lastView+"</th><th>"+D.maxWatch+"</th><th>"+D.averageWatch+"</th>                                        </tr>                                    </thead >                                        <tbody>"+r+"</tbody>                                    </table>"}else a='<div class="hv-report-empty"><img src="'+chrome.extension.getURL("/images/injected/reports-empty-icon-orange.svg")+'"/><p>'+D.noReportsFound+"</p></div>";return{state:o,constructedReports:'<div class="hv-report-content">'+a+"</div>"}}function d(t,e,i){var o=c(t,e,i);return $(".hv-report-pop-loading").hide(),$(".hv-report-section").append($(o.constructedReports)),o.state}function p(t){var e=n(t);$(".hv-reports-table tbody").append(e)}function v(t,e,i){var o=i+e,a=o+initialNextOffsetValue,r=o;0==e&&jQuery.isEmptyObject(t)?(l(!1),b()):e<initialNextOffsetValue&&0!=e?($("#hv-report-load-more").attr("data-offset",o),$("#hv-report-load-more").attr("total-reports",r),b(),p(t),l(!1)):e==initialNextOffsetValue&&0!=e&&(l(!0),b(),p(t),$("#hv-report-load-more").attr("data-offset",o),$("#hv-report-load-more").attr("data-next-offset",a),$("#hv-report-load-more").attr("total-reports",r),p(t))}function l(t){t?$(".hv-report-section").scroll(function(){if($(".hv-report-section").scrollTop()>=$(".hv-report-content").height()-$(".hv-report-section").height()&&toLoadReports){toLoadReports=!1;$(".hv-reports-table").append('<tr class="hv-reports-loader">                            <td><emd></emd><em></em></td>                            <td><em></em></td>                            <td><em></em></td>                            <td><em></em></td>                            <td><em></em></td>                            <td><em></em></td>                        </tr>'),A()}}):$(".hv-report-section").off("scroll")}function h(){toLoadActivities=!0,$(".hv-activity-loader").remove()}function m(t){$(".hv-btn-reports").off("click").on("click",N);var e=f(t);$(".hv-report-pop-loading").hide(),$(".hv-activity-section").append($(e.constructedActivities)),$("#hv-report-load-more").hide(),u("empty"==e.state?!1:!0)}function f(t){var e="empty",i="",o=t.response.activities;if(0==o.length&&0==t.next_start)i='<div class="hv-report-empty"><img src="'+chrome.extension.getURL("/images/injected/reports-empty-icon-orange.svg")+'"/><p>'+D.noActivitiesFound+"</p></div>";else{e="data_found";i='<ul class="hv-activity-lists">'+g(o)+"</ul>"}return{state:e,constructedActivities:'<div class="hv-activity-content">'+i+"</div>"}}function g(t){var e="";for(var i in t){var o=t[i].text,a=t[i].play_percentage,r=y(o);if(a>0){var s="",n="",c=o.split("<a"),d=c[1].split("</a>"),p="Watched <a "+d[0]+"</a>";a<=30?(s=chrome.extension.getURL("/images/injected/watch-low.png"),n="It was a good attempt ! Hard work pays off ! Send another !"):a>30&&a<=60?(s=chrome.extension.getURL("/images/injected/watch-medium.png"),n="Hey it seems to be working!! Send one more"):(s=chrome.extension.getURL("/images/injected/watch-high.png"),n="Amazing ! "+contactName+" absolutely loved it. Send one more"),e+='<li>                                        <div class="hv-activity-details">                                            <img src='+r+">                                            <h4>"+p+"</h4>                                            <em>"+t[i].time+'</em>                                        </div>                                        <div class="hv-watch-rate">                                            <span> Watch rate: '+a+'%</span>                                            <div>                                                <i class="hv-watch-image hint--left" style="left: '+a+'%" data-hint="'+n+'"><img src='+s+" /></i>                                            </div>                                        </div>                                    </li>"}else e+='<li>                                        <div class="hv-activity-details">                                            <img src= '+r+">                                            <h4>"+o+"</h4>                                            <em>"+t[i].time+"</em>                                        </div>                                    </li>"}return e}function u(t){t?$(".hv-activity-section").scroll(function(){if($(".hv-activity-section").scrollTop()==$(".hv-activity-content").height()-$(".hv-activity-section").height()&&toLoadActivities){toLoadActivities=!1;$(".hv-activity-lists").append('<li class="hv-activity-loader">                                        <emd></emd>                                        <em></em>                                        <em></em>                                     </li>'),O()}}):$(".hv-activity-section").off("scroll")}function y(t){return t.includes("Clicked")?chrome.extension.getURL("/images/injected/cta-actions.svg"):t.includes("Opened")?chrome.extension.getURL("/images/injected/opened-video.svg"):t.includes("Watched")?chrome.extension.getURL("/images/injected/played-the-video.svg"):t.includes("Created")?chrome.extension.getURL("/images/injected/contact-created.svg"):chrome.extension.getURL("/images/injected/cta-actions.svg")}function b(){toLoadReports=!0,$(".hv-reports-loader").remove()}function w(){$(".hv-report-section").hide(),$(".hv-activity-section").show(),$(".hv-btn-activity").off("click"),$("#hv-report-load-more").hide(),k(),$(".hv-report-pop-loading").show(),$("#hv-activity-load-more").show(),$(".hv-report-close").off("click").on("click",j)}function x(t){var e=M.reportTemplate;return e=e.replace("{id}",t)}function k(){$(".hv-btn-reports").removeClass("active"),$(".hv-btn-reports img").attr("src",chrome.extension.getURL("/images/injected/reports-inactive.png")),$(".hv-btn-activity").addClass("active"),$(".hv-btn-activity img").attr("src",chrome.extension.getURL("/images/injected/activity-active.png"))}function R(){$(".hv-btn-activity").removeClass("active"),$(".hv-btn-activity img").attr("src",chrome.extension.getURL("/images/injected/activity-inactive.png")),$(".hv-btn-reports").addClass("active"),$(".hv-btn-reports img").attr("src",chrome.extension.getURL("/images/injected/reports-active.png"))}function N(){R(),$(".hv-btn-activity").off("click").on("click",L),$(".hv-activity-section").hide(),$(".hv-report-section").show()}function L(){k(),$(".hv-btn-reports").off("click").on("click",N),$(".hv-report-section").hide(),$(".hv-activity-section").show()}function j(){""!=reportBtn&&$("."+reportBtn).length>0&&$("."+reportBtn).attr("disabled",!1),$(".hv-wf-report-pop-screen").remove(),I()}function I(){activityNextStart=0,activityHasNext=!1,initialOffsetValue=0,initialNextOffsetValue=20,toLoadReports=!0,toLoadActivities=!0}function C(t,i){var o=e();o.messageFromContentScript1234=!0,o.msgType="workflow",o.checkAuth=!0,o.checkAuthForReports=!0,o.sourceOfAuthCheck="reports",o.sucessCallbackFnName=t,o.successCallbackFnParams=i,T.port.postMessage(o)}function _(){var t=e();t.messageFromContentScript1234=!0,t.msgType="workflow",t.fetchReportData=!0,t.offsetData=initialOffsetValue,t.nextOffsetData=initialNextOffsetValue,t.contactEmail=contactEmail,T.port.postMessage(t)}function A(){var t=Number($("#hv-report-load-more").attr("data-offset")),i=e();i.messageFromContentScript1234=!0,i.msgType="workflow",i.fetchReportData=!0,i.loadMoreReports=!0,i.offsetData=t,i.contactEmail=contactEmail,T.port.postMessage(i)}function V(){var t=e();t.messageFromContentScript1234=!0,t.msgType="workflow",t.initContactActivitiesTab=!0,T.port.postMessage(t)}function F(){var t=e();t.messageFromContentScript1234=!0,t.msgType="workflow",t.fetchContactId=!0,t.contactEmail=contactEmail,T.port.postMessage(t)}function O(){var t=Number($("#hv-activity-load-more").attr("hv-next-start")),i=e();i.messageFromContentScript1234=!0,i.msgType="workflow",i.fetchActivityData=!0,i.contactEmail=contactEmail,i.contactId=contactId,i.next_start=t,T.port.postMessage(i)}function U(){var t=e();t.messageFromContentScript1234=!0,t.openUrl=!0,t.url=E+"/settings/integrations",T.port.postMessage(t)}function S(){var t=e();t.messageFromContentScript1234=!0,t.openUrl=!0,t.url=E+"/settings/subscription",T.port.postMessage(t)}var T=function(){var e={};return e.serviceName=t("hvIntegName"),e.windowId=Number(t("hvWindowId")),e.tabId=Number(t("hvTabId")),e.screenName="hv-reports",e.port=chrome.extension.connect({name:e.serviceName+"::"+e.windowId+"::"+e.tabId+"::"+e.screenName}),e}(),E="cijidiollmnkegoghpfobabpecdkeiah"===chrome.runtime.id?"https://www.hippovideo.io":"dnebjjdbjiikcmihpkcanphpbibhofkh"===chrome.runtime.id?"https://stage.hippowiz.com":"http://localhost:3000",D={loadMoreReports:"Load more Reports",activity:"Activity",reports:"Reports",upgradeText:"Want to Track Your Videos? / Want to Know Who Viewed Your Videos?",upgradeDescription:"Video tracking can speed up your sales. But this feature seems to be available for users in Hippo Video Pro or Growth plan only.",upgradeBtnText:"Upgrade Now",averageWatch:"Max watch rate",maxWatch:"Max watch seconds",lastView:"Last viewed date",view:"Views",loads:"Loads",videoName:"Video Name",noReportsFound:"No reports found",noActivitiesFound:"No activities found"},M={reportTemplate:'<div id="{id}" class="hv-wf-report-pop-screen">                                    <div id="hv-report-component">                                            <main class="hv-integ-reports" style="display: block; height: auto; overflow: unset;">                                                <span class="hv-report-close"><img src="'+chrome.extension.getURL("/images/injected/icon-close.png")+'"/></span>                                            </main>                                        </div>                                    </div>                                </div>',reportHeader:'<header class="hv-clear-float" style="display: block; background-color: unset;">                                <ul class="hv-integ-mleft">                                    <li class="hv-btn-reports active" style="background-image: url()"><img src="'+chrome.extension.getURL("/images/injected/reports-active.png")+'" alt="settings" />'+D.reports+'</li>                                    <li class="hv-btn-activity"><img src="'+chrome.extension.getURL("/images/injected/activity-inactive.png")+'" alt="settings" />'+D.activity+'</li>                                </ul>                                <ul class="hv-integ-mright">                                    <li class="hv-integ-setting hint--bottom" data-hint="Integration Settings"><img src="'+chrome.extension.getURL("/images/injected/integ-settings.png")+'" alt="settings" /></li>                                </ul>                            </header>',reportSection:'<section class="hv-report-section"><div class="hv-report-pop-loading"><div class="report-loading"><div></div><div></div><div></div><div></div></div></div></section>',activitySection:'<section class="hv-activity-section"><div class="hv-report-pop-loading"><div class="report-loading"><div></div><div></div><div></div><div></div></div></div></section>',reportFooter:'<footer>                                <div id="hv-report-load-more" data-offset='+initialOffsetValue+" data-next-offset="+initialNextOffsetValue+' total-reports=0 ><img class="hv-report-loading-gif" src=""><button id="hv-report-load-more-btn"><span>Load more Reports</span></button></div>                                <div id="hv-activity-load-more" hv-next-start='+activityNextStart+" hv-has-next="+activityHasNext+' ><img class="hv-report-loading-gif" src=""><button id="hv-activity-load-more-btn"><span>Load more notifications</span></button></div>                            </footer>',maskedReportImage:'<img src="'+chrome.extension.getURL("/images/injected/hv-reports-empty-image.png")+'" class="hv-reports-image" />',upgradePop:'<article class="hv-integ-upgrade">                            <h4>'+D.upgradeText+"</h4>                            <p>"+D.upgradeDescription+'</p>                            <button class="hv-report-upgrade">'+D.upgradeBtnText+"</button>                        </article >"};T.port.onMessage.addListener(function(t,e,n){var c=t.backgroundRecordingMessage,d=t.data||{};if(o(d)){if("initReportPop"==c&&(contactEmail=d.contactEmail,reportBtn=d.reportBtn,contactName=d.contactName,i(!1,d)),"initContactActivitiesTab"==c&&(w(),F()),"authcheckResponse"==c&&d.checkAuthForReports&&"reports"==d.sourceOfAuthCheck)if(d.status&&d.response.status)if(d.response.dynamic_integration_reports){var p=d.successCallbackFnParams;if("initReport"==d.sucessCallbackFnName){var v=d.successCallbackFnParams.popId;$("#"+v).length>0&&$("#"+v).remove(),r(p.popId),i(!0,d)}}else a(d.successCallbackFnParams.popId);else $("."+reportBtn).attr("disabled",!1),$("#hv-report-component").length>0&&j();if("fetchReportDataResponse"==c){var l=d.response.not_signed_in;l?C("fetchReportDataResponseCall",d.response):s(d)}if("fetchActivityDataResponse"==c){var l=d.response.not_signed_in;if(l)C("fetchReportDataResponseCall",d.response);else{var f=d.response.has_next,y=d.response.next_start,b=d.response.activities;$("#hv-activity-load-more").attr("hv-next-start",y),$("#hv-activity-load-more").attr("hv-has-next",f),!1===f&&0==b.length?(h(),u(!1)):0!=b.length&&y>50?(h(),activityList=g(b),$(".hv-activity-lists").append(activityList)):m(d)}}if("fetchContactIdResponse"==c){var l=d.response.not_signed_in;if(l)C("fetchReportDataResponseCall",d.response);else if(d.status&&d.response.status)contactId=d.response.contact_id,O();else{$(".hv-report-pop-loading").hide();var x='<div class="hv-activity-content"><div class="hv-report-empty"><img src="'+chrome.extension.getURL("/images/injected/reports-empty-icon-orange.svg")+'"/><p>'+D.noActivitiesFound+"</p></div></div>";$(".hv-activity-section").append(x),$("#hv-report-load-more").hide(),$("#hv-activity-load-more").show(),u(!1),$(".hv-btn-reports").off("click").on("click",N)}}}})})}