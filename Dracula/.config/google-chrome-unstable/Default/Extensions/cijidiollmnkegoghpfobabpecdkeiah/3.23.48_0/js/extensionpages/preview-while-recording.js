function showCountdown(){var e=3;$("#hippo-overlay-time").show();var a=setInterval(function(){$("#countdown").html(e--),e<0&&(clearInterval(a),$("#hippo-overlay-time").hide())},1e3)}function findGetParameter(e){var a=null,t=[];return location.search.substr(1).split("&").forEach(function(r){t=r.split("="),t[0]===e&&(a=decodeURIComponent(t[1]))}),a}function drawMeter(e){var a=-meter.volume*canvasHeight*5;canvasContext.clearRect(0,0,canvasWidth,canvasHeight),canvasContext.fillStyle="rgba(0, 0, 0, 0.2)",canvasContext.strokeStyle="red",roundRect(canvasContext,meterX-10,meterY-canvasHeight,meterWidth+20,canvasHeight,50,"rgba(200,200,200,0.1)","rgba(0,0,0,0.2)",20),canvasContext.fillStyle="black",canvasContext.fillRect(meterX,meterY,meterWidth,-10),meter.checkClipping()&&(canvasContext.fillStyle="red");var t=map(Math.abs(a),0,200,50,255);canvasContext.fillStyle="rgb("+Math.floor(t)+","+Math.floor(205-t/2)+",50)",canvasContext.fillRect(meterX,meterY,meterWidth,a),window.requestAnimationFrame(drawMeter)}function roundRect(e,a,t,r,o,i,n,c,s){var d=void 0===c||0!==c;i=void 0===i?5:i,e.save(),e.beginPath(),e.moveTo(a+i,t),e.lineTo(a+r-i,t),e.quadraticCurveTo(a+r,t,a+r,t+i),e.lineTo(a+r,t+o-i),e.quadraticCurveTo(a+r,t+o,a+r-i,t+o),e.lineTo(a+i,t+o),e.quadraticCurveTo(a,t+o,a,t+o-i),e.lineTo(a,t+i),e.quadraticCurveTo(a,t,a+i,t),e.closePath(),e.lineWidth=s,d&&0!==c&&(e.strokeStyle=void 0===c?"#000":c,e.stroke()),n&&(e.fillStyle=n,e.fill()),e.restore()}function map(e,a,t,r,o){return e>t?o:e<a?r:(e-a)*(o-r)/(t-a)+r}function toggleWebcam(e){var a=$("video#hippo-overlay-screenrecord");$(a).length>0&&("false"==e||0==e?$(a).addClass("mirror-video-class"):$(a).removeClass("mirror-video-class"))}var port=chrome.runtime.connect({name:"mycontentscript"}),localStream,webcamParams,webcamSize,webcamShape,webcamPosition,canvasContext,canvasHeight,canvasWidth,meterWidth,meterX,meterY,userNameDisplay="";port.onMessage.addListener(function(e,a){if(e.databUrl){document.querySelector("video#hippo-overlay-screenrecord");localStream.getTracks()[0].stop()}}),chrome.runtime.sendMessage({webcamSource:!0},function(e){$(".webcam-size").val();chrome.storage.local.get("userNameDisplay",function(e){$(".RectLowerThird-UserNameValue").text(e.userNameDisplay)});chrome.storage.local.get("userDesignation",function(e){$(".RectLowerThird-UserDesignationValue").text(e.userDesignation)});var a=findGetParameter("changeWebcamQuality"),t={width:{ideal:1280,max:1280},height:{ideal:720,max:720}};a&&(t.width={ideal:1920,max:1920},t.height={ideal:1080,max:1080}),e.webcamSource&&(t.deviceId=e.webcamSource),e.aspectRatio&&"Default"!=e.aspectRatio&&(t.aspectRatio=e.aspectRatio);var r=findGetParameter("onlyaudio"),o=void 0==e.isMirrorWebCam||e.isMirrorWebCam;navigator.mediaDevices.getUserMedia({audio:void 0!=r,video:!r&&t}).then(function(e){if(localStream=e,r){$("#hv-onlyAudioPreview").show();findGetParameter("lessonlyRecording")&&$("#onlyAudioIcon").attr("src","/images/extension/audio-black.svg"),window.AudioContext=window.AudioContext||window.webkitAudioContext;var a=new AudioContext,t=a.createMediaStreamSource(e);meter=createAudioMeter(a),t.connect(meter),canvasContext=$("#previewAudioMeter")[0].getContext("2d"),canvasHeight=$("#previewAudioMeter")[0].height,canvasWidth=$("#previewAudioMeter")[0].width,meterWidth=130,meterX=canvasWidth/2-meterWidth/2,meterY=canvasHeight,drawMeter()}else{$("#hippo-overlay-screenrecord").show();var i=document.querySelector("video#hippo-overlay-screenrecord");i.srcObject=e,toggleWebcam(o),i.onloadedmetadata=function(e){i.play()}}}).catch(function(e){console.log("The following error occurred: "+e)})}),showCountdown(),$(document).ready(function(){findGetParameter("center")&&$("#hippo-overlay-screenrecord").css("height","300px"),(webcamParams=findGetParameter("sizePosition"))&&(webcamSize=webcamParams.split("_")[0],webcamPosition=webcamParams.split("_")[1],webcamShape=findGetParameter("shape"),$("#hippo-overlay-screenrecord").addClass("hv-webcam-"+webcamSize),$("#hippo-overlay-screenrecord").addClass("hv-webcam-shape-"+webcamShape),$("#hippo-overlay-screenrecord").addClass("hv-webcam-"+webcamPosition))});