var injectedAlready=document.getElementById("hippowiz-salesforce-dynamic-injected"),mfValuesForLead={},HTML_CONTENT={hippo_button:"<div class='hv-embed-main-container'><button id='hippo_video_button' data-sf-type={{sf-type}} class='hv-embed-main-icon' type='button'><img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'></button><span class='tooltiptext'>Hippo Video</span></div>"},CLASSIC_VERSION_ELEMENT={hippo_button:"<img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='hv-embed-main-container hv-embed-main-icon' data-sf-type={{sf-type}} border='1' alt='Hippo Video' height='18' style='CURSOR:POINTER' title='Hippo Video' width='18'>"},CONTENT={refreshPage:"We've released cool new updates. Please reload the page to view them."},HTML_CODE={refreshEle:'<div class="hv-top-error">\t\t\t\t\t\t<span> '+CONTENT.refreshPage+' </span>\t\t\t\t\t\t<a href="javascript:void(0)" id="hv-refresh-page">Refresh</a>\t\t\t\t\t</div>'};if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-salesforce-dynamic-injected" value=true />';$(hippoCsInjected).appendTo("body");var port;console.log("injected salesforce-dynamic script"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:m.serviceName,windowId:m.windowId,tabId:m.tabId}}function a(e,t){return'<br><a data-cke-saved-href="'+e+'" href="'+e+'" target="_blank" tabindex="-1"><img id="hv_ck_injected_thumbnail" data-cke-saved-src="'+t+'" src="'+t+'" alt="'+e+'" style="max-width: 1125.44px;width: 360px;height: 200px;"></a><br><a data-cke-saved-href="'+e+'" href="'+e+'" target="_blank" tabindex="-1">Watch Video</a><br><br>'}function i(e){if("ligtning_version"==e){var t=HTML_CONTENT.hippo_button.replace("{{sf-type}}","ligtning_version");$(".cuf-attachmentsList").append($(t))}if("classic_version"==e){var t=CLASSIC_VERSION_ELEMENT.hippo_button.replace("{{sf-type}}","classic_version"),a=$(".controls").find("tr")[1],i=$(a).children()[2];$(i).append($(t))}$(".hv-embed-main-icon").off("click").on("click",d)}function o(){var e=t();e.messageFromContentScript1234=!0,e.messageType="salesforce",e.insertCkEditorScripts=!0,m.port.postMessage(e)}function n(){var e=t();e.messageFromContentScript1234=!0,e.initWorkflowPop=!0,e.msgType="workflow",e.payload={logPrefix:m.logPrefix,popType:"sales",popId:"hvSalesforcePop",assetContent:{mfFormValues:mfValuesForLead},popConfig:{showEditOption:!0,showTemplatesOption:!1,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:!0,fetchMfInVideo:!0,mandatoryEmailMf:!0,insertVideoText:"INSERT VIDEO",showCustomizeComponent:!0,showTelePrompter:!0,showLandingPageComponent:!0}},m.port.postMessage(e)}function r(e){var a=window.location.pathname,i=a.includes("email/author/EmailAuthor"),o="";o=i?window.location.href.includes("rtype=00Q")?"lead":window.location.href.includes("rtype=003")?"contact":"":a.split("/")[3].toLowerCase();var n=e.workflowConfig,r=t();r.messageFromContentScript1234=!0,r.messageType="salesforce",r.getUTMToken=!0,r.popId=n.popId,r.content=n,r.serviceName=m.serviceName,r.sfModule=o,m.port.postMessage(r)}function s(){var e="",a={},i="",o=window.location.href;if(o.includes("email/author/EmailAuthor")&&o.includes("lkid=")){if(o.includes("rtype=00Q")){var n=o.split("lkid=");e=n[1].split("&")[0],i="Lead"}if(o.includes("rtype=003")){var n=o.split("lkid=");e=n[1].split("&")[0],i="Contact"}}else{if(o.includes("/Lead/")){var n=o.split("Lead/");e=n[1].split("/")[0],i="Lead"}if(o.includes("/Contact")){var n=o.split("Contact/");e=n[1].split("/")[0],i="Contact"}try{a.Email=$('.slds-page-header__detail-row p[title="Email"]').closest('force-highlights-details-item[role="listitem"]').find("a.emailuiFormattedEmail").text(),a.Title=$('.slds-page-header__detail-row p[title="Title"]').closest('force-highlights-details-item[role="listitem"]').find("lightning-formatted-text").text(),o.includes("/Lead/")&&(a["First Name"]=$('slot.slds-page-header__title[name="primaryField"]').find("lightning-formatted-name").text(),a["Company Name"]=$('.slds-page-header__detail-row p[title="Company"]').closest('force-highlights-details-item[role="listitem"]').find("lightning-formatted-text").text()),o.includes("/Contact")&&(a["First Name"]=$('slot.slds-page-header__title[name="primaryField"]').find("span.uiOutputText").text(),a["Company Name"]=$('.slds-page-header__detail-row p[title="Account Name"]').closest('force-highlights-details-item[role="listitem"]').find("force-hoverable-link a span").text())}catch(e){}}e||(e=$("#hippo_video_button").attr("data-lead-id")),a.Email||(a.Email=$("#hippo_video_button").attr("data-lead-email")),a["First Name"]||(a["First Name"]=$("#hippo_video_button").attr("data-lead-name"));var r=t();r.messageFromContentScript1234=!0,r.messageType="salesforce",r.getLeadMailId=!0,r.leadId=e,r.leadInfoFromDom=a,r.columnObject=i,m.port.postMessage(r)}function d(e){try{$("#hvSalesforcePop").remove(),s()}catch(e){l(e)}}function l(e){"Extension context invalidated."==e.message?c(HTML_CODE.refreshEle,8e3):console.log(e)}function c(e,t){0==$(".hv-top-error").length&&($(e).appendTo("body"),$("#hv-refresh-page").off("click").on("click",function(){window.location.reload()}),setTimeout(function(){$(".hv-top-error").remove()},t))}var m=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix=" SALESFORCE_DYNAMIC :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,m.port.postMessage(e)}(),function(){var e=0;if(window.location.href.includes("email/author/EmailAuthor")&&0==$(".hv-embed-main-container").length)var t=setInterval(function(){var a=$(".controls");$(a).length>0&&0==$(a).find(".hv-embed-main-container").length&&(clearInterval(t),i("classic_version")),++e>500&&clearInterval(t)},25)}(),m.port.onMessage.addListener(function(e,i,o){if(msgFromPort=e.backgroundRecordingMessage,"gotLeadMailIdFromSalesforce"==msgFromPort&&e.data.serviceName==m.serviceName&&e.data.tabId==m.tabId){var s=e.data,d=s.response;mfValuesForLead=void 0!=d&&void 0!=d.status&&s.status?d.lead_info:{};var l=s.leadInfoFromDom||{};for(var c in mfValuesForLead)l[c]=mfValuesForLead[c];mfValuesForLead=l,n()}if("insertFromWorkflowPop"==msgFromPort&&e.data.serviceName==m.serviceName&&e.data.tabId==m.tabId&&r(e.data),"insertVideoInSalesforceMailBox"==msgFromPort&&e.data.serviceName==m.serviceName&&e.data.tabId==m.tabId){var p=e.data,h=p.track_data,f=h.token,s=p.content.assetContent,v=s.videoShareUrl,u=s.thumbnailShareUrl;if(p.status&&h.status&&f)v+=v.includes("?")?"&track_id="+f:"?track_id="+f,u+=u.includes("?")?"&track_id="+f:"?track_id="+f;else if(s.mfInVideo.length>0){for(var g="",b=0;b<s.mfInVideo.length;b++)b>0&&(g+="&"),g+=s.mfInVideo[b]+"="+s.mfFormValues[s.mfInVideo[b]];""!=g&&(v+=v.includes("?")?"&"+g:"?"+g,u+=u.includes("?")?"&"+g:"?"+g)}var _=$(".hv-embed-main-icon").attr("data-sf-type");if("classic_version"==_&&$('[title="HTML Body"]')){var w=$('[title="HTML Body"]')[0].contentDocument.body,I="<div>"+a(v,u)+"</div>";$(w).append($(I)[0])}if("ligtning_version"==_){var y=t();y.messageFromContentScript1234=!0,y.messageType="salesforce",y.ckeditorAction=!0,y.editorAction="prepend",y.salesforceType=_,y.content=a(v,u),m.port.postMessage(y)}$("#hvSalesforcePop").remove()}}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){window.location.href.includes("email/author/EmailAuthor")&&0==$(".hv-embed-main-container").length&&i("classic_version"),(window.location.href.includes("/Lead/list")||window.location.href.includes("/Contact/list"))&&$(".emailuiFormattedEmail").off("click").on("click",function(e){var t=0,a=setInterval(function(){if($("#hippo_video_button").length>0){if(!$("#hippo_video_button").attr("data-lead-email")){clearInterval(a);var i=$(e.currentTarget),o=$(i).text(),n=$(i).closest("tr"),r=$(n).find("th a"),s=$(r).attr("data-recordid"),d=$(r).attr("title");$("#hippo_video_button").attr("data-lead-email",o),$("#hippo_video_button").attr("data-lead-id",s),$("#hippo_video_button").attr("data-lead-name",d)}}100==++t&&clearInterval(a)},100)});for(var a in e){var n=e[a];$(n.target).hasClass("cuf-publisherAttachmentBar desktop forceChatterPublisherAttachments runtime_sales_emailtemplateuiEmailToolbar")&&0==$(".hv-embed-main-container").length&&i("ligtning_version"),"phSearchInput"==n.target.id&&0==$(".hv-embed-main-container").length&&i("classic_version"),"CK Editor Container"==$(n.target).attr("title")&&o()}}).observe(document,{subtree:!0,childlist:!0,attributes:!0})})}