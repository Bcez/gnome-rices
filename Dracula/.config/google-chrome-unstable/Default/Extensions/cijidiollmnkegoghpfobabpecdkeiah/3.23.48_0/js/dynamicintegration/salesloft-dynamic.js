var injectedAlready=document.getElementById("hippowiz-salesloft-dynamic-injected"),HTML_CONTENT={hippo_button:"<div class='hv-embed-main-container tox-toolbar__group'> <button id='hippo_video_button' class='hv-embed-main-icon' data-hint='Hippo Video' type='button'><img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'  height='24px' width='22px' > </button><span class='tooltiptext'>Hippo Video</span></div>",hippo_cadence_button:"<div class='hv-embed-main-container tox-toolbar__group hv-cadence-container'> <button id='hippo_video_cadence_button' class='hv-embed-main-icon hv-cadence-btn' data-hint='Hippo Video' type='button'><img src='https://hippolms-wiz-static.s3.amazonaws.com/images/gmail_add_on/video-icon-orange.svg' class='icon_image'  height='17px' width='17px' style='margin-bottom: 4px;'> </button><span class='tooltiptext'>Hippo Video</span></div>"},REPORT_HTML={hippo_report_button:"<div class='hv-integration-reports hv-embed-main-container-report QuickActionsPanel__QuickActionContainer-lc6sl-1 eufBwE'><div class='TooltipContainer__HoverContainer-bDjktw kajIYj'><div class='hidden-tooltip'></div><div data-qa='quick-action' class='QuickAction__QuickActionComponent-sc-11ttuz6-0 gLdmWi'><img src='"+chrome.extension.getURL("/images/injected/hv-integration-reports.svg")+"' height='35px' width='35px'; style='margin-top: 8px;'><div class='hv-reports-text'>Video Reports</div></div></div></div>"},copyToClipboard=void 0,peopleTabProcessing=!1;if(!injectedAlready){var hippoCsInjected='<input type=hidden id="hippowiz-salesloft-dynamic-injected" value=true />';$(hippoCsInjected).appendTo("body"),console.log("injected salesloft-dynamic script");var copyToClipboardBtn='<button class="copy-to-clipboard" data-clipboard-target="#copy-to-clipboard-btn" style="display:none;"></button>';$(copyToClipboardBtn).appendTo("body"),$(document).ready(function(){function e(e){var t=document.getElementById(e);if(t&&t.getAttribute("value"))return t.getAttribute("value")}function t(){return{serviceName:f.serviceName,windowId:f.windowId,tabId:f.tabId}}function n(e){var t=e.track_id,n=e.content.popConfig.isTemplateFlow,a=e.content.assetContent.videoShareUrl,i=e.content.assetContent.thumbnailShareUrl;if(n){var r="";e.content.assetContent.mfInVideo.includes("email")||e.content.assetContent.mfInVideo.includes("Email")||e.content.assetContent.mfInVideo.push("Email");for(var s=0;s<e.content.assetContent.mfInVideo.length;s++)r+=e.content.assetContent.mfInVideo[s]+"="+f.mergeFieldFormats[e.content.assetContent.mfInVideo[s]]+"&";""!=r&&(a+=a.includes("?")?"&"+r:"?"+r,i+=i.includes("?")?"&"+r:"?"+r)}else if(1==e.status)a+=a.includes("?")?"&track_id="+t:"?track_id="+t,i+=i.includes("?")?"&track_id="+t:"?track_id="+t;else{var l=e.content.assetContent.mfInVideo,p=e.content.assetContent.mfFormValues;if(l.length>0){for(var r="",s=0;s<l.length;s++)r=r+encodeURIComponent(l[s])+"="+encodeURIComponent(p[l[s]])+"&";""!=r&&(a+=a.includes("?")?"&"+r:"?"+r,i+=i.includes("?")?"&"+r:"?"+r)}}copyToClipboard&&copyToClipboard.destroy(),jQuery(function(){jQuery(".copy-to-clipboard").click()}),copyToClipboard=new ClipboardJS(".copy-to-clipboard",{target:function(){return o(!0,a,i)}}),copyToClipboard.on("success",function(e){$("#copyLinkWithThumbnailTarget").hide()}),$("#hvsalesloftPop").remove()}function o(e,t,n){if(e)return $("#copyLinkWithThumbnailTarget").remove(),$("body").append('<div id="copyLinkWithThumbnailTarget" aria-hidden="true" tabindex="-1" >'+a(t,n)+"</div>"),document.querySelector("#copyLinkWithThumbnailTarget")}function a(e,t){return'<a href="'+e+'" target="_blank" tabindex="-1"><img src="'+t+'" alt="'+e+'" width="360" height="200"></a><div style="padding-top: 7px;"><a href="'+e+'" target="_blank" tabindex="-1" style="cursor: pointer;">Watch Video</a></div><div><br></div>'}function i(e,t){switch(t){case"people-tab":0==$(e).find(".hv-embed-main-container").length&&$(e).find('div[class^="OneOffEmailComponent__ButtonContainer"]').append($(HTML_CONTENT.hippo_button));break;case"template-cadence-tab":0==$(".hv-embed-main-container").length&&$(e).parents(".tox-toolbar").append($(HTML_CONTENT.hippo_cadence_button));break;case"cadence-tab-via-prospect":0==$(e).parents(".tox-toolbar").find(".hv-embed-main-container").length&&$(e).parents(".tox-toolbar").append($(HTML_CONTENT.hippo_cadence_button))}$(".hv-embed-main-icon").off("click").on("click",p)}function r(){var e=!1,t=0,n=setInterval(function(){if($('[data-testid="Quick ActionsPanel"]').length>0&&$('[data-testid="Quick ActionsPanel"]').siblings().length>0&&0==$(".hv-integration-reports").length){e=!0;var o=$('[data-testid="Quick ActionsPanel"]').siblings()[0],a=$(o).children().last().clone();$(a).addClass("hv-report-widget-container"),$(o).children().last().after($(a)),$(".hv-report-widget-container").empty(),$(".hv-report-widget-container").append($(REPORT_HTML.hippo_report_button)),clearInterval(n),$(".hv-integration-reports").off("click").on("click",m)}(++t>200||e)&&clearInterval(n)},500)}function s(e,n){var o=u(),a=t();a.messageFromContentScript1234=!0,a.initWorkflowPop=!0,a.msgType="workflow",a.payload={logPrefix:f.logPrefix,popType:"sales",popId:"hvsalesloftPop",assetContent:{uniqueId:e,mfFormValues:{Email:n.email,"First Name":n.firstName}},popConfig:{showEditOption:!0,showTemplatesOption:!1,showContactsOption:!1,showVideoPageLibrary:!0,addSalesUtmParams:!1,popReinitConditions:[],showMfForm:!o,fetchMfInVideo:!0,mandatoryEmailMf:!0,showCustomizeComponent:!0,showTelePrompter:!0,showLandingPageComponent:!0,insertVideoText:"COPY TO CLIPBOARD",isTemplateFlow:o}},f.port.postMessage(a)}function l(e){var n=e.workflowConfig,o=t();o.messageFromContentScript1234=!0,o.messageType="salesloft_dynamic",o.getUTMToken=!0,o.popId=n.popId,o.content=n,o.serviceName=f.serviceName,f.port.postMessage(o)}function p(e){$("#hvsalesloftPop").remove();var t=c(20);$(e.currentTarget).attr("data-random-id",t);var n={};u()||(n=d(e)),s(t,n)}function d(e){var t,n="",o="";try{$(e.currentTarget).parents(".composability-panes--pane").length>0?(t=$(e.currentTarget).parents(".composability-panes--pane"),t.find('input[aria-label="TO"]').length>0?n=t.find('input[aria-label="TO"]').val().split("<")[1].split(">")[0]:t.find('span[aria-label="TO"]').length>0&&(prospectInfo=t.find('span[aria-label="TO"]').text().split("<"),o=prospectInfo[0],n=prospectInfo[1].split(">")[0]),t.find(".PaneShellstyles__PaneShellTitle-sc-1mufjoe-3").length>0&&(o=t.find(".PaneShellstyles__PaneShellTitle-sc-1mufjoe-3").text().split(" ")[0])):$(e.currentTarget).parents(".content.after-open").length>0&&(t=$(e.currentTarget).parents(".content.after-open"),n=t.find('input[aria-label="TO"]').val().split("<")[1].split(">")[0],o=t.find(".PaneShellstyles__PaneShellTitle-sc-1mufjoe-3").text().split(" ")[0])}catch(e){console.log(e)}return{email:n,firstName:o}}function c(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*o));return t}function m(e){$("#hvSalesloftReportPop").remove(),$(".hv-integration-reports").attr("disabled",!0),g()}function g(){email=$('[class^="EmailAddressItem__Container-"]').find('[class^="ContactItemValue__Value"]').text().trim(),h(email)}function h(e){var n=t();n.messageFromContentScript1234=!0,n.initReportPop=!0,n.randomId="",n.msgType="workflow",n.reportBtn="hv-integration-reports",n.contactEmail=e,n.payload={popId:"hvSalesloftReportPop",logPrefix:f.logPrefix},f.port.postMessage(n)}function u(){return $(".sc-iUuytg").length>0||$(".template-edit-modal").length>0||$(".qa-create-step-modal.step-modal.modal-dialog--large-dialog.emails").length>0}var f=function(){var t={};return t.serviceName=e("hvIntegName"),t.windowId=Number(e("hvWindowId")),t.tabId=Number(e("hvTabId")),t.logPrefix=" SALESLOFT_DYNAMIC :: ",t.port=chrome.extension.connect({name:t.serviceName+"::"+t.windowId+"::"+t.tabId}),t.mergeFieldFormats={"First Name":"{{first_name}}",Email:"{{email_address}}","Last Name":"{{last_name}}","Company Name":"{{company}}",Country:"{{country}}",City:"{{city}}",State:"{{state}}",Title:"{{title}}","Phone Number":"",Address:""},t}();!function(){var e=t();e.messageFromContentScript1234=!0,e.injectHvWorkflowScripts=!0,f.port.postMessage(e)}(),f.port.onMessage.addListener(function(e,t,o){if(msgFromPort=e.backgroundRecordingMessage,"insertFromWorkflowPop"==msgFromPort&&e.data.serviceName==f.serviceName&&e.data.tabId==f.tabId&&l(e.data),"insertVideoInSalesloft"==msgFromPort&&e.data.tabId==f.tabId){n(e.data)}}),MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){for(var n in e){var o=e[n],a=window.location.href;$(o.target).hasClass("tox-tbtn")&&(($(o.target).parents(".template-edit-modal").length>0||$(o.target).parents(".sc-iUuytg").length>0||$(o.target).parents(".qa-create-step-modal.step-modal.modal-dialog--large-dialog").length>0)&&i(o.target,"template-cadence-tab"),$(o.target).parents(".composability-panes--pane").length>0&&($(o.target).parents(".composability-panes--pane").find('div[class^="WorkflowEmailPane__ScheduleButtons"]').length>0?i(o.target,"cadence-tab-via-prospect"):$(o.target).parents(".composability-panes--pane").find('div[class^="OneOffEmailComponent__ButtonContainer"]')&&i($(o.target).parents(".composability-panes--pane"),"people-tab"))),"SLApp.PersonDetailsPage"==$(o.target).attr("name")&&0==$(".hv-embed-main-container-report").length&&a.includes("/people/")&&r()}}).observe(document,{subtree:!0,childlist:!0,attributes:!0})})}